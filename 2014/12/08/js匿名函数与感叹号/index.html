<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>js匿名函数与感叹号 | 半饱和</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="javascript," />
  

  <meta name="description" content="关于javascript函数定义……">
<meta property="og:type" content="article">
<meta property="og:title" content="js匿名函数与感叹号">
<meta property="og:url" content="http://ohroot.com/2014/12/08/js匿名函数与感叹号/index.html">
<meta property="og:site_name" content="半饱和">
<meta property="og:description" content="关于javascript函数定义……">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="js匿名函数与感叹号">
<meta name="twitter:description" content="关于javascript函数定义……">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link rel="stylesheet" href="/css/styles.css" type="text/css">

  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?8f194a78c11f76027a96c6ec87298c62";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


</head>

<body>
  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry hint hint--left" data-hint="点击返回首页" href="/">盒子</a>
    <ul class="list-toolbox">
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/archives/">博客</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/category/">分类</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/tag/">标签</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/urls/">安全圈</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/link/">友链</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/about/">关于</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/atom.xml">RSS</a>
          </li>
        
      
    </ul>
  </div>


</div>

 
  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#函数的定义"><span class="toc-text">函数的定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#匿名函数"><span class="toc-text">匿名函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#理论讲完了，讲点重点"><span class="toc-text"> 理论讲完了，讲点重点 </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#神奇的感叹号"><span class="toc-text">神奇的感叹号</span></a></li></ol>
  </div>


 <a class="back-top" href="#">
  <i class="icon-angle-up"></i>
</a>


<div class="content-post CENTER">
   <article id="post-js匿名函数与感叹号" class="article article-type-post" itemscope itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">js匿名函数与感叹号</h1>

    <div class="article-meta">
      <span>2014-12-08</span>

      <span> | </span>

      <span class="article-author">Direwolf</span>

      <span> | </span>

      
  <span class="article-category">
    <a class="article-category-link" href="/categories/编程/">编程</a>
  </span>


    </div>
  </header>

  <div class="article-content">
    
      <p>关于javascript函数定义……<br><a id="more"></a></p>
<h2 id="函数的定义">函数的定义</h2><p>首先简单介绍一下函数的定义，大致介绍常见的两种<br>第一种<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">double</span><span class="params">(x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * x;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第二种：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> double = <span class="function"><span class="keyword">function</span><span class="params">(x)</span> </span>&#123; <span class="keyword">return</span> <span class="number">2</span>* x; &#125;</span><br></pre></td></tr></table></figure></p>
<p>注意<code>=</code>右边的函数就是一个匿名函数，创造完毕函数后，又将该函数赋给了变量square。</p>
<h2 id="匿名函数">匿名函数</h2><p>上面所讲的定义square函数的方式即为匿名函数，这也是最常用的方式之一。<br>还有一种方式，可能也是初学者比较困惑的方式：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span><span class="params">(x, y)</span></span>&#123;</span><br><span class="line">    alert(x + y);  </span><br><span class="line">&#125;)(<span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure></p>
<p>这里创建了一个匿名函数(在第一个括号内)，第二个括号用于调用该匿名函数，并传入参数,然后函数顺次执行，并返回<code>undefined</code>。</p>
<h2 id="理论讲完了，讲点重点"><strong> 理论讲完了，讲点重点 </strong></h2><p>我之前看到别人这些写匿名函数很是困惑，匿名函数既然定义了之后就执行函数体，为什么不直接写代码呢，后来网上查阅了下，别人说的理由如下：</p>
<ul>
<li>避免占用全局变量名</li>
<li>参数保护,函数是独立作用域,传递参数可以保护临时变量,闭包可以保存循环中需要保留的临时变量,还有组件开发时将命名空间传递到函数中用闭包保护起来,即使命名空间被后面的代码重置,原变量被闭包保护将仍然生存</li>
<li>降低风险,因为没有变量名,中间代码又被闭包保护,js注入无法访问,减少被攻击风险</li>
</ul>
<p>好吧，好处显而易见</p>
<hr>
<h2 id="神奇的感叹号">神奇的感叹号</h2><p>后来我又看到类似这样的代码<code>!function(){alert(&#39;ohroot&#39;)}()</code>，在函数定义前面加了个<code>!</code>,函数体内代码正常执行，返回值<code>undefined</code>,瞬间又达到了匿名函数的效果。</p>
<p>我们一般匿名函数长得像这样:<br><code>(function(){alert(&#39;ohroot&#39;)})()// true</code><br>或者：<br><code>(function(){alert(&#39;ohroot&#39;)}())// true</code></p>
<p>其实无论是括号，还是感叹号，让整个语句合法做的事情只有一件，就是让一个函数声明语句变成了一个表达式。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span><span class="params">()</span></span>&#123;alert(<span class="string">'ohroot'</span>)&#125;<span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></p>
<p>这是一个函数声明，如果在这么一个声明后直接加上括号调用，解析器自然不会理解而报错：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span><span class="params">()</span></span>&#123;alert(<span class="string">'ohroot'</span>)&#125;()<span class="comment">// SyntaxError: unexpected_token</span></span><br></pre></td></tr></table></figure></p>
<p>因为这样的代码混淆了函数声明和函数调用，以这种方式声明的函数a，就应该以a();的方式调用。</p>
<p>但是括号则不同，它将一个函数声明转化成了一个表达式，解析器不再以函数声明的方式处理函数a，而是作为一个函数表达式处理，也因此只有在程序执行到函数a时它才能被访问。所以，任何消除函数声明和函数表达式间歧义的方法，都可以被解析器正确识别。比如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="number">10</span>&#125;();<span class="comment">// undefined  </span></span><br><span class="line"><span class="number">1</span> &amp;&amp; <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> <span class="literal">true</span>&#125;();<span class="comment">// true  </span></span><br><span class="line"><span class="number">1</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;alert(<span class="string">'ohroot'</span>)&#125;();<span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></p>
<p>赋值，逻辑，甚至是逗号，各种操作符都可以告诉解析器，这个不是函数声明，它是个函数表达式。并且，对函数一元运算可以算的上是消除歧义最快的方式，感叹号只是其中之一，如果不在乎返回值，这些一元运算都是有效的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">!<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;alert(<span class="string">'ohroot'</span>)&#125;()<span class="comment">// true</span></span><br><span class="line">+<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;alert(<span class="string">'ohroot'</span>)&#125;()<span class="comment">// NaN</span></span><br><span class="line">-<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;alert(<span class="string">'ohroot'</span>)&#125;()<span class="comment">// NaN</span></span><br><span class="line">~<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;alert(<span class="string">'ohroot'</span>)&#125;()<span class="comment">// -1</span></span><br></pre></td></tr></table></figure></p>
<p>甚至下面这些关键字，都能很好的工作：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;alert(<span class="string">'ohroot'</span>)&#125;()<span class="comment">// undefined  </span></span><br><span class="line"><span class="keyword">new</span> <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;alert(<span class="string">'ohroot'</span>)&#125;()<span class="comment">// Object  </span></span><br><span class="line"><span class="keyword">delete</span> <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;alert(<span class="string">'ohroot'</span>)&#125;()<span class="comment">// true</span></span><br></pre></td></tr></table></figure></p>
<p>最后，括号做的事情也是一样的，消除歧义才是它真正的工作，而不是把函数作为一个整体，所以无论括号括在声明上还是把整个函数都括在里面，都是合法的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;alert(<span class="string">'ohroot'</span>)&#125;)()<span class="comment">// undefined</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;alert(<span class="string">'ohroot'</span>)&#125;())<span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></p>
<p>参考文章：<a href="http://swordair.com/function-and-exclamation-mark/" target="_blank" rel="external">function与感叹号</a></p>

    
  </div>
</article>





  <section class="duoshuo-comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="" data-title="js匿名函数与感叹号" data-url="http://ohroot.com/2014/12/08/js匿名函数与感叹号/index.html"></div>
    <!-- 多说评论框 end -->
  </section>


</div>

  

  
  <script type="text/javascript">
  var duoshuoQuery = {short_name:"bigegg"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>


</body>
</html>
