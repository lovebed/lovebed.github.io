<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>为博客添加3D标签云 | 半饱和</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="hexo," />
  

  <meta name="description" content="看到别人博客的标签云，羡慕的很啊，必须搞一个。">
<meta property="og:type" content="article">
<meta property="og:title" content="为博客添加3D标签云">
<meta property="og:url" content="http://ohroot.com/2014/09/19/tagscloud/index.html">
<meta property="og:site_name" content="半饱和">
<meta property="og:description" content="看到别人博客的标签云，羡慕的很啊，必须搞一个。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="为博客添加3D标签云">
<meta name="twitter:description" content="看到别人博客的标签云，羡慕的很啊，必须搞一个。">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link rel="stylesheet" href="/css/styles.css" type="text/css">

  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?8f194a78c11f76027a96c6ec87298c62";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


</head>

<body>
  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry hint hint--left" data-hint="点击返回首页" href="/">盒子</a>
    <ul class="list-toolbox">
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/archives/">博客</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/category/">分类</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/tag/">标签</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/urls/">安全圈</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/link/">友链</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/about/">关于</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/atom.xml">RSS</a>
          </li>
        
      
    </ul>
  </div>


</div>

 

 <a class="back-top" href="#">
  <i class="icon-angle-up"></i>
</a>


<div class="content-post CENTER">
   <article id="post-tagscloud" class="article article-type-post" itemscope itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">为博客添加3D标签云</h1>

    <div class="article-meta">
      <span>2014-09-19</span>

      <span> | </span>

      <span class="article-author">Direwolf</span>

      <span> | </span>

      
  <span class="article-category">
    <a class="article-category-link" href="/categories/hexo/">hexo</a>
  </span>


    </div>
  </header>

  <div class="article-content">
    
      <p>看到别人博客的标签云，羡慕的很啊，必须搞一个。<br><a id="more"></a><br>看到别人博客的标签云，羡慕的很啊，必须搞一个，于是找来了相关代码来修改<br>核心js代码如下：</p>
<pre><code class="javascript"><span class="keyword">var</span> radius = <span class="number">90</span>;
<span class="keyword">var</span> dtr = <span class="built_in">Math</span>.PI / <span class="number">180</span>;
<span class="keyword">var</span> d = <span class="number">300</span>;

<span class="keyword">var</span> mcList = [];
<span class="keyword">var</span> active = <span class="literal">false</span>;
<span class="keyword">var</span> lasta = <span class="number">1</span>;
<span class="keyword">var</span> lastb = <span class="number">1</span>;
<span class="keyword">var</span> distr = <span class="literal">true</span>;
<span class="keyword">var</span> tspeed = <span class="number">10</span>;
<span class="keyword">var</span> size = <span class="number">250</span>;

<span class="keyword">var</span> mouseX = <span class="number">0</span>;
<span class="keyword">var</span> mouseY = <span class="number">0</span>;

<span class="keyword">var</span> howElliptical = <span class="number">1</span>;

<span class="keyword">var</span> aA = <span class="literal">null</span>;
<span class="keyword">var</span> oDiv = <span class="literal">null</span>;

<span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
    <span class="keyword">var</span> i = <span class="number">0</span>;
    <span class="keyword">var</span> oTag = <span class="literal">null</span>;

    oDiv = <span class="built_in">document</span>.getElementById(<span class="string">'newstags'</span>);

    aA = oDiv.getElementsByTagName(<span class="string">'a'</span>);

    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; aA.length; i++) {
        oTag = {};

        oTag.offsetWidth = aA[i].offsetWidth;
        oTag.offsetHeight = aA[i].offsetHeight;

        mcList.push(oTag);
    }

    sineCosine(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);

    positionAll();

    oDiv.onmouseover = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
        active = <span class="literal">true</span>;
    };

    oDiv.onmouseout = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
        active = <span class="literal">false</span>;
    };

    oDiv.onmousemove = <span class="function"><span class="keyword">function</span><span class="params">(ev)</span> </span>{
        <span class="keyword">var</span> oEvent = <span class="built_in">window</span>.event || ev;

        mouseX = oEvent.clientX - (oDiv.offsetLeft + oDiv.offsetWidth / <span class="number">2</span>);
        mouseY = oEvent.clientY - (oDiv.offsetTop + oDiv.offsetHeight / <span class="number">2</span>);

        mouseX /= <span class="number">5</span>;
        mouseY /= <span class="number">5</span>;
    };

    setInterval(update, <span class="number">30</span>);
};

<span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">()</span> </span>{
    <span class="keyword">var</span> a;
    <span class="keyword">var</span> b;

    <span class="keyword">if</span> (active) {
        a = (-<span class="built_in">Math</span>.min(<span class="built_in">Math</span>.max(-mouseY, -size), size) / radius) * tspeed;
        b = (<span class="built_in">Math</span>.min(<span class="built_in">Math</span>.max(-mouseX, -size), size) / radius) * tspeed;
    } <span class="keyword">else</span> {
        a = lasta * <span class="number">0.98</span>;
        b = lastb * <span class="number">0.98</span>;
    }

    lasta = a;
    lastb = b;

    <span class="keyword">if</span> (<span class="built_in">Math</span>.abs(a) &lt;= <span class="number">0.01</span> &amp;&amp; <span class="built_in">Math</span>.abs(b) &lt;= <span class="number">0.01</span>) {
        <span class="keyword">return</span>;
    }

    <span class="keyword">var</span> c = <span class="number">0</span>;
    sineCosine(a, b, c);
    <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; mcList.length; j++) {
        <span class="keyword">var</span> rx1 = mcList[j].cx;
        <span class="keyword">var</span> ry1 = mcList[j].cy * ca + mcList[j].cz * (-sa);
        <span class="keyword">var</span> rz1 = mcList[j].cy * sa + mcList[j].cz * ca;

        <span class="keyword">var</span> rx2 = rx1 * cb + rz1 * sb;
        <span class="keyword">var</span> ry2 = ry1;
        <span class="keyword">var</span> rz2 = rx1 * (-sb) + rz1 * cb;

        <span class="keyword">var</span> rx3 = rx2 * cc + ry2 * (-sc);
        <span class="keyword">var</span> ry3 = rx2 * sc + ry2 * cc;
        <span class="keyword">var</span> rz3 = rz2;

        mcList[j].cx = rx3;
        mcList[j].cy = ry3;
        mcList[j].cz = rz3;

        per = d / (d + rz3);

        mcList[j].x = (howElliptical * rx3 * per) - (howElliptical * <span class="number">2</span>);
        mcList[j].y = ry3 * per;
        mcList[j].scale = per;
        mcList[j].alpha = per;

        mcList[j].alpha = (mcList[j].alpha - <span class="number">0.6</span>) * (<span class="number">10</span> / <span class="number">6</span>);
    }

    doPosition();
    depthSort();
}

<span class="function"><span class="keyword">function</span> <span class="title">depthSort</span><span class="params">()</span> </span>{
    <span class="keyword">var</span> i = <span class="number">0</span>;
    <span class="keyword">var</span> aTmp = [];

    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; aA.length; i++) {
        aTmp.push(aA[i]);
    }

    aTmp.sort(
        <span class="function"><span class="keyword">function</span><span class="params">(vItem1, vItem2)</span> </span>{
            <span class="keyword">if</span> (vItem1.cz &gt; vItem2.cz) {
                <span class="keyword">return</span> -<span class="number">1</span>;
            } <span class="keyword">else</span> <span class="keyword">if</span> (vItem1.cz &lt; vItem2.cz) {
                <span class="keyword">return</span> <span class="number">1</span>;
            } <span class="keyword">else</span> {
                <span class="keyword">return</span> <span class="number">0</span>;
            }
        }
    );

    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; aTmp.length; i++) {
        aTmp[i].style.zIndex = i;
    }
}

<span class="function"><span class="keyword">function</span> <span class="title">positionAll</span><span class="params">()</span> </span>{
    <span class="keyword">var</span> phi = <span class="number">0</span>;
    <span class="keyword">var</span> theta = <span class="number">0</span>;
    <span class="keyword">var</span> max = mcList.length;
    <span class="keyword">var</span> i = <span class="number">0</span>;

    <span class="keyword">var</span> aTmp = [];
    <span class="keyword">var</span> oFragment = <span class="built_in">document</span>.createDocumentFragment();

    <span class="comment">//Ëæ»úÅÅÐò</span>
    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; aA.length; i++) {
        aTmp.push(aA[i]);
    }

    aTmp.sort(
        <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>{
            <span class="keyword">return</span> <span class="built_in">Math</span>.random() &lt; <span class="number">0.5</span> ? <span class="number">1</span> : -<span class="number">1</span>;
        }
    );

    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; aTmp.length; i++) {
        oFragment.appendChild(aTmp[i]);
    }

    oDiv.appendChild(oFragment);

    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; max + <span class="number">1</span>; i++) {
        <span class="keyword">if</span> (distr) {
            phi = <span class="built_in">Math</span>.acos(-<span class="number">1</span> + (<span class="number">2</span> * i - <span class="number">1</span>) / max);
            theta = <span class="built_in">Math</span>.sqrt(max * <span class="built_in">Math</span>.PI) * phi;
        } <span class="keyword">else</span> {
            phi = <span class="built_in">Math</span>.random() * (<span class="built_in">Math</span>.PI);
            theta = <span class="built_in">Math</span>.random() * (<span class="number">2</span> * <span class="built_in">Math</span>.PI);
        }
        <span class="comment">//×ø±ê±ä»»</span>
        mcList[i - <span class="number">1</span>].cx = radius * <span class="built_in">Math</span>.cos(theta) * <span class="built_in">Math</span>.sin(phi);
        mcList[i - <span class="number">1</span>].cy = radius * <span class="built_in">Math</span>.sin(theta) * <span class="built_in">Math</span>.sin(phi);
        mcList[i - <span class="number">1</span>].cz = radius * <span class="built_in">Math</span>.cos(phi);

        aA[i - <span class="number">1</span>].style.left = mcList[i - <span class="number">1</span>].cx + oDiv.offsetWidth / <span class="number">2</span> - mcList[i - <span class="number">1</span>].offsetWidth / <span class="number">2</span> + <span class="string">'px'</span>;
        aA[i - <span class="number">1</span>].style.top = mcList[i - <span class="number">1</span>].cy + oDiv.offsetHeight / <span class="number">2</span> - mcList[i - <span class="number">1</span>].offsetHeight / <span class="number">2</span> + <span class="string">'px'</span>;
    }
}

<span class="function"><span class="keyword">function</span> <span class="title">doPosition</span><span class="params">()</span> </span>{
    <span class="keyword">var</span> l = oDiv.offsetWidth / <span class="number">2</span>;
    <span class="keyword">var</span> t = oDiv.offsetHeight / <span class="number">2</span>;
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; mcList.length; i++) {
        aA[i].style.left = mcList[i].cx + l - mcList[i].offsetWidth / <span class="number">2</span> + <span class="string">'px'</span>;
        aA[i].style.top = mcList[i].cy + t - mcList[i].offsetHeight / <span class="number">2</span> + <span class="string">'px'</span>;

        aA[i].style.fontSize = <span class="built_in">Math</span>.ceil(<span class="number">12</span> * mcList[i].scale / <span class="number">2</span>) + <span class="number">8</span> + <span class="string">'px'</span>;

        aA[i].style.filter = <span class="string">"alpha(opacity="</span> + <span class="number">100</span> * mcList[i].alpha + <span class="string">")"</span>;
        aA[i].style.opacity = mcList[i].alpha;
    }
}

<span class="function"><span class="keyword">function</span> <span class="title">sineCosine</span><span class="params">(a, b, c)</span> </span>{
    sa = <span class="built_in">Math</span>.sin(a * dtr);
    ca = <span class="built_in">Math</span>.cos(a * dtr);
    sb = <span class="built_in">Math</span>.sin(b * dtr);
    cb = <span class="built_in">Math</span>.cos(b * dtr);
    sc = <span class="built_in">Math</span>.sin(c * dtr);
    cc = <span class="built_in">Math</span>.cos(c * dtr);
}
</code></pre>

    
  </div>
</article>





  <section class="duoshuo-comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="" data-title="为博客添加3D标签云" data-url="http://ohroot.com/2014/09/19/tagscloud/index.html"></div>
    <!-- 多说评论框 end -->
  </section>


</div>

  

  
  <script type="text/javascript">
  var duoshuoQuery = {short_name:"bigegg"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>


</body>
</html>
