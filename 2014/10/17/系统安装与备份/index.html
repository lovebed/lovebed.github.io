<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>系统安装与备份 | 半饱和</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="Linux," />
  

  <meta name="description" content="本文主要介绍将ubuntu系统备份成一个LiveCD的方法，做个小结。">
<meta property="og:type" content="article">
<meta property="og:title" content="系统安装与备份">
<meta property="og:url" content="http://ohroot.com/2014/10/17/系统安装与备份/index.html">
<meta property="og:site_name" content="半饱和">
<meta property="og:description" content="本文主要介绍将ubuntu系统备份成一个LiveCD的方法，做个小结。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="系统安装与备份">
<meta name="twitter:description" content="本文主要介绍将ubuntu系统备份成一个LiveCD的方法，做个小结。">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link rel="stylesheet" href="/css/styles.css" type="text/css">

  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?8f194a78c11f76027a96c6ec87298c62";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


</head>

<body>
  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry hint hint--left" data-hint="点击返回首页" href="/">盒子</a>
    <ul class="list-toolbox">
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/archives/">博客</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/category/">分类</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/tag/">标签</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/urls/">安全圈</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/link/">友链</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/about/">关于</a>
          </li>
        
      
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/atom.xml">RSS</a>
          </li>
        
      
    </ul>
  </div>


</div>

 

 <a class="back-top" href="#">
  <i class="icon-angle-up"></i>
</a>


<div class="content-post CENTER">
   <article id="post-系统安装与备份" class="article article-type-post" itemscope itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">系统安装与备份</h1>

    <div class="article-meta">
      <span>2014-10-17</span>

      <span> | </span>

      <span class="article-author">Direwolf</span>

      <span> | </span>

      
  <span class="article-category">
    <a class="article-category-link" href="/categories/操作系统/">操作系统</a>
  </span>


    </div>
  </header>

  <div class="article-content">
    
      <p>本文主要介绍将ubuntu系统备份成一个LiveCD的方法，做个小结。<br><a id="more"></a></p>
<p>菜鸟就是有点苦逼，装系统这种事干的太多了，于是就来总结下，希望早点告别菜鸟，特写下此文。</p>
<p>首先，介绍烧写iso文件到U盘的方法，我一般使用的软件有两个，即UltraISO和Universal-USB-Installer，前者很强大，后者对Linux系统的iso文件的烧写比较给力。</p>
<p>接着，就要说一下本文的重点，将现有的ubuntu系统备份成liveCD。</p>
<p>我开始尝试的是手动方法，后来经人指导，知道了<a href="http://www.remastersys.com/" target="_blank" rel="external">remastersys</a>,用法很简单，基本操作方法如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo remastersys backup myback.iso    <span class="comment">#系统备份到myback.iso. </span></span><br><span class="line">sudo remastersys dist                 <span class="comment">#产生一个可发布（包含个人文档）的 livecd/dvd </span></span><br><span class="line">sudo remastersys dist cdfs            <span class="comment">#产生一个纯净的可发布的 livecd/dvd </span></span><br><span class="line">sudo remastersys dist iso mubuntu.iso <span class="comment">#产生一个可发布（包含个人文档）的 </span></span><br><span class="line">sudo remastersys clean                <span class="comment">#清除由 remastersys产生的临时文件</span></span><br></pre></td></tr></table></figure></p>
<p>然后是半自动化的方法，参考文章<a href="http://blog.csdn.net/vah101/article/details/6117912" target="_blank" rel="external">将现有Ubuntu系统做成LiveCD</a>。</p>
<p>这里列举主要操作步骤:</p>
<p>1.当前操作系统备份成squashfs归档文件，有很多工具，其中最简便的就数Live Ubuntu Backup V2.2了，尤其是它还支持中文提示，在<a href="http://forum.ubuntu.org.cn/viewtopic.php?f=21&amp;t=206287" target="_blank" rel="external">http://forum.ubuntu.org.cn/viewtopic.php?f=21&amp;t=206287</a> 可以下载，并且还有使用说明。这是一个shell脚本写成的Ubuntu备份工具，直接运行即可。<br>将lub拷贝到/home下，<code>sudo chmod 777 /home/lub</code> 然后执行<code>sudo /home/lub -b</code>，然后按e或c来选择是英文提示，还是中文提示。<br>第一次执行时，可能会提示需要安装lupin-casper和squashfs-tools，其中 lupin-casper可以忽略，而squashfs-tools必须安装.<br>运行<code>sudo apt-get install squashfs-tools</code>即可。<br>之后再次运行<code>sudo /home/lub -b</code>，依提示运行，就能在用户文件夹下生成一个backup-2011.01.05的目录了，其中有的backup-2011.01.05.squashfs文件就是我们想要的。</p>
<p>2.再将ubuntu-10.10-desktop-i386.iso拷贝到用户目录下，比如/home/jxg/下，执行<code>sudo mkdir /home/jxg/mnt</code>创建一个目录.<br>然后执行<code>sudo mount -o loop /home/jxg/ubuntu-10.10-desktop-i386.iso /home/jxg/mnt</code>，将ISO挂载到/home/jxg/mnt下.<br>然后用执行<code>sudo mkdri /home/jxg/livecd</code>创建一个livecd的工作目录<br>再用<code>sudo rsync --exclude=/home/jxg/mnt/casper/filesystem.squashfs -a /home/jxg/mnt/ /home/jxg/livecd</code>将/home/jxg/mnt下的内容除了casper/filesystem.squashfs，同步到了/home/jxg/livecd目录下.下面，我们要对/home/jxg/livecd/casper/目录下的filesystem.squashfs、 filesystem.manifest、filesystem.manifest-desktop这三个文件进行操作，由于它们只有读权限，所以先执行<code>sudo chmod o+w /home/jxg/livecd/casper/filesystem.*</code><br>将刚才lub生成的那个backup-2011.01.05.squashfs文件，拷贝成/home/jxg/livecd/casper/filesystem.squashfs<br>执行：<code>sudo cp /home/jxg/backup-2011.01.05/backup2011.01.05.squashfs /home/jxg/livecd/casper/filesystem.squashfs</code><br>此外，还要更新/home/jxg/livecd/casper/目录下的filesystem.manifest和filesystem.manifest-desktop，这两个文件实际上是系统所装包的列表，通过以下方式更新<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg <span class="operator">-l</span> | grep ii | awk <span class="string">'&#123;print $2,$3&#125;'</span> &gt; /home/jxg/livecd/casper/filesystem.manifest</span><br><span class="line">sudo dpkg <span class="operator">-l</span> | grep ii | awk <span class="string">'&#123;print $2,$3&#125;'</span> &gt; /home/jxg/livecd/casper/filesystem.manifest-desktop</span><br></pre></td></tr></table></figure></p>
<p>实际上filesystem.manifest-desktop和filesystem.manifest是有所不同的，主要是少了 ubiquity casper live-initramfs user-setup discover1 xresprobe os-prober libdebian-installer4 这几个包，我们这里忽略了这些影响。</p>
<p>3.退回的LiveCD的工作目录 /home/jxg/livecd 下，执行<code>sudo rm md5sum.txt</code><br>再执行<code>find -type f -print0 | sudo xargs -0 md5sum | grep -v ./isolinux/ | grep -v ./md5sum.txt | sudo tee md5sum.txt</code>,更新原来的md5sum。 </p>
<p>4.将工作目录下的内容打包成ISO<br>先运行<code>sudo apt-get install mkisofs</code>安装ISO打包工具，<br>执行<code>sudo mkisofs -D -r -V &quot;$IMAGE_NAME&quot; -cache-inodes -J -l -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -o ../ubuntu-jxg-test.iso</code><br>这个一定要在工作目录的跟下执行，并且命令最后的’.’一定不要忘记。命令完成后，就可以在上一级的目录下发现ubuntu-jxg-test.iso文件了。</p>

    
  </div>
</article>





  <section class="duoshuo-comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="" data-title="系统安装与备份" data-url="http://ohroot.com/2014/10/17/系统安装与备份/index.html"></div>
    <!-- 多说评论框 end -->
  </section>


</div>

  

  
  <script type="text/javascript">
  var duoshuoQuery = {short_name:"bigegg"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>


</body>
</html>
